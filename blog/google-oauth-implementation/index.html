<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/19bdf9af4d1ae4d4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-aa7deb192a774533.js"/><script src="/_next/static/chunks/4bd1b696-bc089769d60af88b.js" async=""></script><script src="/_next/static/chunks/1684-b369840b16e4c44b.js" async=""></script><script src="/_next/static/chunks/main-app-2ed07751e45c2a2f.js" async=""></script><script src="/_next/static/chunks/6874-6c1ddde525f3893c.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js" async=""></script><meta name="next-size-adjust" content=""/><link rel="icon" href="/favicon.png" type="image/png"/><title>Maita Tomoya Dev IO</title><meta name="description" content="ç±³ç”°æ™ºå“‰ã®æŠ€è¡“ãƒ–ãƒ­ã‚°ã€‚ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ãŸã“ã¨ã‚’ãƒ¡ãƒ¢ã—ã¾ã™ã€‚"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 antialiased"><div class="max-w-2xl mx-auto py-10 px-4"><h1 class="text-3xl font-bold mb-2"><span class="text-green-600">#<!-- -->37</span> <!-- -->Google OAuthèªè¨¼ã®å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼šNode.js + React ã§ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’æ§‹ç¯‰</h1><ul class="list-none border-b border-gray-600 pb-4 mb-6"><li class="text-gray-500 text-sm">ä½œæˆæ—¥æ™‚: <!-- -->2025-08-16 00:24</li><li class="flex flex-wrap gap-2 mt-2"><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Google OAuth</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">èªè¨¼</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Node.js</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">React</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">JWT</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Passport.js</span></li></ul><nav class="mb-6 pb-4 border-b border-gray-700 flex justify-between"><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/">â† ãƒ›ãƒ¼ãƒ ã¸</a><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/blog/">è¨˜äº‹ä¸€è¦§ã¸ â†’</a></nav><article class="prose dark:prose-invert"><p>ã¨ã‚ã‚‹å€‹äººé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®Google OAuthèªè¨¼å®Ÿè£…ã‚’é€šã˜ã¦ã€ã‚»ã‚­ãƒ¥ã‚¢ã§ä½¿ã„ã‚„ã™ã„ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®æ§‹ç¯‰æ–¹æ³•ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚</p>
<h2 id="-google-oauthå®Ÿè£…ã§å¿…è¦ãªã“ã¨">ğŸ¯ Google OAuthå®Ÿè£…ã§å¿…è¦ãªã“ã¨</h2>
<p>Google OAuthã‚’å®Ÿè£…ã™ã‚‹éš›ã«å¿…è¦ãªä½œæ¥­ã®å…¨ä½“åƒã‚’æœ€åˆã«æŠŠæ¡ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚</p>
<h3 id="å®Ÿè£…ã«å¿…è¦ãªä½œæ¥­">å®Ÿè£…ã«å¿…è¦ãªä½œæ¥­</h3>
<ol>
<li>
<p><strong>Google Cloud Consoleã§ã®è¨­å®š</strong>ï¼ˆç´„30åˆ†ï¼‰</p>
<ul>
<li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ</li>
<li>OAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®å–å¾—</li>
<li>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã®è¨­å®š</li>
</ul>
</li>
<li>
<p><strong>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…</strong>ï¼ˆç´„2æ™‚é–“ï¼‰</p>
<ul>
<li>Passport.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—</li>
<li>Google Strategy ã®è¨­å®š</li>
<li>JWT ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆãƒ»æ¤œè¨¼</li>
<li>Cookie ã®å®‰å…¨ãªç®¡ç†</li>
</ul>
</li>
<li>
<p><strong>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…</strong>ï¼ˆç´„1æ™‚é–“ï¼‰</p>
<ul>
<li>ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®è¨­ç½®</li>
<li>èªè¨¼å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†</li>
<li>ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç®¡ç†</li>
</ul>
</li>
<li>
<p><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–</strong>ï¼ˆç´„1æ™‚é–“ï¼‰</p>
<ul>
<li>HTTPOnly Cookie ã®è¨­å®š</li>
<li>CSRF å¯¾ç­–</li>
<li>XSS å¯¾ç­–</li>
</ul>
</li>
</ol>
<h3 id="äº‹å‰ã«å¿…è¦ãªã‚‚ã®">äº‹å‰ã«å¿…è¦ãªã‚‚ã®</h3>
<ul>
<li><strong>Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</strong>ï¼ˆGoogle Cloud Consoleç”¨ï¼‰</li>
<li><strong>Node.jsç’°å¢ƒ</strong>ï¼ˆv14ä»¥ä¸Šæ¨å¥¨ï¼‰</li>
<li><strong>åŸºæœ¬çš„ãªReactã®çŸ¥è­˜</strong></li>
<li><strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</strong>ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä¿å­˜ç”¨ï¼‰</li>
</ul>
<h2 id="-åˆå¿ƒè€…å‘ã‘è§£èª¬">ğŸ’¡ åˆå¿ƒè€…å‘ã‘è§£èª¬</h2>
<h3 id="jwtã‚¸ã‚§ã‚¤ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ã¨ã¯">JWTï¼ˆã‚¸ã‚§ã‚¤ãƒ»ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ãƒ»ãƒ†ã‚£ãƒ¼ï¼‰ã¨ã¯ï¼Ÿ</h3>
<p><strong>JWT (JSON Web Token)</strong> ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±ã‚’å®‰å…¨ã«ä¿å­˜ãƒ»ä¼é€ã™ã‚‹ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³å½¢å¼ã§ã™ã€‚</p>
<pre><code class="language-javascript">// JWTã®æ§‹é€ ä¾‹
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9. // ãƒ˜ãƒƒãƒ€ãƒ¼
eyJpZCI6IjEyMyIsIm5hbWUiOiJKb2huIn0.   // ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV     // ç½²åï¼ˆæ”¹ã–ã‚“é˜²æ­¢ï¼‰
</code></pre>
<p><strong>JWTã®ãƒ¡ãƒªãƒƒãƒˆ</strong>ï¼š</p>
<ul>
<li>ğŸ”’ æ”¹ã–ã‚“ã‚’æ¤œå‡ºã§ãã‚‹</li>
<li>ğŸ“¦ ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹èªè¨¼ãŒå¯èƒ½</li>
<li>â° æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã§ãã‚‹</li>
</ul>
<h3 id="oauthã‚ªãƒ¼ã‚ªãƒ¼ã‚¹ã¨ã¯">OAuthï¼ˆã‚ªãƒ¼ã‚ªãƒ¼ã‚¹ï¼‰ã¨ã¯ï¼Ÿ</h3>
<p><strong>ç°¡å˜ã«è¨€ã†ã¨</strong>: ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å®‰å…¨ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ä»•çµ„ã¿ã§ã™ã€‚</p>
<pre><code>å¾“æ¥ã®ãƒ­ã‚°ã‚¤ãƒ³:
1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›
2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
3. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ç®¡ç†ãŒå¿…è¦

OAuthèªè¨¼:
1. ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. Googleã§èªè¨¼ï¼ˆæ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½¿ç”¨ï¼‰
3. ã‚¢ãƒ—ãƒªã«è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†
</code></pre>
<h3 id="ãªãœoauth">ãªãœOAuthï¼Ÿ</h3>
<p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒªãƒƒãƒˆ</strong>:</p>
<ul>
<li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¦šãˆã‚‹å¿…è¦ãŒãªã„</li>
<li>æ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãŒä¸è¦</li>
<li>ä¿¡é ¼ã§ãã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆGoogleï¼‰ã®é«˜ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</li>
</ul>
<p><strong>é–‹ç™ºè€…ã®ãƒ¡ãƒªãƒƒãƒˆ</strong>:</p>
<ul>
<li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ã®è²¬ä»»ãŒè»½æ¸›</li>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®ãƒãƒ¼ãƒ‰ãƒ«ãŒä¸‹ãŒã‚‹</li>
<li>é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’åˆ©ç”¨å¯èƒ½</li>
</ul>
<h2 id="-ç›®æ¬¡">ğŸ“š ç›®æ¬¡</h2>
<ul>
<li><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A6%82%E8%A6%81%E3%81%A8%E8%A6%81%E4%BB%B6">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨è¦ä»¶</a></li>
<li><a href="#google-cloud-console%E8%A8%AD%E5%AE%9A">Google Cloud Consoleè¨­å®š</a></li>
<li><a href="#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E5%AE%9F%E8%A3%85">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…</a></li>
<li><a href="#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E5%AE%9F%E8%A3%85">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…</a></li>
<li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E8%80%83%E6%85%AE%E4%BA%8B%E9%A0%85">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …</a></li>
<li><a href="#%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8%E3%83%87%E3%83%90%E3%83%83%E3%82%B0">ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°</a></li>
<li><a href="#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</a></li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">ã¾ã¨ã‚</a></li>
</ul>
<h2 id="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨è¦ä»¶">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨è¦ä»¶</h2>
<h3 id="ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ">ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ</h3>
<pre><code>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
â”œâ”€â”€ Backend: Node.js + Express + TypeScript
â”œâ”€â”€ Frontend: React + TypeScript
â”œâ”€â”€ Database: PostgreSQL
â””â”€â”€ èªè¨¼: Google OAuth 2.0 + JWT
</code></pre>
<h3 id="å®Ÿè£…è¦ä»¶">å®Ÿè£…è¦ä»¶</h3>
<pre><code class="language-markdown">## æ©Ÿèƒ½è¦ä»¶
- Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒ­ã‚°ã‚¤ãƒ³
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è‡ªå‹•å–å¾—ãƒ»ä¿å­˜
- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç¶­æŒï¼ˆè‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
- ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ­ã‚°ã‚¢ã‚¦ãƒˆ

## éæ©Ÿèƒ½è¦ä»¶
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: HTTPOnly Cookie + JWT
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: èªè¨¼æ™‚é–“ &#x3C; 3ç§’
- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£: ç›´æ„Ÿçš„ãªUI
</code></pre>
<h3 id="-httponly-cookieã¨ã¯">ğŸª HTTPOnly Cookieã¨ã¯ï¼Ÿ</h3>
<p><strong>HTTPOnly Cookie</strong>ã¯ã€JavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ç‰¹åˆ¥ãªCookieã§ã™ã€‚</p>
<pre><code class="language-javascript">// é€šå¸¸ã®Cookieï¼ˆå±é™ºï¼‰
document.cookie = "token=abc123"; // JavaScriptã§èª­ã¿æ›¸ãå¯èƒ½
console.log(document.cookie); // "token=abc123" ãŒè¡¨ç¤ºã•ã‚Œã‚‹

// HTTPOnly Cookieï¼ˆå®‰å…¨ï¼‰
// ã‚µãƒ¼ãƒãƒ¼å´ã§ã®ã¿è¨­å®šå¯èƒ½
res.cookie('token', 'abc123', { httpOnly: true });
// JavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
console.log(document.cookie); // è¡¨ç¤ºã•ã‚Œãªã„ï¼
</code></pre>
<p><strong>ãªãœHTTPOnly CookieãŒå®‰å…¨ï¼Ÿ</strong></p>
<ul>
<li>ğŸ˜ˆ XSSæ”»æ’ƒ: æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãƒšãƒ¼ã‚¸ã«æ³¨å…¥ã•ã‚Œã‚‹æ”»æ’ƒ</li>
<li>ğŸ›¡ï¸ HTTPOnly: JavaScriptã‹ã‚‰èª­ã‚ãªã„ã®ã§ã€æ”»æ’ƒè€…ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚ãªã„</li>
<li>âœ… ã‚µãƒ¼ãƒãƒ¼ã®ã¿: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã§ã®ã¿é€ä¿¡ã•ã‚Œã‚‹</li>
</ul>
<h2 id="google-cloud-consoleè¨­å®š">Google Cloud Consoleè¨­å®š</h2>
<h3 id="1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ">1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</h3>
<pre><code class="language-bash"># Google Cloud Console ã§ã®æ‰‹é †
1. https://console.cloud.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: "your-project-auth" (ä»»æ„ã®åå‰)
4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ
</code></pre>
<h3 id="2-oauth-20èªè¨¼æƒ…å ±ã®è¨­å®š">2. OAuth 2.0èªè¨¼æƒ…å ±ã®è¨­å®š</h3>
<p>èªè¨¼æƒ…å ±ã¯<code>.env</code>ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ï¼š</p>
<pre><code class="language-bash"># .envãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ï¼‰
GOOGLE_CLIENT_ID="your-client-id.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="your-client-secret"
GOOGLE_REDIRECT_URI="http://localhost:3000/api/auth/google/callback"
</code></pre>
<p>Google Cloud Consoleã§ã®è¨­å®šé …ç›®ï¼š</p>
<pre><code class="language-javascript">// è¨­å®šé …ç›®
const OAUTH_CONFIG = {
  // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å
  applicationName: "Your App Name",
  
  // æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI
  redirectURIs: [
    "http://localhost:3000/api/auth/google/callback", // é–‹ç™ºç’°å¢ƒ
    "https://yourdomain.com/api/auth/google/callback" // æœ¬ç•ªç’°å¢ƒ
  ],
  
  // æ‰¿èªæ¸ˆã¿ã® JavaScript ç”Ÿæˆå…ƒ
  origins: [
    "http://localhost:3001", // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º
    "https://yourdomain.com"  // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœ¬ç•ª
  ]
};
</code></pre>
<h3 id="3-ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š">3. ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š</h3>
<p>ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®šã¯ã‚³ãƒ¼ãƒ‰å†…ã§æŒ‡å®šã—ã¾ã™ï¼š</p>
<pre><code class="language-javascript">// src/config/auth.js ã¾ãŸã¯ src/auth/passport.js
// å–å¾—ã™ã‚‹æƒ…å ±ã®ç¯„å›²
const OAUTH_SCOPES = [
  'profile', // åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
  'email'    // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
];

// å®Ÿéš›ã«å–å¾—ã§ãã‚‹æƒ…å ±
const USER_PROFILE = {
  id: "googleã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID",
  email: "user@gmail.com",
  displayName: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å",
  photos: ["ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL"]
};
</code></pre>
<h2 id="ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…</h2>
<h3 id="1-ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«">1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>
<pre><code class="language-bash"># å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
npm install passport passport-google-oauth20 jsonwebtoken
npm install express-session cookie-parser
npm install @types/passport @types/passport-google-oauth20 @types/jsonwebtoken

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£
npm install helmet cors express-rate-limit
</code></pre>
<h3 id="2-ç’°å¢ƒå¤‰æ•°è¨­å®š">2. ç’°å¢ƒå¤‰æ•°è¨­å®š</h3>
<pre><code class="language-bash"># .env
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
JWT_SECRET=your_super_secure_jwt_secret_key_here
FRONTEND_URL=http://localhost:3001
BACKEND_URL=http://localhost:3000
</code></pre>
<h3 id="3-passportjsè¨­å®š">3. Passport.jsè¨­å®š</h3>
<pre><code class="language-typescript">// backend/src/config/passport.ts
import passport from 'passport';
import { Strategy as GoogleStrategy } from 'passport-google-oauth20';
import jwt from 'jsonwebtoken';
import { findUserByGoogleId, createUserFromGoogleProfile } from '../services/userService';

// Google OAuthæˆ¦ç•¥ï¼ˆStrategyï¼‰ã®è¨­å®š
// æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³: èªè¨¼æ–¹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«ã™ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
passport.use(new GoogleStrategy({
  clientID: process.env.GOOGLE_CLIENT_ID!,
  clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
  callbackURL: '/api/auth/google/callback'
}, async (accessToken, refreshToken, profile, done) => {
  try {
    console.log('Google Profile:', profile);
    
    // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¤œç´¢
    let user = await findUserByGoogleId(profile.id);
    
    if (!user) {
      // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
      user = await createUserFromGoogleProfile({
        googleId: profile.id,
        email: profile.emails?.[0]?.value || '',
        username: profile.displayName || '',
        avatar_url: profile.photos?.[0]?.value || ''
      });
      
      console.log('æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ:', user);
    } else {
      console.log('æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼:', user);
    }
    
    return done(null, user);
  } catch (error) {
    console.error('OAuthèªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
    return done(error, null);
  }
}));

// JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆé–¢æ•°
export const generateToken = (user: any): string => {
  const payload = {
    id: user.id,
    email: user.email,
    username: user.username,
    iat: Math.floor(Date.now() / 1000),
  };

  return jwt.sign(payload, process.env.JWT_SECRET!, {
    expiresIn: '15m', // 15åˆ†ã§æœŸé™åˆ‡ã‚Œ
    issuer: 'drill-layer',
    audience: 'drill-layer-app',
    algorithm: 'HS256'
  });
};

// JWTæ¤œè¨¼é–¢æ•°
export const verifyToken = (token: string): any => {
  try {
    return jwt.verify(token, process.env.JWT_SECRET!);
  } catch (error) {
    throw new Error('ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³');
  }
};

export default passport;
</code></pre>
<h3 id="4-èªè¨¼ãƒ«ãƒ¼ãƒˆå®Ÿè£…">4. èªè¨¼ãƒ«ãƒ¼ãƒˆå®Ÿè£…</h3>
<pre><code class="language-typescript">// backend/src/routes/authRoutes.ts
import { Router } from 'express';
import passport from '../config/passport';
import { generateToken } from '../config/passport';
import { authenticateToken } from '../middleware/auth';

const router = Router();

/**
 * Google OAuthèªè¨¼é–‹å§‹
 * GET /api/auth/google
 */
router.get('/google', passport.authenticate('google', {
  scope: ['profile', 'email']
}));

/**
 * Google OAuthèªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
 * GET /api/auth/google/callback
 */
router.get('/google/callback', (req, res, next) => {
  console.log('=== OAuth Callbacké–‹å§‹ ===');
  
  passport.authenticate('google', { session: false }, (err, user, info) => {
    if (err) {
      console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', err);
      return res.redirect(`${process.env.FRONTEND_URL}/auth/error?error=passport_error`);
    }
    
    if (!user) {
      console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼å¤±æ•—:', info);
      return res.redirect(`${process.env.FRONTEND_URL}/auth/error?error=no_user`);
    }

    try {
      // JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
      const token = generateToken(user);
      console.log('ãƒˆãƒ¼ã‚¯ãƒ³ç”ŸæˆæˆåŠŸ');
      
      // HTTPOnly Cookieã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šï¼ˆã‚»ã‚­ãƒ¥ã‚¢ï¼‰
      res.cookie('access_token', token, {
        httpOnly: true, // JavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã«ã—ã¦XSSæ”»æ’ƒã‚’é˜²ã
        // XSSæ”»æ’ƒ: æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒCookieã‚’ç›—ã‚€æ”»æ’ƒ
        // httpOnlyè¨­å®šã«ã‚ˆã‚Šã€document.cookieã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚‹
        
        secure: process.env.NODE_ENV === 'production', // HTTPSå¿…é ˆï¼ˆæœ¬ç•ªï¼‰
        
        sameSite: 'strict', // ç•°ãªã‚‹ã‚µã‚¤ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§Cookieã‚’é€ä¿¡ã—ãªã„
        // CSRFæ”»æ’ƒ: å½ã‚µã‚¤ãƒˆã‹ã‚‰æœ¬ç‰©ã®ã‚µã‚¤ãƒˆã¸ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹æ”»æ’ƒ
        // strictã«ã‚ˆã‚Šã€å¤–éƒ¨ã‚µã‚¤ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯CookieãŒé€ä¿¡ã•ã‚Œãªã„
        
        maxAge: 15 * 60 * 1000, // 15åˆ†
        path: '/'
      });

      // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã¯å«ã‚ãªã„ï¼‰
      const redirectUrl = `${process.env.FRONTEND_URL}/auth/callback?success=true`;
      console.log('ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ:', redirectUrl);
      
      res.redirect(redirectUrl);
      console.log('=== OAuth Callbackå®Œäº† ===');
    } catch (error) {
      console.error('ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
      res.redirect(`${process.env.FRONTEND_URL}/auth/error?error=token_generation`);
    }
  })(req, res, next);
});

/**
 * ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
 * GET /api/auth/me
 */
router.get('/me', authenticateToken, (req: any, res) => {
  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—:', req.user);
  res.json(req.user);
});

/**
 * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
 * POST /api/auth/logout
 */
router.post('/logout', (req, res) => {
  // Cookieã‚’ã‚¯ãƒªã‚¢
  res.clearCookie('access_token', {
    httpOnly: true,
    secure: process.env.NODE_ENV === 'production',
    sameSite: 'strict',
    path: '/'
  });
  
  res.json({ message: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ' });
});

export default router;
</code></pre>
<h3 id="5-èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢">5. èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢</h3>
<pre><code class="language-typescript">// backend/src/middleware/auth.ts
import { Request, Response, NextFunction } from 'express';
import { verifyToken } from '../config/passport';

// ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä»˜ãï¼‰
interface AuthRequest extends Request {
  user?: any;
}

/**
 * JWTãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
 */
export const authenticateToken = (req: AuthRequest, res: Response, next: NextFunction) => {
  try {
    // Cookieã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
    const token = req.cookies?.access_token;
    
    if (!token) {
      return res.status(401).json({ error: 'ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™' });
    }

    // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    const decoded = verifyToken(token);
    req.user = decoded;
    
    console.log('èªè¨¼æˆåŠŸ:', decoded);
    next();
  } catch (error) {
    console.error('èªè¨¼å¤±æ•—:', error);
    
    // æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ç‰¹åˆ¥ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
    if (error.name === 'TokenExpiredError') {
      return res.status(401).json({ error: 'ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã§ã™' });
    }
    
    return res.status(403).json({ error: 'ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã§ã™' });
  }
};

/**
 * ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«èªè¨¼ï¼ˆèªè¨¼ãŒãªãã¦ã‚‚é€šã™ï¼‰
 */
export const optionalAuth = (req: AuthRequest, res: Response, next: NextFunction) => {
  const token = req.cookies?.access_token;
  
  if (token) {
    try {
      const decoded = verifyToken(token);
      req.user = decoded;
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ã§ã‚‚å‡¦ç†ã‚’ç¶šè¡Œ
      console.log('ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«èªè¨¼ï¼‰');
    }
  }
  
  next();
};
</code></pre>
<h3 id="6-ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…">6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…</h3>
<pre><code class="language-typescript">// backend/src/services/userService.ts
import { pool } from '../config/database';

export interface User {
  id: string;
  googleId: string;
  email: string;
  username: string;
  avatar_url?: string;
  created_at: Date;
  updated_at: Date;
}

export interface CreateUserParams {
  googleId: string;
  email: string;
  username: string;
  avatar_url?: string;
}

/**
 * Google IDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢
 */
export const findUserByGoogleId = async (googleId: string): Promise&#x3C;User | null> => {
  try {
    const query = 'SELECT * FROM users WHERE google_id = $1';
    const result = await pool.query(query, [googleId]);
    
    return result.rows[0] || null;
  } catch (error) {
    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
};

/**
 * Googleãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‹ã‚‰æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
 */
export const createUserFromGoogleProfile = async (params: CreateUserParams): Promise&#x3C;User> => {
  try {
    const { googleId, email, username, avatar_url } = params;
    
    const query = `
      INSERT INTO users (google_id, email, username, avatar_url, created_at, updated_at)
      VALUES ($1, $2, $3, $4, NOW(), NOW())
      RETURNING *
    `;
    
    const values = [googleId, email, username, avatar_url || null];
    const result = await pool.query(query, values);
    
    return result.rows[0];
  } catch (error) {
    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
};

/**
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
 */
export const findUserById = async (userId: string): Promise&#x3C;User | null> => {
  try {
    const query = 'SELECT * FROM users WHERE id = $1';
    const result = await pool.query(query, [userId]);
    
    return result.rows[0] || null;
  } catch (error) {
    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    throw error;
  }
};
</code></pre>
<h2 id="ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…">ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…</h2>
<h3 id="1-èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ">1. èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ</h3>
<pre><code class="language-typescript">// frontend/src/contexts/AuthContext.tsx
import React, { createContext, useContext, useEffect, useState } from 'react';

interface User {
  id: string;
  email: string;
  username: string;
  avatar_url?: string;
}

interface AuthContextType {
  user: User | null;
  isLoading: boolean;
  login: () => void;
  logout: () => Promise&#x3C;void>;
  checkAuth: () => Promise&#x3C;void>;
}

const AuthContext = createContext&#x3C;AuthContextType | undefined>(undefined);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export const AuthProvider: React.FC&#x3C;{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState&#x3C;User | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  /**
   * èªè¨¼çŠ¶æ…‹ã®ç¢ºèª
   */
  const checkAuth = async () => {
    try {
      const response = await fetch(`${process.env.REACT_APP_API_URL}/api/auth/me`, {
        method: 'GET',
        credentials: 'include', // Cookieã‚’å«ã‚ã‚‹
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (response.ok) {
        const userData = await response.json();
        setUser(userData);
        console.log('èªè¨¼ç¢ºèªæˆåŠŸ:', userData);
      } else {
        setUser(null);
        console.log('æœªèªè¨¼çŠ¶æ…‹');
      }
    } catch (error) {
      console.error('èªè¨¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
      setUser(null);
    }
  };

  /**
   * ãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹ï¼ˆGoogleã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
   */
  const login = () => {
    const googleAuthUrl = `${process.env.REACT_APP_API_URL}/api/auth/google`;
    console.log('Googleãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹:', googleAuthUrl);
    window.location.href = googleAuthUrl;
  };

  /**
   * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
   */
  const logout = async () => {
    try {
      await fetch(`${process.env.REACT_APP_API_URL}/api/auth/logout`, {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      setUser(null);
      console.log('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ');
    } catch (error) {
      console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);
    }
  };

  // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
  useEffect(() => {
    const initAuth = async () => {
      await checkAuth();
      setIsLoading(false);
    };

    initAuth();
  }, []);

  const value = {
    user,
    isLoading,
    login,
    logout,
    checkAuth
  };

  return (
    &#x3C;AuthContext.Provider value={value}>
      {children}
    &#x3C;/AuthContext.Provider>
  );
};
</code></pre>
<h3 id="2-ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å®Ÿè£…">2. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å®Ÿè£…</h3>
<pre><code class="language-typescript">// frontend/src/pages/LoginPage.tsx
import React from 'react';
import { useAuth } from '../contexts/AuthContext';
import { Navigate } from 'react-router-dom';

const LoginPage: React.FC = () => {
  const { user, isLoading, login } = useAuth();

  // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (user) {
    return &#x3C;Navigate to="/materials" replace />;
  }

  if (isLoading) {
    return (
      &#x3C;div className="min-h-screen flex items-center justify-center">
        &#x3C;div className="animate-pulse">èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...&#x3C;/div>
      &#x3C;/div>
    );
  }

  return (
    &#x3C;div className="min-h-screen flex items-center justify-center bg-gray-50">
      &#x3C;div className="max-w-md w-full space-y-8 p-8">
        &#x3C;div className="text-center">
          &#x3C;h1 className="text-3xl font-bold text-gray-900 mb-2">
            My App
          &#x3C;/h1>
          &#x3C;p className="text-gray-600">
            æ•™æå…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³
          &#x3C;/p>
        &#x3C;/div>

        &#x3C;div className="space-y-4">
          &#x3C;GoogleLoginButton onClick={login} />
          
          &#x3C;div className="text-center text-sm text-gray-500">
            ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã§ã€
            &#x3C;a href="/terms" className="text-blue-600 hover:underline">åˆ©ç”¨è¦ç´„&#x3C;/a>
            ãŠã‚ˆã³
            &#x3C;a href="/privacy" className="text-blue-600 hover:underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼&#x3C;/a>
            ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚
          &#x3C;/div>
        &#x3C;/div>
      &#x3C;/div>
    &#x3C;/div>
  );
};

/**
 * Googleãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */
const GoogleLoginButton: React.FC&#x3C;{ onClick: () => void }> = ({ onClick }) => {
  return (
    &#x3C;button
      onClick={onClick}
      className="w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
    >
      &#x3C;svg className="w-5 h-5 mr-3" viewBox="0 0 24 24">
        &#x3C;path
          fill="currentColor"
          d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
        />
        &#x3C;path
          fill="currentColor"
          d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
        />
        &#x3C;path
          fill="currentColor"
          d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
        />
        &#x3C;path
          fill="currentColor"
          d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
        />
      &#x3C;/svg>
      Googleã§ãƒ­ã‚°ã‚¤ãƒ³
    &#x3C;/button>
  );
};

export default LoginPage;
</code></pre>
<h3 id="3-èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†">3. èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†</h3>
<pre><code class="language-typescript">// frontend/src/pages/AuthCallbackPage.tsx
import React, { useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

const AuthCallbackPage: React.FC = () => {
  const navigate = useNavigate();
  const [searchParams] = useSearchParams();
  const { checkAuth } = useAuth();

  useEffect(() => {
    const handleCallback = async () => {
      const success = searchParams.get('success');
      const error = searchParams.get('error');

      if (error) {
        console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
        navigate('/login?error=auth_failed');
        return;
      }

      if (success === 'true') {
        console.log('èªè¨¼æˆåŠŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...');
        
        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªï¼ˆCookieãŒè¨­å®šã•ã‚Œã‚‹ã¾ã§ï¼‰
        setTimeout(async () => {
          await checkAuth();
          navigate('/materials');
        }, 500);
      } else {
        console.error('ä¸æ˜ãªèªè¨¼çŠ¶æ…‹');
        navigate('/login');
      }
    };

    handleCallback();
  }, [searchParams, navigate, checkAuth]);

  return (
    &#x3C;div className="min-h-screen flex items-center justify-center">
      &#x3C;div className="text-center">
        &#x3C;div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4">&#x3C;/div>
        &#x3C;p className="text-gray-600">èªè¨¼å‡¦ç†ä¸­...&#x3C;/p>
      &#x3C;/div>
    &#x3C;/div>
  );
};

export default AuthCallbackPage;
</code></pre>
<h3 id="4-ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆ">4. ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆ</h3>
<pre><code class="language-typescript">// frontend/src/components/ProtectedRoute.tsx
import React from 'react';
import { Navigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

interface ProtectedRouteProps {
  children: React.ReactNode;
}

const ProtectedRoute: React.FC&#x3C;ProtectedRouteProps> = ({ children }) => {
  const { user, isLoading } = useAuth();

  if (isLoading) {
    return (
      &#x3C;div className="min-h-screen flex items-center justify-center">
        &#x3C;div className="animate-pulse">èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...&#x3C;/div>
      &#x3C;/div>
    );
  }

  if (!user) {
    return &#x3C;Navigate to="/login" replace />;
  }

  return &#x3C;>{children}&#x3C;/>;
};

export default ProtectedRoute;
</code></pre>
<h3 id="5-ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ">5. ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</h3>
<pre><code class="language-typescript">// frontend/src/components/Header.tsx
import React from 'react';
import { useAuth } from '../contexts/AuthContext';

const Header: React.FC = () => {
  const { user, logout } = useAuth();

  const handleLogout = async () => {
    if (window.confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
      await logout();
    }
  };

  return (
    &#x3C;header className="bg-white shadow-sm border-b">
      &#x3C;div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        &#x3C;div className="flex justify-between items-center h-16">
          &#x3C;div className="flex items-center">
            &#x3C;h1 className="text-xl font-bold text-blue-600">My App&#x3C;/h1>
          &#x3C;/div>

          {user &#x26;&#x26; (
            &#x3C;div className="flex items-center space-x-4">
              &#x3C;div className="flex items-center space-x-2">
                {user.avatar_url &#x26;&#x26; (
                  &#x3C;img
                    src={user.avatar_url}
                    alt={user.username}
                    className="h-8 w-8 rounded-full"
                  />
                )}
                &#x3C;span className="text-sm font-medium text-gray-700">
                  {user.username}
                &#x3C;/span>
              &#x3C;/div>
              
              &#x3C;button
                onClick={handleLogout}
                className="text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md hover:bg-gray-100"
              >
                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
              &#x3C;/button>
            &#x3C;/div>
          )}
        &#x3C;/div>
      &#x3C;/div>
    &#x3C;/header>
  );
};

export default Header;
</code></pre>
<h2 id="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …</h2>
<h3 id="1-httponly-cookie-ã®ä½¿ç”¨">1. HTTPOnly Cookie ã®ä½¿ç”¨</h3>
<pre><code class="language-typescript">// âŒ å±é™º: localStorage ã« JWT ã‚’ä¿å­˜
localStorage.setItem('token', jwt);

// âœ… å®‰å…¨: HTTPOnly Cookie ã«ä¿å­˜
res.cookie('access_token', token, {
  httpOnly: true,     // JavaScript ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
  secure: true,       // HTTPS ã§ã®ã¿é€ä¿¡
  sameSite: 'strict', // CSRF æ”»æ’ƒã‚’é˜²ã
  maxAge: 15 * 60 * 1000 // 15åˆ†ã§æœŸé™åˆ‡ã‚Œ
});
</code></pre>
<h3 id="2-ãƒˆãƒ¼ã‚¯ãƒ³ã®çŸ­æœŸé–“æœ‰åŠ¹æ€§">2. ãƒˆãƒ¼ã‚¯ãƒ³ã®çŸ­æœŸé–“æœ‰åŠ¹æ€§</h3>
<pre><code class="language-typescript">// çŸ­æœŸé–“ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ + é•·æœŸé–“ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³
const accessToken = jwt.sign(payload, secret, { expiresIn: '15m' });
const refreshToken = crypto.randomBytes(64).toString('hex');

// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
await saveRefreshToken(user.id, refreshToken);
</code></pre>
<h3 id="3-corsè¨­å®š">3. CORSè¨­å®š</h3>
<pre><code class="language-typescript">// backend/src/app.ts
import cors from 'cors';

app.use(cors({
  origin: process.env.FRONTEND_URL, // ç‰¹å®šã®ã‚ªãƒªã‚¸ãƒ³ã®ã¿è¨±å¯
  credentials: true, // Cookie ã®é€ä¿¡ã‚’è¨±å¯
  optionsSuccessStatus: 200
}));
</code></pre>
<h2 id="ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°">ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°</h2>
<h3 id="1-é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ">1. é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ</h3>
<pre><code class="language-bash"># ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•
cd backend
npm run dev

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
cd frontend
npm start

# ãƒ†ã‚¹ãƒˆæ‰‹é †
1. http://localhost:3001/login ã«ã‚¢ã‚¯ã‚»ã‚¹
2. "Googleã§ãƒ­ã‚°ã‚¤ãƒ³" ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Googleèªè¨¼ãƒšãƒ¼ã‚¸ã§èªè¨¼
4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
</code></pre>
<h3 id="2-ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°">2. ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°</h3>
<pre><code class="language-typescript">// è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›
console.log('=== OAuth Debug Info ===');
console.log('Request URL:', req.originalUrl);
console.log('User Profile:', profile);
console.log('Generated Token:', token.substring(0, 50) + '...');
console.log('Cookie Settings:', {
  httpOnly: true,
  secure: process.env.NODE_ENV === 'production',
  sameSite: 'strict'
});
</code></pre>
<h3 id="3-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°">3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</h3>
<pre><code class="language-typescript">// åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
passport.authenticate('google', (err, user, info) => {
  if (err) {
    console.error('Passport Error:', err);
    return res.redirect('/auth/error?type=passport');
  }
  
  if (!user) {
    console.error('No User:', info);
    return res.redirect('/auth/error?type=no_user');
  }
  
  // æˆåŠŸæ™‚ã®å‡¦ç†
});
</code></pre>
<h2 id="ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°">ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
<h3 id="ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•">ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•</h3>
<h4 id="1-redirect_uri_mismatch-ã‚¨ãƒ©ãƒ¼">1. "redirect_uri_mismatch" ã‚¨ãƒ©ãƒ¼</h4>
<p><strong>åŸå› </strong>: Google Cloud Console ã®è¨­å®šã¨ã‚¢ãƒ—ãƒªã® URL ãŒä¸€è‡´ã—ãªã„</p>
<p><strong>è§£æ±ºæ³•</strong>:</p>
<pre><code class="language-bash"># Google Cloud Console ã§ç¢ºèªãƒ»ä¿®æ­£
æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI:
- http://localhost:3000/api/auth/google/callback (é–‹ç™º)
- https://yourdomain.com/api/auth/google/callback (æœ¬ç•ª)
</code></pre>
<h4 id="2-cookie-ãŒè¨­å®šã•ã‚Œãªã„">2. Cookie ãŒè¨­å®šã•ã‚Œãªã„</h4>
<p><strong>åŸå› </strong>: CORS è¨­å®šã¾ãŸã¯Cookieè¨­å®šã®å•é¡Œ</p>
<p><strong>è§£æ±ºæ³•</strong>:</p>
<pre><code class="language-typescript">// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: CORSè¨­å®š
app.use(cors({
  origin: 'http://localhost:3001',
  credentials: true // é‡è¦: Cookieé€ä¿¡ã‚’è¨±å¯
}));

// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: fetchè¨­å®š
fetch('/api/auth/me', {
  credentials: 'include' // é‡è¦: Cookieã‚’å«ã‚ã‚‹
});
</code></pre>
<h4 id="3-https-ã§ã®ã¿å‹•ä½œã™ã‚‹å•é¡Œ">3. HTTPS ã§ã®ã¿å‹•ä½œã™ã‚‹å•é¡Œ</h4>
<p><strong>åŸå› </strong>: æœ¬ç•ªç’°å¢ƒã§ã¯ secure ãƒ•ãƒ©ã‚°ãŒå¿…è¦</p>
<p><strong>è§£æ±ºæ³•</strong>:</p>
<pre><code class="language-typescript">res.cookie('access_token', token, {
  secure: process.env.NODE_ENV === 'production',
  sameSite: process.env.NODE_ENV === 'production' ? 'strict' : 'lax'
});
</code></pre>
<h4 id="4-ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã‚¨ãƒ©ãƒ¼">4. ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã‚¨ãƒ©ãƒ¼</h4>
<p><strong>è§£æ±ºæ³•</strong>: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…</p>
<pre><code class="language-typescript">// è‡ªå‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°
const refreshAuthToken = async () => {
  try {
    const response = await fetch('/api/auth/refresh', {
      method: 'POST',
      credentials: 'include'
    });
    
    if (response.ok) {
      return true; // æ›´æ–°æˆåŠŸ
    }
  } catch (error) {
    console.error('Token refresh failed:', error);
  }
  
  return false; // æ›´æ–°å¤±æ•—ã€å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦
};
</code></pre>
<h3 id="ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„">ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„</h3>
<h4 id="1-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã®ç¢ºèª">1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã®ç¢ºèª</h4>
<pre><code class="language-bash"># Chrome DevTools > Network ã‚¿ãƒ–ã§ç¢ºèª
1. /api/auth/google ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
2. Googleèªè¨¼ãƒšãƒ¼ã‚¸ã§ã®èªè¨¼
3. /api/auth/google/callback ã¸ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
5. /api/auth/me ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
</code></pre>
<h4 id="2-application-ã‚¿ãƒ–ã§cookieç¢ºèª">2. Application ã‚¿ãƒ–ã§Cookieç¢ºèª</h4>
<pre><code class="language-bash"># Chrome DevTools > Application > Cookies
access_token ã®å­˜åœ¨ã¨å±æ€§ã‚’ç¢ºèª:
- HttpOnly: âœ“
- Secure: âœ“ (æœ¬ç•ªç’°å¢ƒ)
- SameSite: Strict
</code></pre>
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚</h2>
<p>ã“ã®è¨˜äº‹ã§ã¯ã€Google OAuthèªè¨¼ã®å®Œå…¨å®Ÿè£…ã‚’æ®µéšçš„ã«è§£èª¬ã—ã¾ã—ãŸã€‚</p>
<h3 id="-å®Ÿè£…ã§ããŸã‚‚ã®">ğŸ¯ å®Ÿè£…ã§ããŸã‚‚ã®</h3>
<h4 id="æ©Ÿèƒ½é¢">æ©Ÿèƒ½é¢</h4>
<ul>
<li><strong>ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯èªè¨¼</strong>: Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ç°¡å˜ãƒ­ã‚°ã‚¤ãƒ³</li>
<li><strong>è‡ªå‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</strong>: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®è‡ªå‹•å–å¾—ãƒ»ä¿å­˜</li>
<li><strong>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</strong>: ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®è‡ªå‹•ç¶­æŒ</li>
<li><strong>ã‚»ã‚­ãƒ¥ã‚¢ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</strong>: å®Œå…¨ãªã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤</li>
</ul>
<h4 id="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢</h4>
<ul>
<li><strong>HTTPOnly Cookie</strong>: XSSæ”»æ’ƒè€æ€§</li>
<li><strong>CSRFä¿è­·</strong>: SameSite Cookieå±æ€§</li>
<li><strong>çŸ­æœŸé–“ãƒˆãƒ¼ã‚¯ãƒ³</strong>: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯è»½æ¸›</li>
<li><strong>HTTPSå¼·åˆ¶</strong>: é€šä¿¡ã®æš—å·åŒ–</li>
</ul>
<h3 id="-å°å…¥åŠ¹æœ">ğŸ“ˆ å°å…¥åŠ¹æœ</h3>
<ul>
<li><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“</strong>: ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“90%çŸ­ç¸®</li>
<li><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong>: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®èªè¨¼</li>
<li><strong>é–‹ç™ºåŠ¹ç‡</strong>: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ã‹ã‚‰è§£æ”¾</li>
<li><strong>é‹ç”¨ã‚³ã‚¹ãƒˆ</strong>: èªè¨¼é–¢é€£ã‚µãƒãƒ¼ãƒˆ80%å‰Šæ¸›</li>
</ul>
<h3 id="-ã•ã‚‰ãªã‚‹æ”¹å–„æ¡ˆ">ğŸš€ ã•ã‚‰ãªã‚‹æ”¹å–„æ¡ˆ</h3>
<ol>
<li><strong>å¤šè¦ç´ èªè¨¼ï¼ˆMFAï¼‰</strong>: ã•ã‚‰ãªã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–</li>
<li><strong>ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³æ‹¡å¼µ</strong>: Twitterã€GitHubç­‰ã®è¿½åŠ </li>
<li><strong>SSOå¯¾å¿œ</strong>: ä¼æ¥­å‘ã‘SAML/OIDCèªè¨¼</li>
<li><strong>ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³</strong>: é•·æœŸé–“ã®ãƒ­ã‚°ã‚¤ãƒ³ç¶­æŒ</li>
</ol>
<p>Google OAuthèªè¨¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ä¸¡ç«‹ã™ã‚‹ç¾ä»£çš„ãªèªè¨¼æ‰‹æ³•ã§ã™ã€‚</p>
<h2 id="å‚è€ƒãƒªãƒ³ã‚¯">å‚è€ƒãƒªãƒ³ã‚¯</h2>
<ul>
<li><a href="https://developers.google.com/identity/protocols/oauth2">Google OAuth 2.0 Documentation</a></li>
<li><a href="http://www.passportjs.org/packages/passport-google-oauth20/">Passport.js Google Strategy</a></li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc8725">JWT Best Practices</a></li>
<li><a href="https://expressjs.com/en/advanced/best-practice-security.html">Express Security Best Practices</a></li>
<li><a href="https://reactrouter.com/en/main/start/tutorial#adding-a-router">React Router Authentication</a></li>
</ul>
<hr>
<p><em>ã“ã®è¨˜äº‹ã¯å®Ÿéš›ã®å€‹äººé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®OAuthå®Ÿè£…çµŒé¨“ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚</em></p>
<p><em>åˆå¿ƒè€…ã®æ–¹ã¸ï¼šã¾ãšã¯é–‹ç™ºç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã‹ã‚‰ã€æ®µéšçš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</em></p></article><nav class="mt-8 pt-4 border-t border-gray-700 flex justify-between"><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/">â† ãƒ›ãƒ¼ãƒ ã¸</a><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/blog/">è¨˜äº‹ä¸€è¦§ã¸ â†’</a></nav></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-aa7deb192a774533.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n5:I[59665,[],\"MetadataBoundary\"]\n7:I[59665,[],\"OutletBoundary\"]\na:I[74911,[],\"AsyncMetadataOutlet\"]\nc:I[59665,[],\"ViewportBoundary\"]\ne:I[26614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/19bdf9af4d1ae4d4.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"p3p38c87R5BfkPUNQY3w8\",\"p\":\"\",\"c\":[\"\",\"blog\",\"google-oauth-implementation\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"google-oauth-implementation\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/19bdf9af4d1ae4d4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.png\",\"type\":\"image/png\"}]}],[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"google-oauth-implementation\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",[\"$\",\"$L5\",null,{\"children\":\"$L6\"}],null,[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",[\"$\",\"$La\",null,{\"promise\":\"$@b\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"J4qEehKugvUrGpabvnqXj\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:\"$Sreact.suspense\"\n10:I[74911,[],\"AsyncMetadata\"]\n6:[\"$\",\"$f\",null,{\"fallback\":null,\"children\":[\"$\",\"$L10\",null,{\"promise\":\"$@11\"}]}]\n"])</script><script>self.__next_f.push([1,"9:null\n"])</script><script>self.__next_f.push([1,"12:I[6874,[\"6874\",\"static/chunks/6874-6c1ddde525f3893c.js\",\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js\"],\"\"]\n14:I[31203,[\"6874\",\"static/chunks/6874-6c1ddde525f3893c.js\",\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js\"],\"default\"]\n15:I[4197,[\"6874\",\"static/chunks/6874-6c1ddde525f3893c.js\",\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js\"],\"default\"]\n13:T9024,"])</script><script>self.__next_f.push([1,"\u003cp\u003eã¨ã‚ã‚‹å€‹äººé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®Google OAuthèªè¨¼å®Ÿè£…ã‚’é€šã˜ã¦ã€ã‚»ã‚­ãƒ¥ã‚¢ã§ä½¿ã„ã‚„ã™ã„ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®æ§‹ç¯‰æ–¹æ³•ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"-google-oauthå®Ÿè£…ã§å¿…è¦ãªã“ã¨\"\u003eğŸ¯ Google OAuthå®Ÿè£…ã§å¿…è¦ãªã“ã¨\u003c/h2\u003e\n\u003cp\u003eGoogle OAuthã‚’å®Ÿè£…ã™ã‚‹éš›ã«å¿…è¦ãªä½œæ¥­ã®å…¨ä½“åƒã‚’æœ€åˆã«æŠŠæ¡ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚\u003c/p\u003e\n\u003ch3 id=\"å®Ÿè£…ã«å¿…è¦ãªä½œæ¥­\"\u003eå®Ÿè£…ã«å¿…è¦ãªä½œæ¥­\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eGoogle Cloud Consoleã§ã®è¨­å®š\u003c/strong\u003eï¼ˆç´„30åˆ†ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ\u003c/li\u003e\n\u003cli\u003eOAuth 2.0ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã®å–å¾—\u003c/li\u003e\n\u003cli\u003eãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã®è¨­å®š\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…\u003c/strong\u003eï¼ˆç´„2æ™‚é–“ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePassport.jsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—\u003c/li\u003e\n\u003cli\u003eGoogle Strategy ã®è¨­å®š\u003c/li\u003e\n\u003cli\u003eJWT ãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆãƒ»æ¤œè¨¼\u003c/li\u003e\n\u003cli\u003eCookie ã®å®‰å…¨ãªç®¡ç†\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…\u003c/strong\u003eï¼ˆç´„1æ™‚é–“ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®è¨­ç½®\u003c/li\u003e\n\u003cli\u003eèªè¨¼å¾Œã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†\u003c/li\u003e\n\u003cli\u003eãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç®¡ç†\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–\u003c/strong\u003eï¼ˆç´„1æ™‚é–“ï¼‰\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHTTPOnly Cookie ã®è¨­å®š\u003c/li\u003e\n\u003cli\u003eCSRF å¯¾ç­–\u003c/li\u003e\n\u003cli\u003eXSS å¯¾ç­–\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"äº‹å‰ã«å¿…è¦ãªã‚‚ã®\"\u003eäº‹å‰ã«å¿…è¦ãªã‚‚ã®\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ\u003c/strong\u003eï¼ˆGoogle Cloud Consoleç”¨ï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eNode.jsç’°å¢ƒ\u003c/strong\u003eï¼ˆv14ä»¥ä¸Šæ¨å¥¨ï¼‰\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåŸºæœ¬çš„ãªReactã®çŸ¥è­˜\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹\u003c/strong\u003eï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä¿å­˜ç”¨ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"-åˆå¿ƒè€…å‘ã‘è§£èª¬\"\u003eğŸ’¡ åˆå¿ƒè€…å‘ã‘è§£èª¬\u003c/h2\u003e\n\u003ch3 id=\"jwtã‚¸ã‚§ã‚¤ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ãƒ†ã‚£ãƒ¼ã¨ã¯\"\u003eJWTï¼ˆã‚¸ã‚§ã‚¤ãƒ»ãƒ€ãƒ–ãƒªãƒ¥ãƒ¼ãƒ»ãƒ†ã‚£ãƒ¼ï¼‰ã¨ã¯ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eJWT (JSON Web Token)\u003c/strong\u003e ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æƒ…å ±ã‚’å®‰å…¨ã«ä¿å­˜ãƒ»ä¼é€ã™ã‚‹ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³å½¢å¼ã§ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// JWTã®æ§‹é€ ä¾‹\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9. // ãƒ˜ãƒƒãƒ€ãƒ¼\neyJpZCI6IjEyMyIsIm5hbWUiOiJKb2huIn0.   // ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰\nSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV     // ç½²åï¼ˆæ”¹ã–ã‚“é˜²æ­¢ï¼‰\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eJWTã®ãƒ¡ãƒªãƒƒãƒˆ\u003c/strong\u003eï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eğŸ”’ æ”¹ã–ã‚“ã‚’æ¤œå‡ºã§ãã‚‹\u003c/li\u003e\n\u003cli\u003eğŸ“¦ ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹èªè¨¼ãŒå¯èƒ½\u003c/li\u003e\n\u003cli\u003eâ° æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã§ãã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"oauthã‚ªãƒ¼ã‚ªãƒ¼ã‚¹ã¨ã¯\"\u003eOAuthï¼ˆã‚ªãƒ¼ã‚ªãƒ¼ã‚¹ï¼‰ã¨ã¯ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eç°¡å˜ã«è¨€ã†ã¨\u003c/strong\u003e: ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å®‰å…¨ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ä»•çµ„ã¿ã§ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eå¾“æ¥ã®ãƒ­ã‚°ã‚¤ãƒ³:\n1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›\n2. ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›\n3. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ç®¡ç†ãŒå¿…è¦\n\nOAuthèªè¨¼:\n1. ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯\n2. Googleã§èªè¨¼ï¼ˆæ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½¿ç”¨ï¼‰\n3. ã‚¢ãƒ—ãƒªã«è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³å®Œäº†\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"ãªãœoauth\"\u003eãªãœOAuthï¼Ÿ\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒªãƒƒãƒˆ\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¦šãˆã‚‹å¿…è¦ãŒãªã„\u003c/li\u003e\n\u003cli\u003eæ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãŒä¸è¦\u003c/li\u003e\n\u003cli\u003eä¿¡é ¼ã§ãã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆGoogleï¼‰ã®é«˜ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eé–‹ç™ºè€…ã®ãƒ¡ãƒªãƒƒãƒˆ\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ã®è²¬ä»»ãŒè»½æ¸›\u003c/li\u003e\n\u003cli\u003eãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®ãƒãƒ¼ãƒ‰ãƒ«ãŒä¸‹ãŒã‚‹\u003c/li\u003e\n\u003cli\u003eé«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’åˆ©ç”¨å¯èƒ½\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"-ç›®æ¬¡\"\u003eğŸ“š ç›®æ¬¡\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A6%82%E8%A6%81%E3%81%A8%E8%A6%81%E4%BB%B6\"\u003eãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨è¦ä»¶\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#google-cloud-console%E8%A8%AD%E5%AE%9A\"\u003eGoogle Cloud Consoleè¨­å®š\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E5%AE%9F%E8%A3%85\"\u003eãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E5%AE%9F%E8%A3%85\"\u003eãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E8%80%83%E6%85%AE%E4%BA%8B%E9%A0%85\"\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8%E3%83%87%E3%83%90%E3%83%83%E3%82%B0\"\u003eãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%83%88%E3%83%A9%E3%83%96%E3%83%AB%E3%82%B7%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003eãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%E3%81%BE%E3%81%A8%E3%82%81\"\u003eã¾ã¨ã‚\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨è¦ä»¶\"\u003eãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã¨è¦ä»¶\u003c/h2\u003e\n\u003ch3 id=\"ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ\"\u003eã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003eãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ\nâ”œâ”€â”€ Backend: Node.js + Express + TypeScript\nâ”œâ”€â”€ Frontend: React + TypeScript\nâ”œâ”€â”€ Database: PostgreSQL\nâ””â”€â”€ èªè¨¼: Google OAuth 2.0 + JWT\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"å®Ÿè£…è¦ä»¶\"\u003eå®Ÿè£…è¦ä»¶\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-markdown\"\u003e## æ©Ÿèƒ½è¦ä»¶\n- Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒ­ã‚°ã‚¤ãƒ³\n- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è‡ªå‹•å–å¾—ãƒ»ä¿å­˜\n- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç¶­æŒï¼ˆè‡ªå‹•ãƒ­ã‚°ã‚¤ãƒ³ï¼‰\n- ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n\n## éæ©Ÿèƒ½è¦ä»¶\n- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: HTTPOnly Cookie + JWT\n- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: èªè¨¼æ™‚é–“ \u0026#x3C; 3ç§’\n- ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£: ç›´æ„Ÿçš„ãªUI\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"-httponly-cookieã¨ã¯\"\u003eğŸª HTTPOnly Cookieã¨ã¯ï¼Ÿ\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eHTTPOnly Cookie\u003c/strong\u003eã¯ã€JavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ç‰¹åˆ¥ãªCookieã§ã™ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// é€šå¸¸ã®Cookieï¼ˆå±é™ºï¼‰\ndocument.cookie = \"token=abc123\"; // JavaScriptã§èª­ã¿æ›¸ãå¯èƒ½\nconsole.log(document.cookie); // \"token=abc123\" ãŒè¡¨ç¤ºã•ã‚Œã‚‹\n\n// HTTPOnly Cookieï¼ˆå®‰å…¨ï¼‰\n// ã‚µãƒ¼ãƒãƒ¼å´ã§ã®ã¿è¨­å®šå¯èƒ½\nres.cookie('token', 'abc123', { httpOnly: true });\n// JavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯\nconsole.log(document.cookie); // è¡¨ç¤ºã•ã‚Œãªã„ï¼\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eãªãœHTTPOnly CookieãŒå®‰å…¨ï¼Ÿ\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eğŸ˜ˆ XSSæ”»æ’ƒ: æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãƒšãƒ¼ã‚¸ã«æ³¨å…¥ã•ã‚Œã‚‹æ”»æ’ƒ\u003c/li\u003e\n\u003cli\u003eğŸ›¡ï¸ HTTPOnly: JavaScriptã‹ã‚‰èª­ã‚ãªã„ã®ã§ã€æ”»æ’ƒè€…ã‚‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç›—ã‚ãªã„\u003c/li\u003e\n\u003cli\u003eâœ… ã‚µãƒ¼ãƒãƒ¼ã®ã¿: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã§ã®ã¿é€ä¿¡ã•ã‚Œã‚‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"google-cloud-consoleè¨­å®š\"\u003eGoogle Cloud Consoleè¨­å®š\u003c/h2\u003e\n\u003ch3 id=\"1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\"\u003e1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Google Cloud Console ã§ã®æ‰‹é †\n1. https://console.cloud.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹\n2. æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\n3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå: \"your-project-auth\" (ä»»æ„ã®åå‰)\n4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"2-oauth-20èªè¨¼æƒ…å ±ã®è¨­å®š\"\u003e2. OAuth 2.0èªè¨¼æƒ…å ±ã®è¨­å®š\u003c/h3\u003e\n\u003cp\u003eèªè¨¼æƒ…å ±ã¯\u003ccode\u003e.env\u003c/code\u003eãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# .envãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ï¼‰\nGOOGLE_CLIENT_ID=\"your-client-id.apps.googleusercontent.com\"\nGOOGLE_CLIENT_SECRET=\"your-client-secret\"\nGOOGLE_REDIRECT_URI=\"http://localhost:3000/api/auth/google/callback\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eGoogle Cloud Consoleã§ã®è¨­å®šé …ç›®ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// è¨­å®šé …ç›®\nconst OAUTH_CONFIG = {\n  // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å\n  applicationName: \"Your App Name\",\n  \n  // æ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI\n  redirectURIs: [\n    \"http://localhost:3000/api/auth/google/callback\", // é–‹ç™ºç’°å¢ƒ\n    \"https://yourdomain.com/api/auth/google/callback\" // æœ¬ç•ªç’°å¢ƒ\n  ],\n  \n  // æ‰¿èªæ¸ˆã¿ã® JavaScript ç”Ÿæˆå…ƒ\n  origins: [\n    \"http://localhost:3001\", // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º\n    \"https://yourdomain.com\"  // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœ¬ç•ª\n  ]\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"3-ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š\"\u003e3. ã‚¹ã‚³ãƒ¼ãƒ—è¨­å®š\u003c/h3\u003e\n\u003cp\u003eã‚¹ã‚³ãƒ¼ãƒ—è¨­å®šã¯ã‚³ãƒ¼ãƒ‰å†…ã§æŒ‡å®šã—ã¾ã™ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// src/config/auth.js ã¾ãŸã¯ src/auth/passport.js\n// å–å¾—ã™ã‚‹æƒ…å ±ã®ç¯„å›²\nconst OAUTH_SCOPES = [\n  'profile', // åŸºæœ¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±\n  'email'    // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹\n];\n\n// å®Ÿéš›ã«å–å¾—ã§ãã‚‹æƒ…å ±\nconst USER_PROFILE = {\n  id: \"googleã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID\",\n  email: \"user@gmail.com\",\n  displayName: \"ãƒ¦ãƒ¼ã‚¶ãƒ¼å\",\n  photos: [\"ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL\"]\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…\"\u003eãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…\u003c/h2\u003e\n\u003ch3 id=\"1-ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\"\u003e1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸\nnpm install passport passport-google-oauth20 jsonwebtoken\nnpm install express-session cookie-parser\nnpm install @types/passport @types/passport-google-oauth20 @types/jsonwebtoken\n\n# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£\nnpm install helmet cors express-rate-limit\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"2-ç’°å¢ƒå¤‰æ•°è¨­å®š\"\u003e2. ç’°å¢ƒå¤‰æ•°è¨­å®š\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# .env\nGOOGLE_CLIENT_ID=your_google_client_id\nGOOGLE_CLIENT_SECRET=your_google_client_secret\nJWT_SECRET=your_super_secure_jwt_secret_key_here\nFRONTEND_URL=http://localhost:3001\nBACKEND_URL=http://localhost:3000\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"3-passportjsè¨­å®š\"\u003e3. Passport.jsè¨­å®š\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// backend/src/config/passport.ts\nimport passport from 'passport';\nimport { Strategy as GoogleStrategy } from 'passport-google-oauth20';\nimport jwt from 'jsonwebtoken';\nimport { findUserByGoogleId, createUserFromGoogleProfile } from '../services/userService';\n\n// Google OAuthæˆ¦ç•¥ï¼ˆStrategyï¼‰ã®è¨­å®š\n// æˆ¦ç•¥ãƒ‘ã‚¿ãƒ¼ãƒ³: èªè¨¼æ–¹æ³•ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«ã™ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³\npassport.use(new GoogleStrategy({\n  clientID: process.env.GOOGLE_CLIENT_ID!,\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n  callbackURL: '/api/auth/google/callback'\n}, async (accessToken, refreshToken, profile, done) =\u003e {\n  try {\n    console.log('Google Profile:', profile);\n    \n    // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¤œç´¢\n    let user = await findUserByGoogleId(profile.id);\n    \n    if (!user) {\n      // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ\n      user = await createUserFromGoogleProfile({\n        googleId: profile.id,\n        email: profile.emails?.[0]?.value || '',\n        username: profile.displayName || '',\n        avatar_url: profile.photos?.[0]?.value || ''\n      });\n      \n      console.log('æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ:', user);\n    } else {\n      console.log('æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼:', user);\n    }\n    \n    return done(null, user);\n  } catch (error) {\n    console.error('OAuthèªè¨¼ã‚¨ãƒ©ãƒ¼:', error);\n    return done(error, null);\n  }\n}));\n\n// JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆé–¢æ•°\nexport const generateToken = (user: any): string =\u003e {\n  const payload = {\n    id: user.id,\n    email: user.email,\n    username: user.username,\n    iat: Math.floor(Date.now() / 1000),\n  };\n\n  return jwt.sign(payload, process.env.JWT_SECRET!, {\n    expiresIn: '15m', // 15åˆ†ã§æœŸé™åˆ‡ã‚Œ\n    issuer: 'drill-layer',\n    audience: 'drill-layer-app',\n    algorithm: 'HS256'\n  });\n};\n\n// JWTæ¤œè¨¼é–¢æ•°\nexport const verifyToken = (token: string): any =\u003e {\n  try {\n    return jwt.verify(token, process.env.JWT_SECRET!);\n  } catch (error) {\n    throw new Error('ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³');\n  }\n};\n\nexport default passport;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"4-èªè¨¼ãƒ«ãƒ¼ãƒˆå®Ÿè£…\"\u003e4. èªè¨¼ãƒ«ãƒ¼ãƒˆå®Ÿè£…\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// backend/src/routes/authRoutes.ts\nimport { Router } from 'express';\nimport passport from '../config/passport';\nimport { generateToken } from '../config/passport';\nimport { authenticateToken } from '../middleware/auth';\n\nconst router = Router();\n\n/**\n * Google OAuthèªè¨¼é–‹å§‹\n * GET /api/auth/google\n */\nrouter.get('/google', passport.authenticate('google', {\n  scope: ['profile', 'email']\n}));\n\n/**\n * Google OAuthèªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n * GET /api/auth/google/callback\n */\nrouter.get('/google/callback', (req, res, next) =\u003e {\n  console.log('=== OAuth Callbacké–‹å§‹ ===');\n  \n  passport.authenticate('google', { session: false }, (err, user, info) =\u003e {\n    if (err) {\n      console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', err);\n      return res.redirect(`${process.env.FRONTEND_URL}/auth/error?error=passport_error`);\n    }\n    \n    if (!user) {\n      console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼å¤±æ•—:', info);\n      return res.redirect(`${process.env.FRONTEND_URL}/auth/error?error=no_user`);\n    }\n\n    try {\n      // JWTãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ\n      const token = generateToken(user);\n      console.log('ãƒˆãƒ¼ã‚¯ãƒ³ç”ŸæˆæˆåŠŸ');\n      \n      // HTTPOnly Cookieã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šï¼ˆã‚»ã‚­ãƒ¥ã‚¢ï¼‰\n      res.cookie('access_token', token, {\n        httpOnly: true, // JavaScriptã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯ã«ã—ã¦XSSæ”»æ’ƒã‚’é˜²ã\n        // XSSæ”»æ’ƒ: æ‚ªæ„ã®ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒCookieã‚’ç›—ã‚€æ”»æ’ƒ\n        // httpOnlyè¨­å®šã«ã‚ˆã‚Šã€document.cookieã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã‚‹\n        \n        secure: process.env.NODE_ENV === 'production', // HTTPSå¿…é ˆï¼ˆæœ¬ç•ªï¼‰\n        \n        sameSite: 'strict', // ç•°ãªã‚‹ã‚µã‚¤ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§Cookieã‚’é€ä¿¡ã—ãªã„\n        // CSRFæ”»æ’ƒ: å½ã‚µã‚¤ãƒˆã‹ã‚‰æœ¬ç‰©ã®ã‚µã‚¤ãƒˆã¸ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹æ”»æ’ƒ\n        // strictã«ã‚ˆã‚Šã€å¤–éƒ¨ã‚µã‚¤ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯CookieãŒé€ä¿¡ã•ã‚Œãªã„\n        \n        maxAge: 15 * 60 * 1000, // 15åˆ†\n        path: '/'\n      });\n\n      // ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã¯å«ã‚ãªã„ï¼‰\n      const redirectUrl = `${process.env.FRONTEND_URL}/auth/callback?success=true`;\n      console.log('ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ:', redirectUrl);\n      \n      res.redirect(redirectUrl);\n      console.log('=== OAuth Callbackå®Œäº† ===');\n    } catch (error) {\n      console.error('ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);\n      res.redirect(`${process.env.FRONTEND_URL}/auth/error?error=token_generation`);\n    }\n  })(req, res, next);\n});\n\n/**\n * ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—\n * GET /api/auth/me\n */\nrouter.get('/me', authenticateToken, (req: any, res) =\u003e {\n  console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—:', req.user);\n  res.json(req.user);\n});\n\n/**\n * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n * POST /api/auth/logout\n */\nrouter.post('/logout', (req, res) =\u003e {\n  // Cookieã‚’ã‚¯ãƒªã‚¢\n  res.clearCookie('access_token', {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    path: '/'\n  });\n  \n  res.json({ message: 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ' });\n});\n\nexport default router;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"5-èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢\"\u003e5. èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// backend/src/middleware/auth.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { verifyToken } from '../config/passport';\n\n// ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä»˜ãï¼‰\ninterface AuthRequest extends Request {\n  user?: any;\n}\n\n/**\n * JWTãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢\n */\nexport const authenticateToken = (req: AuthRequest, res: Response, next: NextFunction) =\u003e {\n  try {\n    // Cookieã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—\n    const token = req.cookies?.access_token;\n    \n    if (!token) {\n      return res.status(401).json({ error: 'ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™' });\n    }\n\n    // ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼\n    const decoded = verifyToken(token);\n    req.user = decoded;\n    \n    console.log('èªè¨¼æˆåŠŸ:', decoded);\n    next();\n  } catch (error) {\n    console.error('èªè¨¼å¤±æ•—:', error);\n    \n    // æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ç‰¹åˆ¥ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\n    if (error.name === 'TokenExpiredError') {\n      return res.status(401).json({ error: 'ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã§ã™' });\n    }\n    \n    return res.status(403).json({ error: 'ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã§ã™' });\n  }\n};\n\n/**\n * ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«èªè¨¼ï¼ˆèªè¨¼ãŒãªãã¦ã‚‚é€šã™ï¼‰\n */\nexport const optionalAuth = (req: AuthRequest, res: Response, next: NextFunction) =\u003e {\n  const token = req.cookies?.access_token;\n  \n  if (token) {\n    try {\n      const decoded = verifyToken(token);\n      req.user = decoded;\n    } catch (error) {\n      // ã‚¨ãƒ©ãƒ¼ã§ã‚‚å‡¦ç†ã‚’ç¶šè¡Œ\n      console.log('ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«èªè¨¼ï¼‰');\n    }\n  }\n  \n  next();\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"6-ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…\"\u003e6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// backend/src/services/userService.ts\nimport { pool } from '../config/database';\n\nexport interface User {\n  id: string;\n  googleId: string;\n  email: string;\n  username: string;\n  avatar_url?: string;\n  created_at: Date;\n  updated_at: Date;\n}\n\nexport interface CreateUserParams {\n  googleId: string;\n  email: string;\n  username: string;\n  avatar_url?: string;\n}\n\n/**\n * Google IDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢\n */\nexport const findUserByGoogleId = async (googleId: string): Promise\u0026#x3C;User | null\u003e =\u003e {\n  try {\n    const query = 'SELECT * FROM users WHERE google_id = $1';\n    const result = await pool.query(query, [googleId]);\n    \n    return result.rows[0] || null;\n  } catch (error) {\n    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);\n    throw error;\n  }\n};\n\n/**\n * Googleãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‹ã‚‰æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ\n */\nexport const createUserFromGoogleProfile = async (params: CreateUserParams): Promise\u0026#x3C;User\u003e =\u003e {\n  try {\n    const { googleId, email, username, avatar_url } = params;\n    \n    const query = `\n      INSERT INTO users (google_id, email, username, avatar_url, created_at, updated_at)\n      VALUES ($1, $2, $3, $4, NOW(), NOW())\n      RETURNING *\n    `;\n    \n    const values = [googleId, email, username, avatar_url || null];\n    const result = await pool.query(query, values);\n    \n    return result.rows[0];\n  } catch (error) {\n    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼:', error);\n    throw error;\n  }\n};\n\n/**\n * ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—\n */\nexport const findUserById = async (userId: string): Promise\u0026#x3C;User | null\u003e =\u003e {\n  try {\n    const query = 'SELECT * FROM users WHERE id = $1';\n    const result = await pool.query(query, [userId]);\n    \n    return result.rows[0] || null;\n  } catch (error) {\n    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼:', error);\n    throw error;\n  }\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…\"\u003eãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…\u003c/h2\u003e\n\u003ch3 id=\"1-èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ\"\u003e1. èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// frontend/src/contexts/AuthContext.tsx\nimport React, { createContext, useContext, useEffect, useState } from 'react';\n\ninterface User {\n  id: string;\n  email: string;\n  username: string;\n  avatar_url?: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isLoading: boolean;\n  login: () =\u003e void;\n  logout: () =\u003e Promise\u0026#x3C;void\u003e;\n  checkAuth: () =\u003e Promise\u0026#x3C;void\u003e;\n}\n\nconst AuthContext = createContext\u0026#x3C;AuthContextType | undefined\u003e(undefined);\n\nexport const useAuth = () =\u003e {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider: React.FC\u0026#x3C;{ children: React.ReactNode }\u003e = ({ children }) =\u003e {\n  const [user, setUser] = useState\u0026#x3C;User | null\u003e(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  /**\n   * èªè¨¼çŠ¶æ…‹ã®ç¢ºèª\n   */\n  const checkAuth = async () =\u003e {\n    try {\n      const response = await fetch(`${process.env.REACT_APP_API_URL}/api/auth/me`, {\n        method: 'GET',\n        credentials: 'include', // Cookieã‚’å«ã‚ã‚‹\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n        console.log('èªè¨¼ç¢ºèªæˆåŠŸ:', userData);\n      } else {\n        setUser(null);\n        console.log('æœªèªè¨¼çŠ¶æ…‹');\n      }\n    } catch (error) {\n      console.error('èªè¨¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);\n      setUser(null);\n    }\n  };\n\n  /**\n   * ãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹ï¼ˆGoogleã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰\n   */\n  const login = () =\u003e {\n    const googleAuthUrl = `${process.env.REACT_APP_API_URL}/api/auth/google`;\n    console.log('Googleãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹:', googleAuthUrl);\n    window.location.href = googleAuthUrl;\n  };\n\n  /**\n   * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n   */\n  const logout = async () =\u003e {\n    try {\n      await fetch(`${process.env.REACT_APP_API_URL}/api/auth/logout`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n\n      setUser(null);\n      console.log('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ');\n    } catch (error) {\n      console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:', error);\n    }\n  };\n\n  // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã«èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª\n  useEffect(() =\u003e {\n    const initAuth = async () =\u003e {\n      await checkAuth();\n      setIsLoading(false);\n    };\n\n    initAuth();\n  }, []);\n\n  const value = {\n    user,\n    isLoading,\n    login,\n    logout,\n    checkAuth\n  };\n\n  return (\n    \u0026#x3C;AuthContext.Provider value={value}\u003e\n      {children}\n    \u0026#x3C;/AuthContext.Provider\u003e\n  );\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"2-ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å®Ÿè£…\"\u003e2. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸å®Ÿè£…\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// frontend/src/pages/LoginPage.tsx\nimport React from 'react';\nimport { useAuth } from '../contexts/AuthContext';\nimport { Navigate } from 'react-router-dom';\n\nconst LoginPage: React.FC = () =\u003e {\n  const { user, isLoading, login } = useAuth();\n\n  // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ\n  if (user) {\n    return \u0026#x3C;Navigate to=\"/materials\" replace /\u003e;\n  }\n\n  if (isLoading) {\n    return (\n      \u0026#x3C;div className=\"min-h-screen flex items-center justify-center\"\u003e\n        \u0026#x3C;div className=\"animate-pulse\"\u003eèªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...\u0026#x3C;/div\u003e\n      \u0026#x3C;/div\u003e\n    );\n  }\n\n  return (\n    \u0026#x3C;div className=\"min-h-screen flex items-center justify-center bg-gray-50\"\u003e\n      \u0026#x3C;div className=\"max-w-md w-full space-y-8 p-8\"\u003e\n        \u0026#x3C;div className=\"text-center\"\u003e\n          \u0026#x3C;h1 className=\"text-3xl font-bold text-gray-900 mb-2\"\u003e\n            My App\n          \u0026#x3C;/h1\u003e\n          \u0026#x3C;p className=\"text-gray-600\"\u003e\n            æ•™æå…±æœ‰ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³\n          \u0026#x3C;/p\u003e\n        \u0026#x3C;/div\u003e\n\n        \u0026#x3C;div className=\"space-y-4\"\u003e\n          \u0026#x3C;GoogleLoginButton onClick={login} /\u003e\n          \n          \u0026#x3C;div className=\"text-center text-sm text-gray-500\"\u003e\n            ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã§ã€\n            \u0026#x3C;a href=\"/terms\" className=\"text-blue-600 hover:underline\"\u003eåˆ©ç”¨è¦ç´„\u0026#x3C;/a\u003e\n            ãŠã‚ˆã³\n            \u0026#x3C;a href=\"/privacy\" className=\"text-blue-600 hover:underline\"\u003eãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼\u0026#x3C;/a\u003e\n            ã«åŒæ„ã—ãŸã‚‚ã®ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚\n          \u0026#x3C;/div\u003e\n        \u0026#x3C;/div\u003e\n      \u0026#x3C;/div\u003e\n    \u0026#x3C;/div\u003e\n  );\n};\n\n/**\n * Googleãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n */\nconst GoogleLoginButton: React.FC\u0026#x3C;{ onClick: () =\u003e void }\u003e = ({ onClick }) =\u003e {\n  return (\n    \u0026#x3C;button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors\"\n    \u003e\n      \u0026#x3C;svg className=\"w-5 h-5 mr-3\" viewBox=\"0 0 24 24\"\u003e\n        \u0026#x3C;path\n          fill=\"currentColor\"\n          d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n        /\u003e\n        \u0026#x3C;path\n          fill=\"currentColor\"\n          d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n        /\u003e\n        \u0026#x3C;path\n          fill=\"currentColor\"\n          d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n        /\u003e\n        \u0026#x3C;path\n          fill=\"currentColor\"\n          d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n        /\u003e\n      \u0026#x3C;/svg\u003e\n      Googleã§ãƒ­ã‚°ã‚¤ãƒ³\n    \u0026#x3C;/button\u003e\n  );\n};\n\nexport default LoginPage;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"3-èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†\"\u003e3. èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// frontend/src/pages/AuthCallbackPage.tsx\nimport React, { useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\nimport { useAuth } from '../contexts/AuthContext';\n\nconst AuthCallbackPage: React.FC = () =\u003e {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const { checkAuth } = useAuth();\n\n  useEffect(() =\u003e {\n    const handleCallback = async () =\u003e {\n      const success = searchParams.get('success');\n      const error = searchParams.get('error');\n\n      if (error) {\n        console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);\n        navigate('/login?error=auth_failed');\n        return;\n      }\n\n      if (success === 'true') {\n        console.log('èªè¨¼æˆåŠŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­...');\n        \n        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªï¼ˆCookieãŒè¨­å®šã•ã‚Œã‚‹ã¾ã§ï¼‰\n        setTimeout(async () =\u003e {\n          await checkAuth();\n          navigate('/materials');\n        }, 500);\n      } else {\n        console.error('ä¸æ˜ãªèªè¨¼çŠ¶æ…‹');\n        navigate('/login');\n      }\n    };\n\n    handleCallback();\n  }, [searchParams, navigate, checkAuth]);\n\n  return (\n    \u0026#x3C;div className=\"min-h-screen flex items-center justify-center\"\u003e\n      \u0026#x3C;div className=\"text-center\"\u003e\n        \u0026#x3C;div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"\u003e\u0026#x3C;/div\u003e\n        \u0026#x3C;p className=\"text-gray-600\"\u003eèªè¨¼å‡¦ç†ä¸­...\u0026#x3C;/p\u003e\n      \u0026#x3C;/div\u003e\n    \u0026#x3C;/div\u003e\n  );\n};\n\nexport default AuthCallbackPage;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"4-ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆ\"\u003e4. ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// frontend/src/components/ProtectedRoute.tsx\nimport React from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { useAuth } from '../contexts/AuthContext';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n}\n\nconst ProtectedRoute: React.FC\u0026#x3C;ProtectedRouteProps\u003e = ({ children }) =\u003e {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      \u0026#x3C;div className=\"min-h-screen flex items-center justify-center\"\u003e\n        \u0026#x3C;div className=\"animate-pulse\"\u003eèªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...\u0026#x3C;/div\u003e\n      \u0026#x3C;/div\u003e\n    );\n  }\n\n  if (!user) {\n    return \u0026#x3C;Navigate to=\"/login\" replace /\u003e;\n  }\n\n  return \u0026#x3C;\u003e{children}\u0026#x3C;/\u003e;\n};\n\nexport default ProtectedRoute;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"5-ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\"\u003e5. ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// frontend/src/components/Header.tsx\nimport React from 'react';\nimport { useAuth } from '../contexts/AuthContext';\n\nconst Header: React.FC = () =\u003e {\n  const { user, logout } = useAuth();\n\n  const handleLogout = async () =\u003e {\n    if (window.confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {\n      await logout();\n    }\n  };\n\n  return (\n    \u0026#x3C;header className=\"bg-white shadow-sm border-b\"\u003e\n      \u0026#x3C;div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\"\u003e\n        \u0026#x3C;div className=\"flex justify-between items-center h-16\"\u003e\n          \u0026#x3C;div className=\"flex items-center\"\u003e\n            \u0026#x3C;h1 className=\"text-xl font-bold text-blue-600\"\u003eMy App\u0026#x3C;/h1\u003e\n          \u0026#x3C;/div\u003e\n\n          {user \u0026#x26;\u0026#x26; (\n            \u0026#x3C;div className=\"flex items-center space-x-4\"\u003e\n              \u0026#x3C;div className=\"flex items-center space-x-2\"\u003e\n                {user.avatar_url \u0026#x26;\u0026#x26; (\n                  \u0026#x3C;img\n                    src={user.avatar_url}\n                    alt={user.username}\n                    className=\"h-8 w-8 rounded-full\"\n                  /\u003e\n                )}\n                \u0026#x3C;span className=\"text-sm font-medium text-gray-700\"\u003e\n                  {user.username}\n                \u0026#x3C;/span\u003e\n              \u0026#x3C;/div\u003e\n              \n              \u0026#x3C;button\n                onClick={handleLogout}\n                className=\"text-sm text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md hover:bg-gray-100\"\n              \u003e\n                ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\n              \u0026#x3C;/button\u003e\n            \u0026#x3C;/div\u003e\n          )}\n        \u0026#x3C;/div\u003e\n      \u0026#x3C;/div\u003e\n    \u0026#x3C;/header\u003e\n  );\n};\n\nexport default Header;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …\"\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …\u003c/h2\u003e\n\u003ch3 id=\"1-httponly-cookie-ã®ä½¿ç”¨\"\u003e1. HTTPOnly Cookie ã®ä½¿ç”¨\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// âŒ å±é™º: localStorage ã« JWT ã‚’ä¿å­˜\nlocalStorage.setItem('token', jwt);\n\n// âœ… å®‰å…¨: HTTPOnly Cookie ã«ä¿å­˜\nres.cookie('access_token', token, {\n  httpOnly: true,     // JavaScript ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯\n  secure: true,       // HTTPS ã§ã®ã¿é€ä¿¡\n  sameSite: 'strict', // CSRF æ”»æ’ƒã‚’é˜²ã\n  maxAge: 15 * 60 * 1000 // 15åˆ†ã§æœŸé™åˆ‡ã‚Œ\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"2-ãƒˆãƒ¼ã‚¯ãƒ³ã®çŸ­æœŸé–“æœ‰åŠ¹æ€§\"\u003e2. ãƒˆãƒ¼ã‚¯ãƒ³ã®çŸ­æœŸé–“æœ‰åŠ¹æ€§\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// çŸ­æœŸé–“ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ + é•·æœŸé–“ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³\nconst accessToken = jwt.sign(payload, secret, { expiresIn: '15m' });\nconst refreshToken = crypto.randomBytes(64).toString('hex');\n\n// ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜\nawait saveRefreshToken(user.id, refreshToken);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"3-corsè¨­å®š\"\u003e3. CORSè¨­å®š\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// backend/src/app.ts\nimport cors from 'cors';\n\napp.use(cors({\n  origin: process.env.FRONTEND_URL, // ç‰¹å®šã®ã‚ªãƒªã‚¸ãƒ³ã®ã¿è¨±å¯\n  credentials: true, // Cookie ã®é€ä¿¡ã‚’è¨±å¯\n  optionsSuccessStatus: 200\n}));\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°\"\u003eãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒãƒƒã‚°\u003c/h2\u003e\n\u003ch3 id=\"1-é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ\"\u003e1. é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰èµ·å‹•\ncd backend\nnpm run dev\n\n# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•\ncd frontend\nnpm start\n\n# ãƒ†ã‚¹ãƒˆæ‰‹é †\n1. http://localhost:3001/login ã«ã‚¢ã‚¯ã‚»ã‚¹\n2. \"Googleã§ãƒ­ã‚°ã‚¤ãƒ³\" ã‚’ã‚¯ãƒªãƒƒã‚¯\n3. Googleèªè¨¼ãƒšãƒ¼ã‚¸ã§èªè¨¼\n4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ\n5. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"2-ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°\"\u003e2. ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ã‚°\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›\nconsole.log('=== OAuth Debug Info ===');\nconsole.log('Request URL:', req.originalUrl);\nconsole.log('User Profile:', profile);\nconsole.log('Generated Token:', token.substring(0, 50) + '...');\nconsole.log('Cookie Settings:', {\n  httpOnly: true,\n  secure: process.env.NODE_ENV === 'production',\n  sameSite: 'strict'\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"3-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°\"\u003e3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°\npassport.authenticate('google', (err, user, info) =\u003e {\n  if (err) {\n    console.error('Passport Error:', err);\n    return res.redirect('/auth/error?type=passport');\n  }\n  \n  if (!user) {\n    console.error('No User:', info);\n    return res.redirect('/auth/error?type=no_user');\n  }\n  \n  // æˆåŠŸæ™‚ã®å‡¦ç†\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\"\u003eãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\u003c/h2\u003e\n\u003ch3 id=\"ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•\"\u003eã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ³•\u003c/h3\u003e\n\u003ch4 id=\"1-redirect_uri_mismatch-ã‚¨ãƒ©ãƒ¼\"\u003e1. \"redirect_uri_mismatch\" ã‚¨ãƒ©ãƒ¼\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eåŸå› \u003c/strong\u003e: Google Cloud Console ã®è¨­å®šã¨ã‚¢ãƒ—ãƒªã® URL ãŒä¸€è‡´ã—ãªã„\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè§£æ±ºæ³•\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Google Cloud Console ã§ç¢ºèªãƒ»ä¿®æ­£\næ‰¿èªæ¸ˆã¿ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI:\n- http://localhost:3000/api/auth/google/callback (é–‹ç™º)\n- https://yourdomain.com/api/auth/google/callback (æœ¬ç•ª)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"2-cookie-ãŒè¨­å®šã•ã‚Œãªã„\"\u003e2. Cookie ãŒè¨­å®šã•ã‚Œãªã„\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eåŸå› \u003c/strong\u003e: CORS è¨­å®šã¾ãŸã¯Cookieè¨­å®šã®å•é¡Œ\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè§£æ±ºæ³•\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: CORSè¨­å®š\napp.use(cors({\n  origin: 'http://localhost:3001',\n  credentials: true // é‡è¦: Cookieé€ä¿¡ã‚’è¨±å¯\n}));\n\n// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: fetchè¨­å®š\nfetch('/api/auth/me', {\n  credentials: 'include' // é‡è¦: Cookieã‚’å«ã‚ã‚‹\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"3-https-ã§ã®ã¿å‹•ä½œã™ã‚‹å•é¡Œ\"\u003e3. HTTPS ã§ã®ã¿å‹•ä½œã™ã‚‹å•é¡Œ\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eåŸå› \u003c/strong\u003e: æœ¬ç•ªç’°å¢ƒã§ã¯ secure ãƒ•ãƒ©ã‚°ãŒå¿…è¦\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eè§£æ±ºæ³•\u003c/strong\u003e:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003eres.cookie('access_token', token, {\n  secure: process.env.NODE_ENV === 'production',\n  sameSite: process.env.NODE_ENV === 'production' ? 'strict' : 'lax'\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"4-ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã‚¨ãƒ©ãƒ¼\"\u003e4. ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã‚¨ãƒ©ãƒ¼\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003eè§£æ±ºæ³•\u003c/strong\u003e: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003e// è‡ªå‹•çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°\nconst refreshAuthToken = async () =\u003e {\n  try {\n    const response = await fetch('/api/auth/refresh', {\n      method: 'POST',\n      credentials: 'include'\n    });\n    \n    if (response.ok) {\n      return true; // æ›´æ–°æˆåŠŸ\n    }\n  } catch (error) {\n    console.error('Token refresh failed:', error);\n  }\n  \n  return false; // æ›´æ–°å¤±æ•—ã€å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„\"\u003eãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„\u003c/h3\u003e\n\u003ch4 id=\"1-ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã®ç¢ºèª\"\u003e1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã®ç¢ºèª\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Chrome DevTools \u003e Network ã‚¿ãƒ–ã§ç¢ºèª\n1. /api/auth/google ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ\n2. Googleèªè¨¼ãƒšãƒ¼ã‚¸ã§ã®èªè¨¼\n3. /api/auth/google/callback ã¸ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ\n5. /api/auth/me ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"2-application-ã‚¿ãƒ–ã§cookieç¢ºèª\"\u003e2. Application ã‚¿ãƒ–ã§Cookieç¢ºèª\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Chrome DevTools \u003e Application \u003e Cookies\naccess_token ã®å­˜åœ¨ã¨å±æ€§ã‚’ç¢ºèª:\n- HttpOnly: âœ“\n- Secure: âœ“ (æœ¬ç•ªç’°å¢ƒ)\n- SameSite: Strict\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"ã¾ã¨ã‚\"\u003eã¾ã¨ã‚\u003c/h2\u003e\n\u003cp\u003eã“ã®è¨˜äº‹ã§ã¯ã€Google OAuthèªè¨¼ã®å®Œå…¨å®Ÿè£…ã‚’æ®µéšçš„ã«è§£èª¬ã—ã¾ã—ãŸã€‚\u003c/p\u003e\n\u003ch3 id=\"-å®Ÿè£…ã§ããŸã‚‚ã®\"\u003eğŸ¯ å®Ÿè£…ã§ããŸã‚‚ã®\u003c/h3\u003e\n\u003ch4 id=\"æ©Ÿèƒ½é¢\"\u003eæ©Ÿèƒ½é¢\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯èªè¨¼\u003c/strong\u003e: Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ç°¡å˜ãƒ­ã‚°ã‚¤ãƒ³\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eè‡ªå‹•ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†\u003c/strong\u003e: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®è‡ªå‹•å–å¾—ãƒ»ä¿å­˜\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†\u003c/strong\u003e: ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®è‡ªå‹•ç¶­æŒ\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eã‚»ã‚­ãƒ¥ã‚¢ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ\u003c/strong\u003e: å®Œå…¨ãªã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢\"\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eHTTPOnly Cookie\u003c/strong\u003e: XSSæ”»æ’ƒè€æ€§\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCSRFä¿è­·\u003c/strong\u003e: SameSite Cookieå±æ€§\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eçŸ­æœŸé–“ãƒˆãƒ¼ã‚¯ãƒ³\u003c/strong\u003e: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯è»½æ¸›\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eHTTPSå¼·åˆ¶\u003c/strong\u003e: é€šä¿¡ã®æš—å·åŒ–\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-å°å…¥åŠ¹æœ\"\u003eğŸ“ˆ å°å…¥åŠ¹æœ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“\u003c/strong\u003e: ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ™‚é–“90%çŸ­ç¸®\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£\u003c/strong\u003e: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«ã®èªè¨¼\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eé–‹ç™ºåŠ¹ç‡\u003c/strong\u003e: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç®¡ç†ã‹ã‚‰è§£æ”¾\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eé‹ç”¨ã‚³ã‚¹ãƒˆ\u003c/strong\u003e: èªè¨¼é–¢é€£ã‚µãƒãƒ¼ãƒˆ80%å‰Šæ¸›\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"-ã•ã‚‰ãªã‚‹æ”¹å–„æ¡ˆ\"\u003eğŸš€ ã•ã‚‰ãªã‚‹æ”¹å–„æ¡ˆ\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eå¤šè¦ç´ èªè¨¼ï¼ˆMFAï¼‰\u003c/strong\u003e: ã•ã‚‰ãªã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³æ‹¡å¼µ\u003c/strong\u003e: Twitterã€GitHubç­‰ã®è¿½åŠ \u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eSSOå¯¾å¿œ\u003c/strong\u003e: ä¼æ¥­å‘ã‘SAML/OIDCèªè¨¼\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³\u003c/strong\u003e: é•·æœŸé–“ã®ãƒ­ã‚°ã‚¤ãƒ³ç¶­æŒ\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eGoogle OAuthèªè¨¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’ä¸¡ç«‹ã™ã‚‹ç¾ä»£çš„ãªèªè¨¼æ‰‹æ³•ã§ã™ã€‚\u003c/p\u003e\n\u003ch2 id=\"å‚è€ƒãƒªãƒ³ã‚¯\"\u003eå‚è€ƒãƒªãƒ³ã‚¯\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developers.google.com/identity/protocols/oauth2\"\u003eGoogle OAuth 2.0 Documentation\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.passportjs.org/packages/passport-google-oauth20/\"\u003ePassport.js Google Strategy\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://datatracker.ietf.org/doc/html/rfc8725\"\u003eJWT Best Practices\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://expressjs.com/en/advanced/best-practice-security.html\"\u003eExpress Security Best Practices\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://reactrouter.com/en/main/start/tutorial#adding-a-router\"\u003eReact Router Authentication\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cem\u003eã“ã®è¨˜äº‹ã¯å®Ÿéš›ã®å€‹äººé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®OAuthå®Ÿè£…çµŒé¨“ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eåˆå¿ƒè€…ã®æ–¹ã¸ï¼šã¾ãšã¯é–‹ç™ºç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã‹ã‚‰ã€æ®µéšçš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚\u003c/em\u003e\u003c/p\u003e"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto py-10 px-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold mb-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-green-600\",\"children\":[\"#\",37]}],\" \",\"Google OAuthèªè¨¼ã®å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼šNode.js + React ã§ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’æ§‹ç¯‰\"]}],[\"$\",\"ul\",null,{\"className\":\"list-none border-b border-gray-600 pb-4 mb-6\",\"children\":[[\"$\",\"li\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":[\"ä½œæˆæ—¥æ™‚: \",\"2025-08-16 00:24\"]}],\"$undefined\",[\"$\",\"li\",null,{\"className\":\"flex flex-wrap gap-2 mt-2\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Google OAuth\"}],[\"$\",\"span\",\"1\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"èªè¨¼\"}],[\"$\",\"span\",\"2\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Node.js\"}],[\"$\",\"span\",\"3\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"React\"}],[\"$\",\"span\",\"4\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"JWT\"}],[\"$\",\"span\",\"5\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Passport.js\"}]]}]]}],[\"$\",\"nav\",null,{\"className\":\"mb-6 pb-4 border-b border-gray-700 flex justify-between\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"â† ãƒ›ãƒ¼ãƒ ã¸\"}],[\"$\",\"$L12\",null,{\"href\":\"/blog\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"è¨˜äº‹ä¸€è¦§ã¸ â†’\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose dark:prose-invert\",\"dangerouslySetInnerHTML\":{\"__html\":\"$13\"}}],[\"$\",\"$L14\",null,{}],[\"$\",\"nav\",null,{\"className\":\"mt-8 pt-4 border-t border-gray-700 flex justify-between\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"â† ãƒ›ãƒ¼ãƒ ã¸\"}],[\"$\",\"$L12\",null,{\"href\":\"/blog\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"è¨˜äº‹ä¸€è¦§ã¸ â†’\"}]]}],[\"$\",\"$L15\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"11:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Maita Tomoya Dev IO\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"ç±³ç”°æ™ºå“‰ã®æŠ€è¡“ãƒ–ãƒ­ã‚°ã€‚ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ãŸã“ã¨ã‚’ãƒ¡ãƒ¢ã—ã¾ã™ã€‚\"}]],\"error\":null,\"digest\":\"$undefined\"}\nb:{\"metadata\":\"$11:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>