1:"$Sreact.fragment"
2:I[87555,[],""]
3:I[31295,[],""]
5:I[59665,[],"MetadataBoundary"]
7:I[59665,[],"OutletBoundary"]
a:I[74911,[],"AsyncMetadataOutlet"]
c:I[59665,[],"ViewportBoundary"]
e:I[26614,[],""]
:HL["/_next/static/media/569ce4b8f30dc480-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/93f479601ee12b01-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/19bdf9af4d1ae4d4.css","style"]
0:{"P":null,"b":"KZrMisSdXyu7FDjuS9HOy","p":"","c":["","blog","webview-session-token-500-error",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","webview-session-token-500-error","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/19bdf9af4d1ae4d4.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":["$","link",null,{"rel":"icon","href":"/favicon.png","type":"image/png"}]}],["$","body",null,{"className":"__variable_5cfdac __variable_9a8899 antialiased","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","webview-session-token-500-error","d"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L4",["$","$L5",null,{"children":"$L6"}],null,["$","$L7",null,{"children":["$L8","$L9",["$","$La",null,{"promise":"$@b"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","mmPZJYIo9Ygw8UnLDMpNP",{"children":[["$","$Lc",null,{"children":"$Ld"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],null]}],false]],"m":"$undefined","G":["$e","$undefined"],"s":false,"S":true}
f:"$Sreact.suspense"
10:I[74911,[],"AsyncMetadata"]
6:["$","$f",null,{"fallback":null,"children":["$","$L10",null,{"promise":"$@11"}]}]
9:null
12:I[6874,["6874","static/chunks/6874-6c1ddde525f3893c.js","5953","static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js"],""]
14:I[31203,["6874","static/chunks/6874-6c1ddde525f3893c.js","5953","static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js"],"default"]
15:I[4197,["6874","static/chunks/6874-6c1ddde525f3893c.js","5953","static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js"],"default"]
13:T8b91,<h2 id="ã¯ã˜ã‚ã«">ã¯ã˜ã‚ã«</h2>
<p>ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã€WebViewã‚’ä½¿ç”¨ã—ãŸæ©Ÿèƒ½å®Ÿè£…ã¯ä¸€èˆ¬çš„ãªæ‰‹æ³•ã§ã™ã€‚ã—ã‹ã—ã€WebViewã®èªè¨¼ç®¡ç†ã¯æ€ã‚ã¬è½ã¨ã—ç©´ãŒã‚ã‚Šã€ä»Šå›ã¯ãã®å…¸å‹çš„ãªå•é¡Œã§ã‚ã‚‹ã€Œ<strong>ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã«ã‚ˆã‚‹500ã‚¨ãƒ©ãƒ¼</strong>ã€ã«ã¤ã„ã¦ã€å®Ÿéš›ã«é­é‡ã—ãŸå•é¡Œã¨è§£æ±ºæ–¹æ³•ã‚’å…±æœ‰ã—ã¾ã™ã€‚</p>
<p>ã“ã®è¨˜äº‹ã§ã¯ã€React Nativeã‚¢ãƒ—ãƒªã¨Railsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä¾‹ã«ã€WebViewã«ãŠã‘ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®è¤‡é›‘ã•ã¨ã€ãã®è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚</p>
<h2 id="ç›®æ¬¡">ç›®æ¬¡</h2>
<ol>
<li><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E6%A6%82%E8%A6%81">å•é¡Œã®æ¦‚è¦</a></li>
<li><a href="#webview%E3%81%AE%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E7%8B%AC%E7%AB%8B%E6%80%A7">WebViewã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç‹¬ç«‹æ€§</a></li>
<li><a href="#%E4%BA%8C%E9%87%8D%E8%AA%8D%E8%A8%BC%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF">äºŒé‡èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä»•çµ„ã¿</a></li>
<li><a href="#500%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E7%99%BA%E7%94%9F%E3%81%99%E3%82%8B%E3%83%A1%E3%82%AB%E3%83%8B%E3%82%BA%E3%83%A0">500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ </a></li>
<li><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E5%86%8D%E7%8F%BE%E6%96%B9%E6%B3%95">å•é¡Œã®å†ç¾æ–¹æ³•</a></li>
<li><a href="#%E8%A7%A3%E6%B1%BA%E3%82%A2%E3%83%97%E3%83%AD%E3%83%BC%E3%83%81">è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</a></li>
<li><a href="#%E5%AE%9F%E8%A3%85%E4%BE%8B">å®Ÿè£…ä¾‹</a></li>
<li><a href="#%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E8%80%83%E6%85%AE%E4%BA%8B%E9%A0%85">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …</a></li>
<li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">ã¾ã¨ã‚</a></li>
</ol>
<h2 id="å•é¡Œã®æ¦‚è¦">å•é¡Œã®æ¦‚è¦</h2>
<p>ã‚ã‚‹ECã‚¢ãƒ—ãƒªã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸï¼š</p>
<ul>
<li><strong>ç—‡çŠ¶</strong>: ã‚¢ãƒ—ãƒªå†…ã®WebViewï¼ˆãƒã‚¤ãƒ³ãƒˆè³¼å…¥ç”»é¢ãªã©ï¼‰ã§çªç„¶500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ</li>
<li><strong>é »åº¦</strong>: ç´„100ä»¶/æ—¥</li>
<li><strong>ã‚¿ã‚¤ãƒŸãƒ³ã‚°</strong>: ã‚¢ãƒ—ãƒªèµ·å‹•ã‹ã‚‰ç´„1æ™‚é–“å¾Œ</li>
<li><strong>å½±éŸ¿</strong>: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ±ºæ¸ˆã§ããªã„ã€é«˜é¡å–å¼•ãŒä¸­æ–­ã•ã‚Œã‚‹</li>
</ul>
<p>ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã¨ã€<code>TokenExpiredError</code>ãŒåŸå› ã§ã—ãŸã€‚ã—ã‹ã—ã€ãªãœãƒˆãƒ¼ã‚¯ãƒ³ã®æœŸé™åˆ‡ã‚ŒãŒ500ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>
<h2 id="webviewã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç‹¬ç«‹æ€§">WebViewã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç‹¬ç«‹æ€§</h2>
<h3 id="çŸ¥ã£ã¦ãŠãã¹ãé‡è¦ãªäº‹å®Ÿ">çŸ¥ã£ã¦ãŠãã¹ãé‡è¦ãªäº‹å®Ÿ</h3>
<p><strong>WebViewã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã€é€šå¸¸ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆSafari/Chromeï¼‰ã¨ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ã¦ã„ã¾ã™ã€‚</strong></p>
<pre><code class="language-javascript">// ã“ã®èªè­˜ã¯é–“é•ã„ï¼
// âŒ ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ â†’ WebViewã§ã‚‚è‡ªå‹•çš„ã«ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹

// å®Ÿéš›ã®å‹•ä½œ
// âœ… ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ­ã‚°ã‚¤ãƒ³ â†’ WebViewã¯æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ã¾ã¾
</code></pre>
<h3 id="ãªãœç‹¬ç«‹ã—ã¦ã„ã‚‹ã®ã‹">ãªãœç‹¬ç«‹ã—ã¦ã„ã‚‹ã®ã‹</h3>





















<table><thead><tr><th>ç†ç”±</th><th>èª¬æ˜</th></tr></thead><tbody><tr><td><strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</strong></td><td>ã‚¢ãƒ—ãƒªé–“ã§CookieãŒå…±æœ‰ã•ã‚Œã‚‹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã«ãªã‚‹</td></tr><tr><td><strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</strong></td><td>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°æƒ…å ±ã‚’ã‚¢ãƒ—ãƒªãŒå–å¾—ã§ãã¦ã—ã¾ã†</td></tr><tr><td><strong>ä»•æ§˜</strong></td><td>iOS/Androidã®WebViewã¯æ„å›³çš„ã«ç‹¬ç«‹è¨­è¨ˆ</td></tr></tbody></table>
<h3 id="ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®æŒ™å‹•">ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®æŒ™å‹•</h3>
<pre><code class="language-javascript">// React Native WebViewã®è¨­å®šä¾‹
&#x3C;WebView
  source={{ uri: 'https://example.com' }}
  // iOSã§ã®ã¿æœ‰åŠ¹ï¼ˆSafariã¨ã‚¯ãƒƒã‚­ãƒ¼å…±æœ‰ï¼‰
  sharedCookiesEnabled={true}  
  // Androidã§ã¯åŠ¹æœãªã—
/>
</code></pre>
<h2 id="äºŒé‡èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä»•çµ„ã¿">äºŒé‡èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä»•çµ„ã¿</h2>
<p>ä»Šå›ã®å•é¡Œã®æ ¹æœ¬åŸå› ã¯ã€<strong>ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®äºŒé‡ç®¡ç†</strong>ã«ã‚ã‚Šã¾ã—ãŸã€‚</p>
<h3 id="ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³">ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒª                     â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Native    â”‚        â”‚     WebView      â”‚    â”‚
â”‚  â”‚   Screen    â”‚        â”‚                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â†“                        â†“               â”‚
â”‚   Firebase Auth            Authorization        â”‚
â”‚   (ID Token)               Header + Token       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Rails Backend                    â”‚
â”‚                                                  â”‚
â”‚   é€šå¸¸Web: Cookieã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ1ãƒ¶æœˆæœ‰åŠ¹ï¼‰           â”‚
â”‚   WebView: Firebaseãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ1æ™‚é–“æœ‰åŠ¹ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="èªè¨¼æ–¹å¼ã®æ¯”è¼ƒ">èªè¨¼æ–¹å¼ã®æ¯”è¼ƒ</h3>
<pre><code class="language-ruby"># Railså´ã®èªè¨¼å‡¦ç†ï¼ˆç°¡ç•¥åŒ–ï¼‰
class ApplicationController &#x3C; ActionController::Base
  def current_user
    if is_webview_request?
      # WebViewã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹
      authenticate_with_firebase_token
    else
      # é€šå¸¸ã®Webã‚¢ã‚¯ã‚»ã‚¹
      authenticate_with_session
    end
  end
  
  private
  
  def is_webview_request?
    request.user_agent&#x26;.include?('MY-APP-WEBVIEW')
  end
  
  def authenticate_with_session
    User.find_by(id: session[:user_id])
  end
  
  def authenticate_with_firebase_token
    token = extract_bearer_token
    payload = decode_firebase_token(token)  # ã“ã“ã§ä¾‹å¤–ç™ºç”Ÿï¼
    User.find_by(firebase_uid: payload['user_id'])
  end
end
</code></pre>
<h2 id="500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ">500ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãƒ¡ã‚«ãƒ‹ã‚ºãƒ </h2>
<h3 id="ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³">ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h3>
<div class="mermaid">timeline
    title ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œã«ã‚ˆã‚‹500ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒ•ãƒ­ãƒ¼
    
    0åˆ†   : ã‚¢ãƒ—ãƒªèµ·å‹•ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          : Firebaseãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¡Œï¼ˆæœ‰åŠ¹æœŸé™60åˆ†ï¼‰
    
    30åˆ†  : WebViewæ©Ÿèƒ½ã‚’ä½¿ç”¨
          : ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹ãƒ»æ­£å¸¸å‹•ä½œ
    
    60åˆ†  : ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ
          : ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è‡ªå‹•æ›´æ–°ã•ã‚Œãšï¼‰
    
    65åˆ†  : WebViewã§ãƒã‚¤ãƒ³ãƒˆè³¼å…¥ç”»é¢ã‚’é–‹ã
          : æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
          : ã‚µãƒ¼ãƒãƒ¼ã§ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼å¤±æ•—
          : 500 Internal Server Error</div>
<h3 id="å®Ÿéš›ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰">å®Ÿéš›ã®ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰</h3>
<pre><code class="language-ruby"># lib/firebase_token_decoder.rb
class FirebaseTokenDecoder
  class InvalidTokenError &#x3C; StandardError; end
  
  def decode(token)
    # JWTãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ãƒ‡ã‚³ãƒ¼ãƒ‰
    payload = JWT.decode(token, public_key, true, options)
    payload
  rescue JWT::ExpiredSignature => e
    # âŒ å•é¡Œ: æœŸé™åˆ‡ã‚Œã‚’500ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã£ã¦ã„ãŸ
    raise InvalidTokenError, e.message
  rescue JWT::DecodeError => e
    raise InvalidTokenError, e.message
  end
end
</code></pre>
<h2 id="å•é¡Œã®å†ç¾æ–¹æ³•">å•é¡Œã®å†ç¾æ–¹æ³•</h2>
<h3 id="é–‹ç™ºç’°å¢ƒã§ã®å†ç¾æ‰‹é †">é–‹ç™ºç’°å¢ƒã§ã®å†ç¾æ‰‹é †</h3>
<pre><code class="language-bash"># 1. æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¨¡æ“¬çš„ã«ä½œæˆ
expired_token="eyJhbGciOiJSUzI1NiIsImtpZCI6InRlc3QifQ.eyJleHAiOjE2MDk0NTkyMDAsInVpZCI6InRlc3QxMjMifQ.dummy"

# 2. WebViewã®User-Agentã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
curl -H "User-Agent: MY-APP-WEBVIEW" \
     -H "Authorization: Bearer $expired_token" \
     "http://localhost:3000/api/points"

# çµæœ: 500 Internal Server Error
</code></pre>
<h3 id="iosã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã®ç¢ºèª">iOSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã®ç¢ºèª</h3>
<pre><code class="language-javascript">// React Nativeå´ã®ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰
const debugTokenExpiry = () => {
  // å¼·åˆ¶çš„ã«å¤ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨
  const expiredToken = 'eyJhbGciOiJSUzI1Ni...'; // 1æ™‚é–“å‰ã®ãƒˆãƒ¼ã‚¯ãƒ³
  
  return (
    &#x3C;WebView
      source={{ uri: 'https://example.com/points' }}
      injectedJavaScriptBeforeContentLoaded={`
        window.FIREBASE_TOKEN = '${expiredToken}';
      `}
    />
  );
};
</code></pre>
<h2 id="firebase-sdkã®éš ã‚ŒãŸä»•æ§˜---ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ã®çœŸå®Ÿ">Firebase SDKã®éš ã‚ŒãŸä»•æ§˜ - ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ã®çœŸå®Ÿ</h2>
<h3 id="é‡è¦ãªç™ºè¦‹-5åˆ†å‰ã®è‡ªå‹•æ›´æ–°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ">é‡è¦ãªç™ºè¦‹: 5åˆ†å‰ã®è‡ªå‹•æ›´æ–°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ </h3>
<p>Firebase SDKã«ã¯ã€é–‹ç™ºè€…ãŒã‚ã¾ã‚Šæ„è­˜ã—ã¦ã„ãªã„é‡è¦ãªä»•æ§˜ãŒã‚ã‚Šã¾ã™ã€‚</p>
<pre><code class="language-javascript">// getIdToken()ã®å®Ÿéš›ã®å‹•ä½œ
getIdToken(currentUser, false) // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
</code></pre>
<p><strong>å®Ÿã¯ä»¥ä¸‹ã®å‹•ä½œã‚’ã—ã¾ã™ï¼š</strong></p>
<ol>
<li><strong>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèª</strong></li>
<li><strong>ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒ5åˆ†ä»¥ä¸Šæ®‹ã£ã¦ã„ã‚‹ â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¿”ã™</strong></li>
<li><strong>ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒ5åˆ†æœªæº€ â†’ è‡ªå‹•çš„ã«æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—</strong></li>
</ol>
<p>ã¤ã¾ã‚Šã€å®Œå…¨ã«æœŸé™åˆ‡ã‚Œã«ãªã‚‹å‰ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã‚‹ä»•çµ„ã¿ãŒã‚ã‚Šã¾ã™ï¼</p>
<h3 id="æƒ…å ±æºã«ã‚ˆã‚‹è£ä»˜ã‘">æƒ…å ±æºã«ã‚ˆã‚‹è£ä»˜ã‘</h3>
<h4 id="1-firebaseå…¬å¼é–‹ç™ºè€…ã®è¨¼è¨€">1. Firebaseå…¬å¼é–‹ç™ºè€…ã®è¨¼è¨€</h4>
<p><strong>Peter Frieseæ°ï¼ˆFirebase Developer Advocateï¼‰ã«ã‚ˆã‚‹ã¨ï¼š</strong></p>
<blockquote>
<p>"Firebase's client SDKs automatically handle refreshing the user's ID token. If the app is running, the SDK will retrieve a new ID token (using the refresh token) about 5 minutes before the ID token expires."</p>
</blockquote>
<p><strong>Frank van Puffelenæ°ï¼ˆFirebaseå…¬å¼ï¼‰ã‚‚Stack Overflowã§æ˜ç¢ºã«è¿°ã¹ã¦ã„ã¾ã™ï¼š</strong></p>
<blockquote>
<p>"The Firebase Authentication SDK automatically refreshes the ID token about 5 minutes before it expires, and getIdToken() always gives you the latest token."</p>
<p>å‡ºå…¸: <a href="https://stackoverflow.com/questions/78127324/how-to-refresh-firebase-access-token-using-next-auth-credentials-provider">How to refresh firebase access token using next-auth credentials provider? - Stack Overflow</a></p>
</blockquote>
<h4 id="2-getidtokenãƒ¡ã‚½ãƒƒãƒ‰ã®å‹•ä½œè©³ç´°">2. getIdToken()ãƒ¡ã‚½ãƒƒãƒ‰ã®å‹•ä½œè©³ç´°</h4>




















<table><thead><tr><th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th><th>å‹•ä½œ</th><th>ä½¿ç”¨å ´é¢</th></tr></thead><tbody><tr><td><code>forceRefresh: false</code>ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</td><td>- æœ‰åŠ¹æœŸé™ãŒ5åˆ†ä»¥ä¸Šã‚ã‚‹å ´åˆï¼šã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¿”ã™<br>- æœ‰åŠ¹æœŸé™ãŒ5åˆ†æœªæº€ï¼šè‡ªå‹•æ›´æ–°<br>- æœŸé™åˆ‡ã‚Œï¼šæ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—</td><td>é€šå¸¸ã®ä½¿ç”¨</td></tr><tr><td><code>forceRefresh: true</code></td><td>æœ‰åŠ¹æœŸé™ã«é–¢ã‚ã‚‰ãšæ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¼·åˆ¶å–å¾—</td><td>ç‰¹åˆ¥ãªå ´åˆã®ã¿</td></tr></tbody></table>
<h3 id="è‡ªå‹•æ›´æ–°ãŒç™ºç”Ÿã™ã‚‹æ¡ä»¶">è‡ªå‹•æ›´æ–°ãŒç™ºç”Ÿã™ã‚‹æ¡ä»¶</h3>
<pre><code class="language-javascript">// è‡ªå‹•æ›´æ–°ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¯è¦–åŒ–
class TokenRefreshMonitor {
  constructor() {
    this.checkInterval = 60000; // 1åˆ†ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
  }
  
  async monitorTokenStatus() {
    const user = auth().currentUser;
    if (!user) return;
    
    const token = await user.getIdToken();
    const decoded = this.decodeJWT(token);
    const now = Date.now() / 1000;
    const timeToExpiry = decoded.exp - now;
    
    console.log({
      status: this.getTokenStatus(timeToExpiry),
      minutesRemaining: Math.floor(timeToExpiry / 60),
      willAutoRefresh: timeToExpiry &#x3C; 300, // 5åˆ†æœªæº€ã§è‡ªå‹•æ›´æ–°
      timestamp: new Date().toISOString()
    });
  }
  
  getTokenStatus(secondsRemaining) {
    if (secondsRemaining > 300) return 'âœ… æœ‰åŠ¹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨ï¼‰';
    if (secondsRemaining > 0) return 'âš ï¸ è‡ªå‹•æ›´æ–°ã‚¾ãƒ¼ãƒ³';
    return 'âŒ æœŸé™åˆ‡ã‚Œ';
  }
  
  decodeJWT(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    return JSON.parse(atob(base64));
  }
}
</code></pre>
<h3 id="å®Ÿéš›ã®å‹•ä½œãƒ•ãƒ­ãƒ¼">å®Ÿéš›ã®å‹•ä½œãƒ•ãƒ­ãƒ¼</h3>
<div class="mermaid">graph TD
    A[getIdTokenå‘¼ã³å‡ºã—] --&gt; B{ãƒˆãƒ¼ã‚¯ãƒ³ã®çŠ¶æ…‹ç¢ºèª}
    B --&gt;|æœ‰åŠ¹æœŸé™ &gt; 5åˆ†| C[ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”ã™]
    B --&gt;|æœ‰åŠ¹æœŸé™ &lt; 5åˆ†| D[æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•å–å¾—]
    B --&gt;|æœŸé™åˆ‡ã‚Œ| E[æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—]
    D --&gt; F[æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥]
    E --&gt; F
    F --&gt; G[ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿”ã™]
    C --&gt; G</div>
<h3 id="ãªãœã“ã®ä»•æ§˜ãŒé‡è¦ãªã®ã‹">ãªãœã“ã®ä»•æ§˜ãŒé‡è¦ãªã®ã‹</h3>
<ol>
<li>
<p><strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–</strong></p>
<ul>
<li>ä¸è¦ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡ã‚’å‰Šæ¸›</li>
<li>ã‚µãƒ¼ãƒãƒ¼è² è·ã®è»½æ¸›</li>
</ul>
</li>
<li>
<p><strong>ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªä½“é¨“</strong></p>
<ul>
<li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ„è­˜ã›ãšã«ç¶™ç¶šåˆ©ç”¨å¯èƒ½</li>
<li>æœŸé™åˆ‡ã‚Œã«ã‚ˆã‚‹ä¸­æ–­ã‚’é˜²ã</li>
</ul>
</li>
<li>
<p><strong>é–‹ç™ºè€…ã®è² æ‹…è»½æ¸›</strong></p>
<ul>
<li>æ‰‹å‹•ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ãŒä¸è¦</li>
<li>è¤‡é›‘ãªãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ãŒä¸è¦</li>
</ul>
</li>
</ol>
<h3 id="ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Ÿè£…ä¾‹">ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹å®Ÿè£…ä¾‹</h3>
<pre><code class="language-javascript">// æ¨å¥¨ã•ã‚Œã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
class OptimizedTokenManager {
  constructor() {
    this.tokenCache = null;
    this.lastRefresh = null;
  }
  
  async getToken() {
    const user = auth().currentUser;
    if (!user) throw new Error('User not authenticated');
    
    // Firebase SDKã®è‡ªå‹•æ›´æ–°ã«ä»»ã›ã‚‹ï¼ˆforceRefresh: falseï¼‰
    // 5åˆ†å‰ã«ãªã‚‹ã¨è‡ªå‹•çš„ã«æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
    const token = await user.getIdToken(/* forceRefresh */ false);
    
    // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šãƒˆãƒ¼ã‚¯ãƒ³ã®çŠ¶æ…‹ã‚’ãƒ­ã‚°å‡ºåŠ›
    if (__DEV__) {
      this.logTokenStatus(token);
    }
    
    return token;
  }
  
  // å¼·åˆ¶æ›´æ–°ãŒå¿…è¦ãªç‰¹åˆ¥ãªã‚±ãƒ¼ã‚¹ã®ã¿
  async forceRefreshToken() {
    const user = auth().currentUser;
    if (!user) throw new Error('User not authenticated');
    
    console.log('âš ï¸ å¼·åˆ¶çš„ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°ã—ã¾ã™');
    return await user.getIdToken(/* forceRefresh */ true);
  }
  
  logTokenStatus(token) {
    const decoded = this.decodeJWT(token);
    const now = Date.now() / 1000;
    const remaining = decoded.exp - now;
    
    console.log('ğŸ” Token Status:', {
      expiresIn: `${Math.floor(remaining / 60)}åˆ†${Math.floor(remaining % 60)}ç§’`,
      autoRefreshActive: remaining &#x3C; 300,
      tokenAge: this.lastRefresh ? 
        `${Math.floor((Date.now() - this.lastRefresh) / 1000)}ç§’` : 'åˆå›å–å¾—'
    });
    
    this.lastRefresh = Date.now();
  }
  
  decodeJWT(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    return JSON.parse(atob(base64));
  }
}

// ä½¿ç”¨ä¾‹
const tokenManager = new OptimizedTokenManager();

// é€šå¸¸ã®APIå‘¼ã³å‡ºã—æ™‚
async function callAPI(endpoint, data) {
  try {
    // Firebase SDKã®è‡ªå‹•æ›´æ–°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æ´»ç”¨
    const token = await tokenManager.getToken();
    
    const response = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });
    
    return await response.json();
  } catch (error) {
    console.error('API call failed:', error);
    throw error;
  }
}
</code></pre>
<h3 id="æ³¨æ„ç‚¹ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°">æ³¨æ„ç‚¹ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h3>
<h4 id="è‡ªå‹•æ›´æ–°ãŒæ©Ÿèƒ½ã—ãªã„ã‚±ãƒ¼ã‚¹">è‡ªå‹•æ›´æ–°ãŒæ©Ÿèƒ½ã—ãªã„ã‚±ãƒ¼ã‚¹</h4>
<ol>
<li>
<p><strong>ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ã‚ã‚‹å ´åˆ</strong></p>
<pre><code class="language-javascript">// ã‚¢ãƒ—ãƒªãŒãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«æˆ»ã£ãŸæ™‚ã®å‡¦ç†
AppState.addEventListener('change', (nextAppState) => {
  if (nextAppState === 'active') {
    // ãƒˆãƒ¼ã‚¯ãƒ³ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€å¿…è¦ãªã‚‰æ›´æ–°
    tokenManager.getToken();
  }
});
</code></pre>
</li>
<li>
<p><strong>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãŒä¸å®‰å®šãªå ´åˆ</strong></p>
<pre><code class="language-javascript">// ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
async function getTokenWithRetry(maxRetries = 3) {
  for (let i = 0; i &#x3C; maxRetries; i++) {
    try {
      return await auth().currentUser.getIdToken();
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
</code></pre>
</li>
<li>
<p><strong>Firebase SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„å ´åˆ</strong></p>
<pre><code class="language-json">// package.jsonã§æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨
{
  "dependencies": {
    "@react-native-firebase/auth": "^18.0.0"
  }
}
</code></pre>
</li>
</ol>
<h2 id="è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ">è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ</h2>
<h3 id="ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„çŸ­æœŸå¯¾ç­–">ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ1: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ”¹å–„ï¼ˆçŸ­æœŸå¯¾ç­–ï¼‰</h3>
<pre><code class="language-ruby"># ä¿®æ­£ç‰ˆ: æœŸé™åˆ‡ã‚Œã¨ç„¡åŠ¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŒºåˆ¥
class FirebaseTokenDecoder
  class InvalidTokenError &#x3C; StandardError; end
  class ExpiredTokenError &#x3C; StandardError; end  # æ–°è¦è¿½åŠ 
  
  def decode(token)
    payload = JWT.decode(token, public_key, true, options)
    payload
  rescue JWT::ExpiredSignature => e
    # âœ… æœŸé™åˆ‡ã‚Œã¯åˆ¥ã®ä¾‹å¤–ã¨ã—ã¦æ‰±ã†
    Rails.logger.info "Token expired: #{e.message}"
    raise ExpiredTokenError, e.message
  rescue JWT::DecodeError => e
    raise InvalidTokenError, e.message
  end
end

# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å´ã®å‡¦ç†
def authenticate_with_firebase_token
  begin
    token = extract_bearer_token
    payload = decode_firebase_token(token)
    User.find_by(firebase_uid: payload['user_id'])
  rescue FirebaseTokenDecoder::ExpiredTokenError => e
    # âœ… æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ graceful ã«å‡¦ç†
    handle_expired_token
  rescue FirebaseTokenDecoder::InvalidTokenError => e
    # æœ¬å½“ã«ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã®å ´åˆã®ã¿ã‚¨ãƒ©ãƒ¼
    render_unauthorized
  end
end

def handle_expired_token
  # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  if current_session_user.present?
    # æ—¢å­˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ç¶™ç¶š
    response.headers['X-Token-Expired'] = 'true'
    return current_session_user
  else
    # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚ãªã„å ´åˆã¯401
    render json: { error: 'Token expired' }, status: :unauthorized
  end
end
</code></pre>
<h3 id="ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2-ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ä¸­æœŸå¯¾ç­–">ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ2: ãƒˆãƒ¼ã‚¯ãƒ³è‡ªå‹•æ›´æ–°ï¼ˆä¸­æœŸå¯¾ç­–ï¼‰</h3>
<pre><code class="language-javascript">// React Nativeå´: ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°
import auth from '@react-native-firebase/auth';

class TokenManager {
  constructor() {
    this.token = null;
    this.tokenExpiry = null;
  }
  
  async getValidToken() {
    const now = Date.now();
    
    // ãƒˆãƒ¼ã‚¯ãƒ³ãŒå­˜åœ¨ã—ã€æœŸé™ã¾ã§5åˆ†ä»¥ä¸Šã‚ã‚‹å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
    if (this.token &#x26;&#x26; this.tokenExpiry &#x26;&#x26; (this.tokenExpiry - now) > 5 * 60 * 1000) {
      return this.token;
    }
    
    // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°
    const user = auth().currentUser;
    if (user) {
      this.token = await user.getIdToken(true);
      // JWTã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦æœ‰åŠ¹æœŸé™ã‚’å–å¾—
      const payload = this.decodeJWT(this.token);
      this.tokenExpiry = payload.exp * 1000;
      return this.token;
    }
    
    throw new Error('User not authenticated');
  }
  
  decodeJWT(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    return JSON.parse(atob(base64));
  }
}

// WebViewä½¿ç”¨æ™‚
const MyWebView = () => {
  const [token, setToken] = useState(null);
  const tokenManager = new TokenManager();
  
  useEffect(() => {
    // åˆå›ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
    tokenManager.getValidToken().then(setToken);
    
    // 30åˆ†ã”ã¨ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°
    const interval = setInterval(() => {
      tokenManager.getValidToken().then(setToken);
    }, 30 * 60 * 1000);
    
    return () => clearInterval(interval);
  }, []);
  
  return (
    &#x3C;WebView
      source={{ uri: 'https://example.com/points' }}
      injectedJavaScriptBeforeContentLoaded={`
        window.FIREBASE_TOKEN = '${token}';
        
        // Fetchã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è‡ªå‹•ä»˜ä¸
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
          const [url, options = {}] = args;
          options.headers = {
            ...options.headers,
            'Authorization': 'Bearer ' + window.FIREBASE_TOKEN
          };
          return originalFetch.call(this, url, options);
        };
      `}
    />
  );
};
</code></pre>
<h3 id="ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3-webviewã¨ã®é€šä¿¡å¼·åŒ–é•·æœŸå¯¾ç­–">ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ3: WebViewã¨ã®é€šä¿¡å¼·åŒ–ï¼ˆé•·æœŸå¯¾ç­–ï¼‰</h3>
<pre><code class="language-javascript">// WebViewã¨ãƒã‚¤ãƒ†ã‚£ãƒ–é–“ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚’ä½¿ç”¨
const EnhancedWebView = () => {
  const webViewRef = useRef(null);
  
  const handleMessage = async (event) => {
    const { type, data } = JSON.parse(event.nativeEvent.data);
    
    switch (type) {
      case 'TOKEN_REFRESH_NEEDED':
        // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°ã—ã¦WebViewã«é€ä¿¡
        const newToken = await auth().currentUser.getIdToken(true);
        webViewRef.current.postMessage(JSON.stringify({
          type: 'NEW_TOKEN',
          token: newToken
        }));
        break;
        
      case 'AUTH_ERROR':
        // èªè¨¼ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯å†ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸
        navigation.navigate('Login');
        break;
    }
  };
  
  return (
    &#x3C;WebView
      ref={webViewRef}
      source={{ uri: 'https://example.com/points' }}
      onMessage={handleMessage}
      injectedJavaScript={`
        // WebViewå†…ã§ã®ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
        class TokenHandler {
          constructor() {
            this.token = window.INITIAL_TOKEN;
          }
          
          checkTokenExpiry() {
            try {
              const payload = JSON.parse(atob(this.token.split('.')[1]));
              const now = Date.now() / 1000;
              
              if (payload.exp - now &#x3C; 300) { // 5åˆ†å‰
                // ãƒã‚¤ãƒ†ã‚£ãƒ–å´ã«ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã‚’è¦æ±‚
                window.ReactNativeWebView.postMessage(JSON.stringify({
                  type: 'TOKEN_REFRESH_NEEDED'
                }));
              }
            } catch (e) {
              console.error('Token check failed:', e);
            }
          }
          
          updateToken(newToken) {
            this.token = newToken;
            // æ—¢å­˜ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›´æ–°
            this.updateAuthHeaders();
          }
        }
        
        const tokenHandler = new TokenHandler();
        
        // 3åˆ†ã”ã¨ã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
        setInterval(() => tokenHandler.checkTokenExpiry(), 3 * 60 * 1000);
        
        // ãƒã‚¤ãƒ†ã‚£ãƒ–ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡
        window.addEventListener('message', (event) => {
          const data = JSON.parse(event.data);
          if (data.type === 'NEW_TOKEN') {
            tokenHandler.updateToken(data.token);
          }
        });
      `}
    />
  );
};
</code></pre>
<h2 id="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …</h2>
<h3 id="ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œæ™‚ã®åˆ¤æ–­åŸºæº–">ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œæ™‚ã®åˆ¤æ–­åŸºæº–</h3>
<pre><code class="language-ruby"># ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨UXã®ãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…
class TokenExpiryHandler
  # æœ€å¾Œã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‹ã‚‰30åˆ†ä»¥å†…ãªã‚‰ç¶™ç¶šã‚’è¨±å¯
  GRACE_PERIOD = 30.minutes
  
  def handle_expired_token(session, user)
    last_activity = session[:last_activity_at]
    
    if last_activity &#x26;&#x26; Time.current - last_activity &#x3C; GRACE_PERIOD
      # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç¶™ç¶šåˆ©ç”¨å¯èƒ½
      log_security_event(:token_expired_but_active, user)
      session[:last_activity_at] = Time.current
      return :continue_with_grace
    else
      # éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å†èªè¨¼
      log_security_event(:token_expired_and_inactive, user)
      return :require_reauth
    end
  end
  
  private
  
  def log_security_event(event_type, user)
    SecurityAuditLog.create!(
      event: event_type,
      user: user,
      ip_address: request.remote_ip,
      user_agent: request.user_agent,
      timestamp: Time.current
    )
  end
end
</code></pre>
<h3 id="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h3>
<p>âœ… <strong>å®Ÿè£…æ™‚ã«ç¢ºèªã™ã¹ãé …ç›®</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã¯é©åˆ‡ã‹ï¼ˆ1æ™‚é–“ã¯å¦¥å½“ï¼‰</li>
<li class="task-list-item"><input type="checkbox" disabled> æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ­ã‚°ã¯é©åˆ‡ã«è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹</li>
<li class="task-list-item"><input type="checkbox" disabled> ä¸æ­£ãªãƒˆãƒ¼ã‚¯ãƒ³ã¨æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã‚’åŒºåˆ¥ã—ã¦ã„ã‚‹ã‹</li>
<li class="task-list-item"><input type="checkbox" disabled> ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’è©•ä¾¡ã—ãŸã‹</li>
<li class="task-list-item"><input type="checkbox" disabled> ç›£æŸ»ãƒ­ã‚°ã‚’é©åˆ‡ã«å‡ºåŠ›ã—ã¦ã„ã‚‹ã‹</li>
</ul>
<h2 id="ãƒãƒ³ã‚ºã‚ªãƒ³-å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚ˆã†">ãƒãƒ³ã‚ºã‚ªãƒ³: å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚ˆã†</h2>
<h3 id="ç’°å¢ƒæ§‹ç¯‰">ç’°å¢ƒæ§‹ç¯‰</h3>
<pre><code class="language-bash"># 1. ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/example/webview-auth-sample.git
cd webview-auth-sample

# 2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆRailsï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
cd backend
bundle install
rails db:create db:migrate
rails server

# 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReact Nativeï¼‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
cd ../mobile
npm install
cd ios &#x26;&#x26; pod install &#x26;&#x26; cd ..
npm run ios
</code></pre>
<h3 id="ãƒ‡ãƒãƒƒã‚°ç”¨ã®ã‚³ãƒ¼ãƒ‰">ãƒ‡ãƒãƒƒã‚°ç”¨ã®ã‚³ãƒ¼ãƒ‰</h3>
<pre><code class="language-javascript">// ãƒ‡ãƒãƒƒã‚°ç”¨: ãƒˆãƒ¼ã‚¯ãƒ³ã®çŠ¶æ…‹ã‚’å¯è¦–åŒ–
const TokenDebugger = () => {
  const [tokenInfo, setTokenInfo] = useState(null);
  
  useEffect(() => {
    const checkToken = async () => {
      const user = auth().currentUser;
      if (user) {
        const token = await user.getIdToken();
        const decoded = JSON.parse(atob(token.split('.')[1]));
        
        setTokenInfo({
          uid: decoded.user_id,
          exp: new Date(decoded.exp * 1000).toLocaleString(),
          remaining: Math.floor((decoded.exp * 1000 - Date.now()) / 1000 / 60) + 'åˆ†'
        });
      }
    };
    
    checkToken();
    const interval = setInterval(checkToken, 10000); // 10ç§’ã”ã¨
    
    return () => clearInterval(interval);
  }, []);
  
  return (
    &#x3C;View style={styles.debugContainer}>
      &#x3C;Text>UID: {tokenInfo?.uid}&#x3C;/Text>
      &#x3C;Text>æœ‰åŠ¹æœŸé™: {tokenInfo?.exp}&#x3C;/Text>
      &#x3C;Text>æ®‹ã‚Šæ™‚é–“: {tokenInfo?.remaining}&#x3C;/Text>
    &#x3C;/View>
  );
};
</code></pre>
<h2 id="ã‚ˆãã‚ã‚‹è³ªå•faq">ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰</h2>
<h3 id="q1-ãªãœwebviewã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å…±æœ‰ã§ããªã„ã®ã‹">Q1: ãªãœWebViewã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å…±æœ‰ã§ããªã„ã®ã‹ï¼Ÿ</h3>
<p><strong>A</strong>: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®è¦³ç‚¹ã‹ã‚‰ã€ãƒ¢ãƒã‚¤ãƒ«OSã¯WebViewã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ–ãƒ©ã‚¦ã‚¶ã®Cookie/ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ„å›³çš„ã«åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¸ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’é˜²ã„ã§ã„ã¾ã™ã€‚</p>
<h3 id="q2-ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’å»¶ã°ã›ã°ã„ã„ã®ã§ã¯">Q2: ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’å»¶ã°ã›ã°ã„ã„ã®ã§ã¯ï¼Ÿ</h3>
<p><strong>A</strong>: Firebase Authenticationã®ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ã¯1æ™‚é–“ã§å›ºå®šã•ã‚Œã¦ãŠã‚Šã€å¤‰æ›´ã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«åŸºã¥ãè¨­è¨ˆã§ã™ã€‚ä»£ã‚ã‚Šã«ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•æ›´æ–°ã‚’å®Ÿè£…ã™ã¹ãã§ã™ã€‚</p>
<h3 id="q3-401ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã500ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã¯ãªãœ">Q3: 401ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã500ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã®ã¯ãªãœï¼Ÿ</h3>
<p><strong>A</strong>: å®Ÿè£…ã®å•é¡Œã§ã™ã€‚ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã®ä¾‹å¤–å‡¦ç†ãŒé©åˆ‡ã§ãªãã€ã™ã¹ã¦ã®ä¾‹å¤–ã‚’å†…éƒ¨ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã£ã¦ã„ãŸãŸã‚ã§ã™ã€‚æœŸé™åˆ‡ã‚Œï¼ˆ401ï¼‰ã¨å†…éƒ¨ã‚¨ãƒ©ãƒ¼ï¼ˆ500ï¼‰ã‚’é©åˆ‡ã«åŒºåˆ¥ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
<h2 id="ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿</h2>
<h3 id="ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰">ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰</h3>
<pre><code class="language-javascript">// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
const measureTokenRefresh = async () => {
  const iterations = 100;
  const times = [];
  
  for (let i = 0; i &#x3C; iterations; i++) {
    const start = performance.now();
    await auth().currentUser.getIdToken(true);
    const end = performance.now();
    times.push(end - start);
  }
  
  console.log({
    average: times.reduce((a, b) => a + b) / times.length,
    min: Math.min(...times),
    max: Math.max(...times)
  });
};

// å®Ÿæ¸¬å€¤ï¼ˆä¾‹ï¼‰
// {
//   average: 245.3,  // ãƒŸãƒªç§’
//   min: 180.5,
//   max: 520.1
// }
</code></pre>
<h3 id="æ¨å¥¨ã•ã‚Œã‚‹æ›´æ–°æˆ¦ç•¥">æ¨å¥¨ã•ã‚Œã‚‹æ›´æ–°æˆ¦ç•¥</h3>





























<table><thead><tr><th>æˆ¦ç•¥</th><th>æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°</th><th>ãƒ¡ãƒªãƒƒãƒˆ</th><th>ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ</th></tr></thead><tbody><tr><td><strong>Proactive</strong></td><td>50åˆ†ã”ã¨</td><td>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„</td><td>ç„¡é§„ãªé€šä¿¡ãŒç™ºç”Ÿ</td></tr><tr><td><strong>Reactive</strong></td><td>ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿</td><td>é€šä¿¡é‡ãŒæœ€å°</td><td>åˆå›ã‚¨ãƒ©ãƒ¼ã¯é¿ã‘ã‚‰ã‚Œãªã„</td></tr><tr><td><strong>Hybrid</strong></td><td>55åˆ†çµŒé or ã‚¨ãƒ©ãƒ¼æ™‚</td><td>ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„</td><td>å®Ÿè£…ãŒè¤‡é›‘</td></tr></tbody></table>
<h2 id="ã¾ã¨ã‚">ã¾ã¨ã‚</h2>
<h3 id="å­¦ã‚“ã ã“ã¨">å­¦ã‚“ã ã“ã¨</h3>
<ol>
<li>
<p><strong>WebViewã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹</strong></p>
<ul>
<li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æœŸå¾…ã—ã¦ã¯ã„ã‘ãªã„</li>
<li>ç‹¬è‡ªã®èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒå¿…è¦</li>
</ul>
</li>
<li>
<p><strong>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®é‡è¦æ€§</strong></p>
<ul>
<li>æœŸé™åˆ‡ã‚Œã¨ç„¡åŠ¹ã‚’åŒºåˆ¥ã™ã‚‹</li>
<li>500ã‚¨ãƒ©ãƒ¼ã¯é¿ã‘ã€é©åˆ‡ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™</li>
</ul>
</li>
<li>
<p><strong>UXã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒãƒ©ãƒ³ã‚¹</strong></p>
<ul>
<li>å®Œå…¨ã«ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã¨UXãŒæ‚ªåŒ–</li>
<li>é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ”ãƒªã‚ªãƒ‰ã®è¨­å®š</li>
</ul>
</li>
</ol>
<h3 id="ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹">ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h3>
<pre><code class="language-javascript">// âœ… æ¨å¥¨ã•ã‚Œã‚‹å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
const WebViewAuthPattern = {
  // 1. ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°
  autoRefresh: true,
  refreshInterval: 30 * 60 * 1000, // 30åˆ†
  
  // 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  handleTokenExpiry: 'graceful', // 'strict' | 'graceful'
  
  // 3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  fallbackAuth: 'session', // 'session' | 'reauth' | 'none'
  
  // 4. ç›£æŸ»ãƒ­ã‚°
  auditLogging: true,
  
  // 5. ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥
  notifyUser: false // ã‚¨ãƒ©ãƒ¼æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã™ã‚‹ã‹
};
</code></pre>
<h3 id="ä»Šå¾Œã®å±•æœ›">ä»Šå¾Œã®å±•æœ›</h3>
<ol>
<li>
<p><strong>WebViewä¾å­˜ã®å‰Šæ¸›</strong></p>
<ul>
<li>å¯èƒ½ãªé™ã‚Šãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè£…ã«ç§»è¡Œ</li>
<li>WebViewã¯æœ€å°é™ã®ä½¿ç”¨ã«ç•™ã‚ã‚‹</li>
</ul>
</li>
<li>
<p><strong>çµ±ä¸€èªè¨¼åŸºç›¤ã®æ§‹ç¯‰</strong></p>
<ul>
<li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¸€å…ƒç®¡ç†</li>
<li>ã‚ˆã‚ŠæŸ”è»Ÿãªèªè¨¼ãƒ•ãƒ­ãƒ¼</li>
</ul>
</li>
<li>
<p><strong>ã‚¨ãƒ©ãƒ¼ç›£è¦–ã®å¼·åŒ–</strong></p>
<ul>
<li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã®ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥</li>
<li>è‡ªå‹•ãƒªã‚«ãƒãƒªãƒ¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ </li>
</ul>
</li>
</ol>
<h2 id="å‚è€ƒè³‡æ–™">å‚è€ƒè³‡æ–™</h2>
<h3 id="firebaseèªè¨¼ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†">Firebaseèªè¨¼ã¨ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†</h3>
<ul>
<li><a href="https://firebase.google.com/docs/reference/rest/auth">Firebase Authentication REST API Reference</a></li>
<li><a href="https://firebase.google.com/docs/auth/admin/manage-sessions">Manage User Sessions | Firebase Authentication</a></li>
<li><a href="https://firebase.google.com/docs/auth/admin/verify-id-tokens">Verify ID Tokens | Firebase Authentication</a></li>
<li><a href="https://x.com/peterfriese/status/1509425270603792385">Peter Friese (Firebase Developer) on Token Refresh</a></li>
<li><a href="https://stackoverflow.com/questions/78127324/how-to-refresh-firebase-access-token-using-next-auth-credentials-provider">Frank van Puffelen answer on Token Auto-refresh - Stack Overflow</a></li>
<li><a href="https://stackoverflow.com/questions/49656489/is-the-firebase-access-token-refreshed-automatically">Firebase Token Auto-refresh Discussion - Stack Overflow</a></li>
<li><a href="https://stackoverflow.com/questions/76929017/firebase-auth-when-are-tokens-refreshed">Firebase Auth - When are tokens refreshed? - Stack Overflow</a></li>
<li><a href="https://stackoverflow.com/questions/74344333/best-practice-to-get-users-idtoken-from-firebase-using-getidtoken-forceref">Best practice for getIdToken usage - Stack Overflow</a></li>
</ul>
<h3 id="webviewå®Ÿè£…">WebViewå®Ÿè£…</h3>
<ul>
<li><a href="https://github.com/react-native-webview/react-native-webview/blob/master/docs/Guide.md">React Native WebView Documentation</a></li>
<li><a href="https://developer.apple.com/documentation/webkit/wkwebview">iOS WKWebView Documentation</a></li>
<li><a href="https://developer.android.com/reference/android/webkit/WebView">Android WebView Documentation</a></li>
</ul>
<h3 id="ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å®Ÿè£…</h3>
<ul>
<li><a href="https://guides.rubyonrails.org/action_controller_overview.html#session">Rails Action Controller Overview - Sessions</a></li>
<li><a href="https://jwt.io/introduction">JWT.io - JSON Web Tokens Introduction</a></li>
</ul>
<h3 id="ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£</h3>
<ul>
<li><a href="https://owasp.org/www-project-mobile-security-testing-guide/">OWASP Mobile Security Testing Guide</a></li>
</ul>
<h2 id="è‘—è€…ã«ã¤ã„ã¦">è‘—è€…ã«ã¤ã„ã¦</h2>
<p>Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰é–‹ç™ºã«å¾“äº‹ã—ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡é›‘æ€§ã¨æˆ¦ã„ãªãŒã‚‰ã€ã‚ˆã‚Šè‰¯ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã‚’æ—¥ã€…æ¨¡ç´¢ã—ã¦ã„ã¾ã™ã€‚</p>
<hr>
<p>ã“ã®è¨˜äº‹ãŒã€åŒã˜ã‚ˆã†ãªå•é¡Œã«ç›´é¢ã—ã¦ã„ã‚‹æ–¹ã®åŠ©ã‘ã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ã‚³ãƒ¡ãƒ³ãƒˆãã ã•ã„ã€‚</p>4:["$","div",null,{"className":"max-w-2xl mx-auto py-10 px-4","children":[["$","h1",null,{"className":"text-3xl font-bold mb-2","children":[["$","span",null,{"className":"text-green-600","children":["#","$undefined"]}]," ","WebViewã§ç™ºç”Ÿã™ã‚‹500ã‚¨ãƒ©ãƒ¼ã®çœŸç›¸ - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®äºŒé‡ç®¡ç†å•é¡Œã‚’è§£æ±ºã™ã‚‹"]}],["$","ul",null,{"className":"list-none border-b border-gray-600 pb-4 mb-6","children":[["$","li",null,{"className":"text-gray-500 text-sm","children":["ä½œæˆæ—¥æ™‚: ","2025-09-12 19:53"]}],["$","li",null,{"className":"text-gray-500 text-sm","children":["æ›´æ–°æ—¥æ™‚: ","2025-09-12 21:30"]}],["$","li",null,{"className":"flex flex-wrap gap-2 mt-2","children":[["$","span","0",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"WebView"}],["$","span","1",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"React Native"}],["$","span","2",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"Rails"}],["$","span","3",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"Firebase"}],["$","span","4",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"èªè¨¼"}],["$","span","5",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†"}]]}]]}],["$","nav",null,{"className":"mb-6 pb-4 border-b border-gray-700 flex justify-between","children":[["$","$L12",null,{"href":"/","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"â† ãƒ›ãƒ¼ãƒ ã¸"}],["$","$L12",null,{"href":"/blog","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"è¨˜äº‹ä¸€è¦§ã¸ â†’"}]]}],["$","article",null,{"className":"prose dark:prose-invert","dangerouslySetInnerHTML":{"__html":"$13"}}],["$","$L14",null,{}],["$","nav",null,{"className":"mt-8 pt-4 border-t border-gray-700 flex justify-between","children":[["$","$L12",null,{"href":"/","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"â† ãƒ›ãƒ¼ãƒ ã¸"}],["$","$L12",null,{"href":"/blog","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"è¨˜äº‹ä¸€è¦§ã¸ â†’"}]]}],["$","$L15",null,{}]]}]
d:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
8:null
11:{"metadata":[["$","title","0",{"children":"Maita Tomoya Dev IO"}],["$","meta","1",{"name":"description","content":"ç±³ç”°æ™ºå“‰ã®æŠ€è¡“ãƒ–ãƒ­ã‚°ã€‚ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ãŸã“ã¨ã‚’ãƒ¡ãƒ¢ã—ã¾ã™ã€‚"}]],"error":null,"digest":"$undefined"}
b:{"metadata":"$11:metadata","error":null,"digest":"$undefined"}
