1:"$Sreact.fragment"
2:I[7555,[],""]
3:I[1295,[],""]
5:I[9665,[],"MetadataBoundary"]
7:I[9665,[],"OutletBoundary"]
a:I[4911,[],"AsyncMetadataOutlet"]
c:I[9665,[],"ViewportBoundary"]
e:I[6614,[],""]
:HL["/_next/static/media/569ce4b8f30dc480-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/93f479601ee12b01-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/21fca20b31fba572.css","style"]
0:{"P":null,"b":"h8nVJqgG2LdrtDCd0TWQX","p":"","c":["","blog","go-learning-platform-design",""],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","go-learning-platform-design","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/21fca20b31fba572.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":["$","link",null,{"rel":"icon","href":"/favicon.png","type":"image/png"}]}],["$","body",null,{"className":"__variable_5cfdac __variable_9a8899 antialiased","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}],{"children":["blog",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","go-learning-platform-design","d"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L4",["$","$L5",null,{"children":"$L6"}],null,["$","$L7",null,{"children":["$L8","$L9",["$","$La",null,{"promise":"$@b"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","uUtRKNk6cVKHvkdtLlisB",{"children":[["$","$Lc",null,{"children":"$Ld"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],null]}],false]],"m":"$undefined","G":["$e","$undefined"],"s":false,"S":true}
f:"$Sreact.suspense"
10:I[4911,[],"AsyncMetadata"]
6:["$","$f",null,{"fallback":null,"children":["$","$L10",null,{"promise":"$@11"}]}]
9:null
12:I[6874,["874","static/chunks/874-8d3839f72fd80c3c.js","953","static/chunks/app/blog/%5Bslug%5D/page-677ab5ce4505fca7.js"],""]
13:T8a40,<p>プログラミング学習において「書いたコードをすぐに実行できる」環境は非常に重要です。本記事では、Go言語の学習に特化したWebベースの学習プラットフォームの設計について詳しく解説します。</p>
<h2>プロジェクト概要</h2>
<h3>ビジョン</h3>
<p>「Go言語を段階的に、実践的に学べるインタラクティブな学習環境」を提供し、初心者から中級者まで効率的にGo言語をマスターできるプラットフォームを構築します。</p>
<h3>主要機能</h3>
<ol>
<li><strong>ブラウザ上でのコード実行</strong>: インストール不要でGo言語を実行</li>
<li><strong>段階的な学習パス</strong>: 基礎から応用まで体系的なカリキュラム</li>
<li><strong>リアルタイムフィードバック</strong>: コード実行結果の即座な表示</li>
<li><strong>進捗管理</strong>: 学習の進行状況を可視化</li>
<li><strong>インタラクティブな課題</strong>: 実践的な問題を解きながら学習</li>
</ol>
<h2>技術スタック</h2>
<h3>フロントエンド</h3>
<pre><code class="language-yaml">UI Framework: Next.js 14 (App Router)
言語: TypeScript
スタイリング: Tailwind CSS + shadcn/ui
コードエディタ: Monaco Editor (VS Code エディタ)
状態管理: Zustand
認証: NextAuth.js
リアルタイム通信: WebSocket (Socket.io)
</code></pre>
<h3>バックエンド</h3>
<pre><code class="language-yaml">APIサーバー: Go (Echo or Gin framework)
コード実行環境: Docker + Kubernetes
サンドボックス: gVisor or Firecracker
キャッシュ: Redis
データベース: PostgreSQL
メッセージキュー: RabbitMQ or NATS
オブジェクトストレージ: MinIO or S3
</code></pre>
<h3>インフラストラクチャ</h3>
<pre><code class="language-yaml">コンテナオーケストレーション: Kubernetes
CI/CD: GitHub Actions + ArgoCD
モニタリング: Prometheus + Grafana
ログ管理: ELK Stack
CDN: CloudFlare
リバースプロキシ: Nginx or Traefik
</code></pre>
<h2>システムアーキテクチャ</h2>
<h3>全体構成図</h3>
<pre><code>┌──────────────────────────────────────────────────────┐
│                    CDN (CloudFlare)                   │
└────────────────────────┬─────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────┐
│              Load Balancer (Nginx/Traefik)           │
└────────────────────────┬─────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
┌───────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐
│  Frontend    │ │   API       │ │  WebSocket  │
│  (Next.js)   │ │  Server     │ │   Server    │
└──────────────┘ └──────┬──────┘ └──────────────┘
                        │
          ┌─────────────┼─────────────┐
          │             │             │
┌─────────▼────┐ ┌─────▼────┐ ┌─────▼─────┐
│  PostgreSQL  │ │  Redis   │ │ RabbitMQ  │
└──────────────┘ └──────────┘ └─────┬─────┘
                                     │
                              ┌──────▼──────┐
                              │  Execution  │
                              │   Workers   │
                              │  (Docker)   │
                              └─────────────┘
</code></pre>
<h3>コード実行フロー</h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant Frontend
    participant API
    participant Queue
    participant Worker
    participant Docker

    User->>Frontend: コード入力
    Frontend->>API: 実行リクエスト
    API->>Queue: ジョブ追加
    Queue->>Worker: ジョブ取得
    Worker->>Docker: コンテナ作成
    Docker->>Docker: コード実行
    Docker-->>Worker: 実行結果
    Worker-->>API: 結果送信
    API-->>Frontend: WebSocket通知
    Frontend-->>User: 結果表示
</code></pre>
<h2>コア機能の実装</h2>
<h3>1. セキュアなコード実行環境</h3>
<h4>Docker設定 (Dockerfile.sandbox)</h4>
<pre><code class="language-dockerfile">FROM golang:1.21-alpine AS builder

# セキュリティ向上のための非rootユーザー作成
RUN adduser -D -g '' appuser

WORKDIR /app

# 実行環境の制限設定
RUN apk add --no-cache \
    ca-certificates \
    &#x26;&#x26; rm -rf /var/cache/apk/*

FROM scratch

# 必要最小限のファイルのみコピー
COPY --from=builder /etc/passwd /etc/passwd
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

USER appuser

WORKDIR /sandbox

# リソース制限のデフォルト値
ENV GOMEMLIMIT=128MiB
ENV GOMAXPROCS=1

ENTRYPOINT ["/bin/sh"]
</code></pre>
<h4>コード実行サービス (Go)</h4>
<pre><code class="language-go">package executor

import (
    "context"
    "fmt"
    "io"
    "os"
    "os/exec"
    "time"
    
    "github.com/docker/docker/api/types"
    "github.com/docker/docker/api/types/container"
    "github.com/docker/docker/client"
)

type ExecutionRequest struct {
    ID       string `json:"id"`
    Code     string `json:"code"`
    Language string `json:"language"`
    Timeout  int    `json:"timeout"`
}

type ExecutionResult struct {
    ID       string `json:"id"`
    Output   string `json:"output"`
    Error    string `json:"error"`
    ExitCode int    `json:"exit_code"`
    Duration int64  `json:"duration"`
}

type CodeExecutor struct {
    dockerClient *client.Client
    maxTimeout   time.Duration
}

func NewCodeExecutor() (*CodeExecutor, error) {
    cli, err := client.NewClientWithOpts(client.FromEnv)
    if err != nil {
        return nil, err
    }
    
    return &#x26;CodeExecutor{
        dockerClient: cli,
        maxTimeout:   30 * time.Second,
    }, nil
}

func (e *CodeExecutor) Execute(req ExecutionRequest) (*ExecutionResult, error) {
    ctx, cancel := context.WithTimeout(context.Background(), e.maxTimeout)
    defer cancel()
    
    startTime := time.Now()
    
    // コードを一時ファイルに保存
    tmpFile, err := os.CreateTemp("", "code-*.go")
    if err != nil {
        return nil, err
    }
    defer os.Remove(tmpFile.Name())
    
    if _, err := tmpFile.WriteString(req.Code); err != nil {
        return nil, err
    }
    tmpFile.Close()
    
    // Dockerコンテナの設定
    config := &#x26;container.Config{
        Image: "golang-sandbox:latest",
        Cmd:   []string{"go", "run", "/code/main.go"},
        Env: []string{
            "GOMEMLIMIT=128MiB",
            "GOMAXPROCS=1",
        },
        WorkingDir: "/code",
        
        // リソース制限
        Memory:     128 * 1024 * 1024, // 128MB
        MemorySwap: 128 * 1024 * 1024, // スワップ無効
        CpuShares:  512,                // CPU制限
    }
    
    hostConfig := &#x26;container.HostConfig{
        AutoRemove: true,
        
        // セキュリティ設定
        ReadonlyRootfs: true,
        SecurityOpt:    []string{"no-new-privileges"},
        CapDrop:        []string{"ALL"},
        NetworkMode:    "none", // ネットワーク無効
        
        // ファイルマウント
        Binds: []string{
            fmt.Sprintf("%s:/code/main.go:ro", tmpFile.Name()),
        },
    }
    
    // コンテナ作成と実行
    resp, err := e.dockerClient.ContainerCreate(
        ctx,
        config,
        hostConfig,
        nil,
        nil,
        "",
    )
    if err != nil {
        return nil, err
    }
    
    if err := e.dockerClient.ContainerStart(ctx, resp.ID, types.ContainerStartOptions{}); err != nil {
        return nil, err
    }
    
    // 実行結果の取得
    statusCh, errCh := e.dockerClient.ContainerWait(ctx, resp.ID, container.WaitConditionNotRunning)
    select {
    case err := &#x3C;-errCh:
        if err != nil {
            return nil, err
        }
    case status := &#x3C;-statusCh:
        // ログ取得
        logs, err := e.dockerClient.ContainerLogs(ctx, resp.ID, types.ContainerLogsOptions{
            ShowStdout: true,
            ShowStderr: true,
        })
        if err != nil {
            return nil, err
        }
        defer logs.Close()
        
        output, _ := io.ReadAll(logs)
        
        return &#x26;ExecutionResult{
            ID:       req.ID,
            Output:   string(output),
            ExitCode: int(status.StatusCode),
            Duration: time.Since(startTime).Milliseconds(),
        }, nil
    }
    
    return nil, fmt.Errorf("execution failed")
}
</code></pre>
<h3>2. 学習コンテンツ管理システム</h3>
<h4>データベース設計</h4>
<pre><code class="language-sql">-- ユーザーテーブル
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- コーステーブル
CREATE TABLE courses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),
    estimated_hours INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- レッスンテーブル
CREATE TABLE lessons (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    order_index INTEGER NOT NULL,
    lesson_type VARCHAR(50) CHECK (lesson_type IN ('tutorial', 'exercise', 'project')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 課題テーブル
CREATE TABLE challenges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    starter_code TEXT,
    solution_code TEXT,
    test_cases JSONB,
    hints JSONB,
    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 進捗管理テーブル
CREATE TABLE user_progress (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,
    challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,
    status VARCHAR(50) CHECK (status IN ('not_started', 'in_progress', 'completed')),
    score INTEGER,
    attempts INTEGER DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, lesson_id, challenge_id)
);

-- 実行履歴テーブル
CREATE TABLE execution_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,
    code TEXT NOT NULL,
    output TEXT,
    error TEXT,
    execution_time_ms INTEGER,
    success BOOLEAN,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- インデックス
CREATE INDEX idx_user_progress_user_id ON user_progress(user_id);
CREATE INDEX idx_user_progress_status ON user_progress(status);
CREATE INDEX idx_execution_history_user_id ON execution_history(user_id);
CREATE INDEX idx_execution_history_created_at ON execution_history(created_at);
</code></pre>
<h3>3. フロントエンド実装</h3>
<h4>コードエディタコンポーネント (React/TypeScript)</h4>
<pre><code class="language-typescript">import React, { useState, useRef, useEffect } from 'react';
import Editor, { Monaco } from '@monaco-editor/react';
import { Button } from '@/components/ui/button';
import { Play, RotateCcw, Save } from 'lucide-react';

interface CodeEditorProps {
  initialCode?: string;
  challengeId: string;
  onExecute: (code: string) => Promise&#x3C;ExecutionResult>;
  onSave?: (code: string) => void;
}

interface ExecutionResult {
  output: string;
  error?: string;
  executionTime: number;
  success: boolean;
}

export const CodeEditor: React.FC&#x3C;CodeEditorProps> = ({
  initialCode = '',
  challengeId,
  onExecute,
  onSave,
}) => {
  const [code, setCode] = useState(initialCode);
  const [output, setOutput] = useState&#x3C;string>('');
  const [isExecuting, setIsExecuting] = useState(false);
  const [executionTime, setExecutionTime] = useState&#x3C;number>(0);
  const editorRef = useRef&#x3C;any>(null);

  const defaultCode = `package main

import "fmt"

func main() {
    fmt.Println("Hello, Go!")
}`;

  useEffect(() => {
    // ローカルストレージから保存されたコードを読み込み
    const savedCode = localStorage.getItem(`challenge-${challengeId}`);
    if (savedCode) {
      setCode(savedCode);
    }
  }, [challengeId]);

  const handleEditorDidMount = (editor: any, monaco: Monaco) => {
    editorRef.current = editor;
    
    // Go言語のシンタックスハイライト設定
    monaco.languages.register({ id: 'go' });
    monaco.languages.setMonarchTokensProvider('go', {
      keywords: [
        'break', 'case', 'chan', 'const', 'continue', 'default',
        'defer', 'else', 'fallthrough', 'for', 'func', 'go',
        'goto', 'if', 'import', 'interface', 'map', 'package',
        'range', 'return', 'select', 'struct', 'switch', 'type', 'var',
      ],
      
      typeKeywords: [
        'bool', 'byte', 'complex64', 'complex128', 'error', 'float32',
        'float64', 'int', 'int8', 'int16', 'int32', 'int64', 'rune',
        'string', 'uint', 'uint8', 'uint16', 'uint32', 'uint64', 'uintptr',
      ],
      
      operators: [
        '=', '>', '&#x3C;', '!', '~', '?', ':', '==', '&#x3C;=', '>=', '!=',
        '&#x26;&#x26;', '||', '++', '--', '+', '-', '*', '/', '&#x26;', '|', '^',
        '%', '&#x3C;&#x3C;', '>>', '>>>', '+=', '-=', '*=', '/=', '&#x26;=', '|=',
        '^=', '%=', '&#x3C;&#x3C;=', '>>=', '>>>=',
      ],
      
      tokenizer: {
        root: [
          [/[a-z_$][\w$]*/, {
            cases: {
              '@typeKeywords': 'keyword',
              '@keywords': 'keyword',
              '@default': 'identifier',
            },
          }],
          [/[A-Z][\w$]*/, 'type.identifier'],
          { include: '@whitespace' },
          [/[{}()\[\]]/, '@brackets'],
          [/[&#x3C;>](?!@symbols)/, '@brackets'],
          [/@symbols/, {
            cases: {
              '@operators': 'operator',
              '@default': '',
            },
          }],
          [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float'],
          [/0[xX][0-9a-fA-F]+/, 'number.hex'],
          [/\d+/, 'number'],
          [/[;,.]/, 'delimiter'],
          [/"([^"\\]|\\.)*$/, 'string.invalid'],
          [/"/, { token: 'string.quote', bracket: '@open', next: '@string' }],
          [/'[^\\']'/, 'string'],
          [/(')(@escapes)(')/, ['string', 'string.escape', 'string']],
          [/'/, 'string.invalid'],
        ],
        
        whitespace: [
          [/[ \t\r\n]+/, 'white'],
          [/\/\*/, 'comment', '@comment'],
          [/\/\/.*$/, 'comment'],
        ],
        
        comment: [
          [/[^\/*]+/, 'comment'],
          [/\/\*/, 'comment', '@push'],
          ['\\*/', 'comment', '@pop'],
          [/[\/*]/, 'comment'],
        ],
        
        string: [
          [/[^\\"]+/, 'string'],
          [/@escapes/, 'string.escape'],
          [/\\./, 'string.escape.invalid'],
          [/"/, { token: 'string.quote', bracket: '@close', next: '@pop' }],
        ],
      },
    });

    // ショートカットキーの設定
    editor.addAction({
      id: 'execute-code',
      label: 'Execute Code',
      keybindings: [monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter],
      run: () => handleExecute(),
    });
  };

  const handleExecute = async () => {
    setIsExecuting(true);
    setOutput('実行中...');
    
    const startTime = Date.now();
    
    try {
      const result = await onExecute(code);
      setExecutionTime(Date.now() - startTime);
      
      if (result.success) {
        setOutput(result.output);
      } else {
        setOutput(`エラー: ${result.error || '実行に失敗しました'}`);
      }
    } catch (error) {
      setOutput(`エラー: ${error}`);
    } finally {
      setIsExecuting(false);
    }
  };

  const handleSave = () => {
    localStorage.setItem(`challenge-${challengeId}`, code);
    if (onSave) {
      onSave(code);
    }
  };

  const handleReset = () => {
    setCode(defaultCode);
    setOutput('');
    setExecutionTime(0);
  };

  return (
    &#x3C;div className="flex flex-col h-full">
      &#x3C;div className="flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-800 border-b">
        &#x3C;div className="flex items-center gap-2">
          &#x3C;Button
            onClick={handleExecute}
            disabled={isExecuting}
            size="sm"
            className="flex items-center gap-2"
          >
            &#x3C;Play className="w-4 h-4" />
            実行 (Cmd+Enter)
          &#x3C;/Button>
          &#x3C;Button
            onClick={handleSave}
            variant="outline"
            size="sm"
            className="flex items-center gap-2"
          >
            &#x3C;Save className="w-4 h-4" />
            保存
          &#x3C;/Button>
          &#x3C;Button
            onClick={handleReset}
            variant="outline"
            size="sm"
            className="flex items-center gap-2"
          >
            &#x3C;RotateCcw className="w-4 h-4" />
            リセット
          &#x3C;/Button>
        &#x3C;/div>
        {executionTime > 0 &#x26;&#x26; (
          &#x3C;span className="text-sm text-gray-600">
            実行時間: {executionTime}ms
          &#x3C;/span>
        )}
      &#x3C;/div>
      
      &#x3C;div className="flex-1 grid grid-cols-2 gap-2">
        &#x3C;div className="border rounded-lg overflow-hidden">
          &#x3C;Editor
            height="100%"
            defaultLanguage="go"
            value={code}
            onChange={(value) => setCode(value || '')}
            onMount={handleEditorDidMount}
            theme="vs-dark"
            options={{
              minimap: { enabled: false },
              fontSize: 14,
              lineNumbers: 'on',
              roundedSelection: false,
              scrollBeyondLastLine: false,
              automaticLayout: true,
              tabSize: 4,
              insertSpaces: false,
            }}
          />
        &#x3C;/div>
        
        &#x3C;div className="border rounded-lg bg-gray-900 text-gray-100 p-4 overflow-auto">
          &#x3C;div className="font-mono text-sm whitespace-pre-wrap">
            {output || 'ここに実行結果が表示されます'}
          &#x3C;/div>
        &#x3C;/div>
      &#x3C;/div>
    &#x3C;/div>
  );
};
</code></pre>
<h3>4. APIサーバー実装 (Go/Echo)</h3>
<pre><code class="language-go">package main

import (
    "net/http"
    "time"
    
    "github.com/labstack/echo/v4"
    "github.com/labstack/echo/v4/middleware"
    "github.com/gorilla/websocket"
)

type Server struct {
    executor *CodeExecutor
    db       *sql.DB
    cache    *redis.Client
    upgrader websocket.Upgrader
}

func NewServer() (*Server, error) {
    executor, err := NewCodeExecutor()
    if err != nil {
        return nil, err
    }
    
    // データベース接続
    db, err := sql.Open("postgres", os.Getenv("DATABASE_URL"))
    if err != nil {
        return nil, err
    }
    
    // Redis接続
    cache := redis.NewClient(&#x26;redis.Options{
        Addr: os.Getenv("REDIS_URL"),
    })
    
    return &#x26;Server{
        executor: executor,
        db:       db,
        cache:    cache,
        upgrader: websocket.Upgrader{
            CheckOrigin: func(r *http.Request) bool {
                return true // 本番環境では適切に設定
            },
        },
    }, nil
}

func (s *Server) ExecuteCode(c echo.Context) error {
    var req ExecutionRequest
    if err := c.Bind(&#x26;req); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{
            "error": "Invalid request",
        })
    }
    
    // レート制限チェック
    userID := c.Get("user_id").(string)
    if err := s.checkRateLimit(userID); err != nil {
        return c.JSON(http.StatusTooManyRequests, map[string]string{
            "error": "Rate limit exceeded",
        })
    }
    
    // コードの検証
    if err := s.validateCode(req.Code); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{
            "error": err.Error(),
        })
    }
    
    // 実行
    result, err := s.executor.Execute(req)
    if err != nil {
        return c.JSON(http.StatusInternalServerError, map[string]string{
            "error": "Execution failed",
        })
    }
    
    // 実行履歴を保存
    go s.saveExecutionHistory(userID, req, result)
    
    return c.JSON(http.StatusOK, result)
}

func (s *Server) checkRateLimit(userID string) error {
    key := fmt.Sprintf("rate_limit:%s", userID)
    
    // 1分間に10回まで
    count, err := s.cache.Incr(ctx, key).Result()
    if err != nil {
        return err
    }
    
    if count == 1 {
        s.cache.Expire(ctx, key, time.Minute)
    }
    
    if count > 10 {
        return fmt.Errorf("rate limit exceeded")
    }
    
    return nil
}

func (s *Server) validateCode(code string) error {
    // 危険なパッケージのインポートをチェック
    dangerousPackages := []string{
        "os/exec",
        "syscall",
        "unsafe",
        "net",
        "net/http",
    }
    
    for _, pkg := range dangerousPackages {
        if strings.Contains(code, fmt.Sprintf(`import "%s"`, pkg)) ||
           strings.Contains(code, fmt.Sprintf(`import ( "%s"`, pkg)) {
            return fmt.Errorf("package %s is not allowed", pkg)
        }
    }
    
    // コードサイズ制限（10KB）
    if len(code) > 10*1024 {
        return fmt.Errorf("code size exceeds limit")
    }
    
    return nil
}

func main() {
    e := echo.New()
    
    // ミドルウェア
    e.Use(middleware.Logger())
    e.Use(middleware.Recover())
    e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
        AllowOrigins: []string{"http://localhost:3000"},
        AllowMethods: []string{http.MethodGet, http.MethodPost},
    }))
    
    server, err := NewServer()
    if err != nil {
        e.Logger.Fatal(err)
    }
    
    // ルート定義
    api := e.Group("/api/v1")
    api.POST("/execute", server.ExecuteCode)
    api.GET("/challenges/:id", server.GetChallenge)
    api.POST("/challenges/:id/submit", server.SubmitSolution)
    api.GET("/progress", server.GetUserProgress)
    
    // WebSocket
    e.GET("/ws", server.HandleWebSocket)
    
    e.Logger.Fatal(e.Start(":8080"))
}
</code></pre>
<h2>学習コンテンツの設計</h2>
<h3>カリキュラム構成</h3>
<pre><code class="language-yaml">基礎編（Beginner）:
  1. Hello World:
    - Goの基本構文
    - パッケージとインポート
    - main関数
    
  2. 変数とデータ型:
    - 変数宣言
    - 基本データ型
    - 型推論
    
  3. 制御構造:
    - if文
    - for文
    - switch文
    
  4. 関数:
    - 関数定義
    - 引数と戻り値
    - 複数戻り値

中級編（Intermediate）:
  1. 配列とスライス:
    - 配列の基本
    - スライスの操作
    - make関数
    
  2. マップ:
    - マップの作成
    - 要素の追加・削除
    - 範囲for文
    
  3. 構造体:
    - 構造体定義
    - メソッド
    - ポインタレシーバー
    
  4. インターフェース:
    - インターフェース定義
    - 実装
    - 型アサーション

上級編（Advanced）:
  1. 並行処理:
    - goroutine
    - channel
    - select文
    
  2. エラーハンドリング:
    - error型
    - panicとrecover
    - カスタムエラー
    
  3. テスト:
    - 単体テスト
    - ベンチマーク
    - テストカバレッジ
    
  4. パッケージ管理:
    - go mod
    - 依存関係管理
    - バージョニング
</code></pre>
<h3>課題例</h3>
<pre><code class="language-go">// レベル1: Hello World
// 課題: "Hello, [名前]!" を出力する関数を作成

package main

import "fmt"

func greet(name string) string {
    // ここにコードを書いてください
    return ""
}

func main() {
    result := greet("Gopher")
    fmt.Println(result) // 期待値: "Hello, Gopher!"
}

// テストケース
func TestGreet(t *testing.T) {
    tests := []struct {
        input    string
        expected string
    }{
        {"Gopher", "Hello, Gopher!"},
        {"World", "Hello, World!"},
        {"", "Hello, !"},
    }
    
    for _, test := range tests {
        result := greet(test.input)
        if result != test.expected {
            t.Errorf("greet(%q) = %q; want %q",
                test.input, result, test.expected)
        }
    }
}
</code></pre>
<h2>セキュリティ対策</h2>
<h3>1. コード実行環境の隔離</h3>
<ul>
<li><strong>Dockerコンテナ</strong>: 各実行を独立したコンテナで実行</li>
<li><strong>リソース制限</strong>: CPU、メモリ、実行時間の制限</li>
<li><strong>ネットワーク隔離</strong>: 外部ネットワークへのアクセスを遮断</li>
<li><strong>読み取り専用ファイルシステム</strong>: システムファイルの改変を防止</li>
</ul>
<h3>2. 入力検証</h3>
<pre><code class="language-go">func validateUserInput(code string) error {
    // SQLインジェクション対策
    if strings.Contains(strings.ToLower(code), "drop table") {
        return errors.New("suspicious SQL command detected")
    }
    
    // OSコマンドインジェクション対策
    dangerousCommands := []string{
        "rm ", "dd ", "mkfs", "chmod", "chown",
    }
    for _, cmd := range dangerousCommands {
        if strings.Contains(code, cmd) {
            return errors.New("dangerous system command detected")
        }
    }
    
    return nil
}
</code></pre>
<h3>3. レート制限</h3>
<pre><code class="language-go">type RateLimiter struct {
    mu       sync.Mutex
    requests map[string][]time.Time
}

func (r *RateLimiter) Allow(userID string) bool {
    r.mu.Lock()
    defer r.mu.Unlock()
    
    now := time.Now()
    windowStart := now.Add(-time.Minute)
    
    // 古いリクエストを削除
    if requests, exists := r.requests[userID]; exists {
        var filtered []time.Time
        for _, t := range requests {
            if t.After(windowStart) {
                filtered = append(filtered, t)
            }
        }
        r.requests[userID] = filtered
    }
    
    // リクエスト数をチェック
    if len(r.requests[userID]) >= 10 {
        return false
    }
    
    // 新しいリクエストを追加
    r.requests[userID] = append(r.requests[userID], now)
    return true
}
</code></pre>
<h2>パフォーマンス最適化</h2>
<h3>1. コード実行のキャッシング</h3>
<pre><code class="language-go">func (s *Server) getCachedResult(codeHash string) (*ExecutionResult, error) {
    key := fmt.Sprintf("execution:%s", codeHash)
    
    val, err := s.cache.Get(ctx, key).Result()
    if err == redis.Nil {
        return nil, nil
    }
    if err != nil {
        return nil, err
    }
    
    var result ExecutionResult
    if err := json.Unmarshal([]byte(val), &#x26;result); err != nil {
        return nil, err
    }
    
    return &#x26;result, nil
}

func (s *Server) cacheResult(codeHash string, result *ExecutionResult) error {
    key := fmt.Sprintf("execution:%s", codeHash)
    
    data, err := json.Marshal(result)
    if err != nil {
        return err
    }
    
    // 1時間キャッシュ
    return s.cache.Set(ctx, key, data, time.Hour).Err()
}
</code></pre>
<h3>2. コンテナプールの実装</h3>
<pre><code class="language-go">type ContainerPool struct {
    mu         sync.Mutex
    containers chan string
    maxSize    int
}

func NewContainerPool(size int) *ContainerPool {
    pool := &#x26;ContainerPool{
        containers: make(chan string, size),
        maxSize:    size,
    }
    
    // 事前にコンテナを作成
    for i := 0; i &#x3C; size; i++ {
        go pool.createContainer()
    }
    
    return pool
}

func (p *ContainerPool) Get() (string, error) {
    select {
    case containerID := &#x3C;-p.containers:
        return containerID, nil
    case &#x3C;-time.After(5 * time.Second):
        // タイムアウト時は新規作成
        return p.createNewContainer()
    }
}

func (p *ContainerPool) Put(containerID string) {
    select {
    case p.containers &#x3C;- containerID:
        // プールに戻す
    default:
        // プールが満杯の場合は削除
        p.removeContainer(containerID)
    }
}
</code></pre>
<h2>モニタリングとログ</h2>
<h3>Prometheus メトリクス</h3>
<pre><code class="language-go">var (
    executionCounter = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "code_executions_total",
            Help: "Total number of code executions",
        },
        []string{"status", "language"},
    )
    
    executionDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name:    "code_execution_duration_seconds",
            Help:    "Code execution duration in seconds",
            Buckets: prometheus.DefBuckets,
        },
        []string{"language"},
    )
)

func init() {
    prometheus.MustRegister(executionCounter)
    prometheus.MustRegister(executionDuration)
}
</code></pre>
<h3>構造化ログ</h3>
<pre><code class="language-go">import "go.uber.org/zap"

func setupLogger() *zap.Logger {
    config := zap.NewProductionConfig()
    config.OutputPaths = []string{"stdout"}
    config.ErrorOutputPaths = []string{"stderr"}
    
    logger, _ := config.Build()
    return logger
}

// 使用例
logger.Info("Code execution started",
    zap.String("user_id", userID),
    zap.String("challenge_id", challengeID),
    zap.Int("code_length", len(code)),
)
</code></pre>
<h2>デプロイメント</h2>
<h3>Kubernetes マニフェスト</h3>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: go-learning-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: go-learning-api
  template:
    metadata:
      labels:
        app: go-learning-api
    spec:
      containers:
      - name: api
        image: go-learning/api:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        - name: REDIS_URL
          value: redis-service:6379
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: go-learning-api-service
spec:
  selector:
    app: go-learning-api
  ports:
  - port: 80
    targetPort: 8080
  type: LoadBalancer
</code></pre>
<h3>CI/CD パイプライン (GitHub Actions)</h3>
<pre><code class="language-yaml">name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
    
    - name: Run tests
      run: |
        go test -v ./...
        go test -race -coverprofile=coverage.txt ./...
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.txt

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Docker image
      run: |
        docker build -t go-learning/api:${{ github.sha }} .
        docker tag go-learning/api:${{ github.sha }} go-learning/api:latest
    
    - name: Push to registry
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push go-learning/api:${{ github.sha }}
        docker push go-learning/api:latest

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
    - name: Deploy to Kubernetes
      run: |
        kubectl set image deployment/go-learning-api api=go-learning/api:${{ github.sha }}
        kubectl rollout status deployment/go-learning-api
</code></pre>
<h2>まとめ</h2>
<p>このGo言語学習プラットフォームの設計では、以下の点に重点を置きました：</p>
<ol>
<li><strong>セキュリティ</strong>: Dockerコンテナによる隔離、入力検証、レート制限</li>
<li><strong>スケーラビリティ</strong>: Kubernetes、コンテナプール、キャッシング</li>
<li><strong>ユーザー体験</strong>: リアルタイム実行、即座のフィードバック、進捗管理</li>
<li><strong>教育的価値</strong>: 段階的な学習パス、実践的な課題、詳細な解説</li>
</ol>
<p>これらの要素を組み合わせることで、安全で効率的、かつ教育効果の高い学習プラットフォームを構築できます。</p>
<h2>次のステップ</h2>
<ol>
<li><strong>MVP開発</strong>: 基本機能の実装とテスト</li>
<li><strong>コンテンツ作成</strong>: 学習教材と課題の充実</li>
<li><strong>ユーザーテスト</strong>: フィードバックの収集と改善</li>
<li><strong>機能拡張</strong>: AI による学習支援、コードレビュー機能</li>
<li><strong>コミュニティ機能</strong>: フォーラム、コード共有、メンタリング</li>
</ol>
<p>このプラットフォームを通じて、多くの開発者がGo言語を効率的に学び、実践的なスキルを身につけることができるでしょう。</p>
4:["$","div",null,{"className":"max-w-2xl mx-auto py-10 px-4","children":[["$","h1",null,{"className":"text-3xl font-bold mb-2","children":[["$","span",null,{"className":"text-green-600","children":["#",25]}]," ","Go言語学習プラットフォーム設計書：ブラウザで動くコード実行環境の構築"]}],["$","ul",null,{"className":"list-none border-b border-gray-600 pb-4 mb-6","children":[["$","li",null,{"className":"text-gray-500 text-sm","children":["作成日時: ","2025-08-09 05:56"]}],"$undefined",["$","li",null,{"className":"flex flex-wrap gap-2 mt-2","children":[["$","span","0",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"Go"}],["$","span","1",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"WebAssembly"}],["$","span","2",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"教育"}],["$","span","3",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"システム設計"}],["$","span","4",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"Docker"}],["$","span","5",{"className":"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs","children":"Kubernetes"}]]}]]}],["$","nav",null,{"className":"mb-6 pb-4 border-b border-gray-700 flex justify-between","children":[["$","$L12",null,{"href":"/","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"← ホームへ"}],["$","$L12",null,{"href":"/blog","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"記事一覧へ →"}]]}],["$","article",null,{"className":"prose dark:prose-invert","dangerouslySetInnerHTML":{"__html":"$13"}}],["$","nav",null,{"className":"mt-8 pt-4 border-t border-gray-700 flex justify-between","children":[["$","$L12",null,{"href":"/","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"← ホームへ"}],["$","$L12",null,{"href":"/blog","className":"text-blue-400 hover:text-blue-300 hover:underline","children":"記事一覧へ →"}]]}]]}]
d:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
8:null
11:{"metadata":[["$","title","0",{"children":"Maita Tomoya Dev IO"}],["$","meta","1",{"name":"description","content":"米田智哉の技術ブログ。キャッチアップしたことをメモします。"}]],"error":null,"digest":"$undefined"}
b:{"metadata":"$11:metadata","error":null,"digest":"$undefined"}
