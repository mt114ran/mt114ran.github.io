<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/ce87a0c8fce915ba.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-29ebadaebe2fcb3f.js"/><script src="/_next/static/chunks/4bd1b696-d8f047cced1b4886.js" async=""></script><script src="/_next/static/chunks/684-8e4d9e1e4139006e.js" async=""></script><script src="/_next/static/chunks/main-app-d1c324b32b03123c.js" async=""></script><script src="/_next/static/chunks/874-8d3839f72fd80c3c.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-677ab5ce4505fca7.js" async=""></script><meta name="next-size-adjust" content=""/><link rel="icon" href="/favicon.png" type="image/png"/><title>Maita Tomoya Dev IO</title><meta name="description" content="米田智哉の技術ブログ。キャッチアップしたことをメモします。"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 antialiased"><div class="max-w-2xl mx-auto py-10 px-4"><h1 class="text-3xl font-bold mb-2"><span class="text-green-600">#<!-- -->27</span> <!-- -->Go言語学習プラットフォーム設計書：ブラウザで動くコード実行環境の構築</h1><ul class="list-none border-b border-gray-600 pb-4 mb-6"><li class="text-gray-500 text-sm">作成日時: <!-- -->2025-08-09 05:56</li><li class="flex flex-wrap gap-2 mt-2"><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Go</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">WebAssembly</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">教育</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">システム設計</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Docker</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Kubernetes</span></li></ul><nav class="mb-6 pb-4 border-b border-gray-700 flex justify-between"><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/">← ホームへ</a><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/blog/">記事一覧へ →</a></nav><article class="prose dark:prose-invert"><p>プログラミング学習において「書いたコードをすぐに実行できる」環境は非常に重要です。本記事では、Go言語の学習に特化したWebベースの学習プラットフォームの設計について詳しく解説します。</p>
<h2>プロジェクト概要</h2>
<h3>ビジョン</h3>
<p>「Go言語を段階的に、実践的に学べるインタラクティブな学習環境」を提供し、初心者から中級者まで効率的にGo言語をマスターできるプラットフォームを構築します。</p>
<h3>主要機能</h3>
<ol>
<li><strong>ブラウザ上でのコード実行</strong>: インストール不要でGo言語を実行</li>
<li><strong>段階的な学習パス</strong>: 基礎から応用まで体系的なカリキュラム</li>
<li><strong>リアルタイムフィードバック</strong>: コード実行結果の即座な表示</li>
<li><strong>進捗管理</strong>: 学習の進行状況を可視化</li>
<li><strong>インタラクティブな課題</strong>: 実践的な問題を解きながら学習</li>
</ol>
<h2>技術スタック</h2>
<h3>フロントエンド</h3>
<pre><code class="language-yaml">UI Framework: Next.js 14 (App Router)
言語: TypeScript
スタイリング: Tailwind CSS + shadcn/ui
コードエディタ: Monaco Editor (VS Code エディタ)
状態管理: Zustand
認証: NextAuth.js
リアルタイム通信: WebSocket (Socket.io)
</code></pre>
<h3>バックエンド</h3>
<pre><code class="language-yaml">APIサーバー: Go (Echo or Gin framework)
コード実行環境: Docker + Kubernetes
サンドボックス: gVisor or Firecracker
キャッシュ: Redis
データベース: PostgreSQL
メッセージキュー: RabbitMQ or NATS
オブジェクトストレージ: MinIO or S3
</code></pre>
<h3>インフラストラクチャ</h3>
<pre><code class="language-yaml">コンテナオーケストレーション: Kubernetes
CI/CD: GitHub Actions + ArgoCD
モニタリング: Prometheus + Grafana
ログ管理: ELK Stack
CDN: CloudFlare
リバースプロキシ: Nginx or Traefik
</code></pre>
<h2>システムアーキテクチャ</h2>
<h3>全体構成図</h3>
<pre><code>┌──────────────────────────────────────────────────────┐
│                    CDN (CloudFlare)                   │
└────────────────────────┬─────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────┐
│              Load Balancer (Nginx/Traefik)           │
└────────────────────────┬─────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
┌───────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐
│  Frontend    │ │   API       │ │  WebSocket  │
│  (Next.js)   │ │  Server     │ │   Server    │
└──────────────┘ └──────┬──────┘ └──────────────┘
                        │
          ┌─────────────┼─────────────┐
          │             │             │
┌─────────▼────┐ ┌─────▼────┐ ┌─────▼─────┐
│  PostgreSQL  │ │  Redis   │ │ RabbitMQ  │
└──────────────┘ └──────────┘ └─────┬─────┘
                                     │
                              ┌──────▼──────┐
                              │  Execution  │
                              │   Workers   │
                              │  (Docker)   │
                              └─────────────┘
</code></pre>
<h3>コード実行フロー</h3>
<pre><code class="language-mermaid">sequenceDiagram
    participant User
    participant Frontend
    participant API
    participant Queue
    participant Worker
    participant Docker

    User->>Frontend: コード入力
    Frontend->>API: 実行リクエスト
    API->>Queue: ジョブ追加
    Queue->>Worker: ジョブ取得
    Worker->>Docker: コンテナ作成
    Docker->>Docker: コード実行
    Docker-->>Worker: 実行結果
    Worker-->>API: 結果送信
    API-->>Frontend: WebSocket通知
    Frontend-->>User: 結果表示
</code></pre>
<h2>コア機能の実装</h2>
<h3>1. セキュアなコード実行環境</h3>
<h4>Docker設定 (Dockerfile.sandbox)</h4>
<pre><code class="language-dockerfile">FROM golang:1.21-alpine AS builder

# セキュリティ向上のための非rootユーザー作成
RUN adduser -D -g '' appuser

WORKDIR /app

# 実行環境の制限設定
RUN apk add --no-cache \
    ca-certificates \
    &#x26;&#x26; rm -rf /var/cache/apk/*

FROM scratch

# 必要最小限のファイルのみコピー
COPY --from=builder /etc/passwd /etc/passwd
COPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/

USER appuser

WORKDIR /sandbox

# リソース制限のデフォルト値
ENV GOMEMLIMIT=128MiB
ENV GOMAXPROCS=1

ENTRYPOINT ["/bin/sh"]
</code></pre>
<h4>コード実行サービス (Go)</h4>
<pre><code class="language-go">package executor

import (
    "context"
    "fmt"
    "io"
    "os"
    "os/exec"
    "time"
    
    "github.com/docker/docker/api/types"
    "github.com/docker/docker/api/types/container"
    "github.com/docker/docker/client"
)

type ExecutionRequest struct {
    ID       string `json:"id"`
    Code     string `json:"code"`
    Language string `json:"language"`
    Timeout  int    `json:"timeout"`
}

type ExecutionResult struct {
    ID       string `json:"id"`
    Output   string `json:"output"`
    Error    string `json:"error"`
    ExitCode int    `json:"exit_code"`
    Duration int64  `json:"duration"`
}

type CodeExecutor struct {
    dockerClient *client.Client
    maxTimeout   time.Duration
}

func NewCodeExecutor() (*CodeExecutor, error) {
    cli, err := client.NewClientWithOpts(client.FromEnv)
    if err != nil {
        return nil, err
    }
    
    return &#x26;CodeExecutor{
        dockerClient: cli,
        maxTimeout:   30 * time.Second,
    }, nil
}

func (e *CodeExecutor) Execute(req ExecutionRequest) (*ExecutionResult, error) {
    ctx, cancel := context.WithTimeout(context.Background(), e.maxTimeout)
    defer cancel()
    
    startTime := time.Now()
    
    // コードを一時ファイルに保存
    tmpFile, err := os.CreateTemp("", "code-*.go")
    if err != nil {
        return nil, err
    }
    defer os.Remove(tmpFile.Name())
    
    if _, err := tmpFile.WriteString(req.Code); err != nil {
        return nil, err
    }
    tmpFile.Close()
    
    // Dockerコンテナの設定
    config := &#x26;container.Config{
        Image: "golang-sandbox:latest",
        Cmd:   []string{"go", "run", "/code/main.go"},
        Env: []string{
            "GOMEMLIMIT=128MiB",
            "GOMAXPROCS=1",
        },
        WorkingDir: "/code",
        
        // リソース制限
        Memory:     128 * 1024 * 1024, // 128MB
        MemorySwap: 128 * 1024 * 1024, // スワップ無効
        CpuShares:  512,                // CPU制限
    }
    
    hostConfig := &#x26;container.HostConfig{
        AutoRemove: true,
        
        // セキュリティ設定
        ReadonlyRootfs: true,
        SecurityOpt:    []string{"no-new-privileges"},
        CapDrop:        []string{"ALL"},
        NetworkMode:    "none", // ネットワーク無効
        
        // ファイルマウント
        Binds: []string{
            fmt.Sprintf("%s:/code/main.go:ro", tmpFile.Name()),
        },
    }
    
    // コンテナ作成と実行
    resp, err := e.dockerClient.ContainerCreate(
        ctx,
        config,
        hostConfig,
        nil,
        nil,
        "",
    )
    if err != nil {
        return nil, err
    }
    
    if err := e.dockerClient.ContainerStart(ctx, resp.ID, types.ContainerStartOptions{}); err != nil {
        return nil, err
    }
    
    // 実行結果の取得
    statusCh, errCh := e.dockerClient.ContainerWait(ctx, resp.ID, container.WaitConditionNotRunning)
    select {
    case err := &#x3C;-errCh:
        if err != nil {
            return nil, err
        }
    case status := &#x3C;-statusCh:
        // ログ取得
        logs, err := e.dockerClient.ContainerLogs(ctx, resp.ID, types.ContainerLogsOptions{
            ShowStdout: true,
            ShowStderr: true,
        })
        if err != nil {
            return nil, err
        }
        defer logs.Close()
        
        output, _ := io.ReadAll(logs)
        
        return &#x26;ExecutionResult{
            ID:       req.ID,
            Output:   string(output),
            ExitCode: int(status.StatusCode),
            Duration: time.Since(startTime).Milliseconds(),
        }, nil
    }
    
    return nil, fmt.Errorf("execution failed")
}
</code></pre>
<h3>2. 学習コンテンツ管理システム</h3>
<h4>データベース設計</h4>
<pre><code class="language-sql">-- ユーザーテーブル
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- コーステーブル
CREATE TABLE courses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),
    estimated_hours INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- レッスンテーブル
CREATE TABLE lessons (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    order_index INTEGER NOT NULL,
    lesson_type VARCHAR(50) CHECK (lesson_type IN ('tutorial', 'exercise', 'project')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 課題テーブル
CREATE TABLE challenges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    starter_code TEXT,
    solution_code TEXT,
    test_cases JSONB,
    hints JSONB,
    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 進捗管理テーブル
CREATE TABLE user_progress (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,
    challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,
    status VARCHAR(50) CHECK (status IN ('not_started', 'in_progress', 'completed')),
    score INTEGER,
    attempts INTEGER DEFAULT 0,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(user_id, lesson_id, challenge_id)
);

-- 実行履歴テーブル
CREATE TABLE execution_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,
    code TEXT NOT NULL,
    output TEXT,
    error TEXT,
    execution_time_ms INTEGER,
    success BOOLEAN,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- インデックス
CREATE INDEX idx_user_progress_user_id ON user_progress(user_id);
CREATE INDEX idx_user_progress_status ON user_progress(status);
CREATE INDEX idx_execution_history_user_id ON execution_history(user_id);
CREATE INDEX idx_execution_history_created_at ON execution_history(created_at);
</code></pre>
<h3>3. フロントエンド実装</h3>
<h4>コードエディタコンポーネント (React/TypeScript)</h4>
<pre><code class="language-typescript">import React, { useState, useRef, useEffect } from 'react';
import Editor, { Monaco } from '@monaco-editor/react';
import { Button } from '@/components/ui/button';
import { Play, RotateCcw, Save } from 'lucide-react';

interface CodeEditorProps {
  initialCode?: string;
  challengeId: string;
  onExecute: (code: string) => Promise&#x3C;ExecutionResult>;
  onSave?: (code: string) => void;
}

interface ExecutionResult {
  output: string;
  error?: string;
  executionTime: number;
  success: boolean;
}

export const CodeEditor: React.FC&#x3C;CodeEditorProps> = ({
  initialCode = '',
  challengeId,
  onExecute,
  onSave,
}) => {
  const [code, setCode] = useState(initialCode);
  const [output, setOutput] = useState&#x3C;string>('');
  const [isExecuting, setIsExecuting] = useState(false);
  const [executionTime, setExecutionTime] = useState&#x3C;number>(0);
  const editorRef = useRef&#x3C;any>(null);

  const defaultCode = `package main

import "fmt"

func main() {
    fmt.Println("Hello, Go!")
}`;

  useEffect(() => {
    // ローカルストレージから保存されたコードを読み込み
    const savedCode = localStorage.getItem(`challenge-${challengeId}`);
    if (savedCode) {
      setCode(savedCode);
    }
  }, [challengeId]);

  const handleEditorDidMount = (editor: any, monaco: Monaco) => {
    editorRef.current = editor;
    
    // Go言語のシンタックスハイライト設定
    monaco.languages.register({ id: 'go' });
    monaco.languages.setMonarchTokensProvider('go', {
      keywords: [
        'break', 'case', 'chan', 'const', 'continue', 'default',
        'defer', 'else', 'fallthrough', 'for', 'func', 'go',
        'goto', 'if', 'import', 'interface', 'map', 'package',
        'range', 'return', 'select', 'struct', 'switch', 'type', 'var',
      ],
      
      typeKeywords: [
        'bool', 'byte', 'complex64', 'complex128', 'error', 'float32',
        'float64', 'int', 'int8', 'int16', 'int32', 'int64', 'rune',
        'string', 'uint', 'uint8', 'uint16', 'uint32', 'uint64', 'uintptr',
      ],
      
      operators: [
        '=', '>', '&#x3C;', '!', '~', '?', ':', '==', '&#x3C;=', '>=', '!=',
        '&#x26;&#x26;', '||', '++', '--', '+', '-', '*', '/', '&#x26;', '|', '^',
        '%', '&#x3C;&#x3C;', '>>', '>>>', '+=', '-=', '*=', '/=', '&#x26;=', '|=',
        '^=', '%=', '&#x3C;&#x3C;=', '>>=', '>>>=',
      ],
      
      tokenizer: {
        root: [
          [/[a-z_$][\w$]*/, {
            cases: {
              '@typeKeywords': 'keyword',
              '@keywords': 'keyword',
              '@default': 'identifier',
            },
          }],
          [/[A-Z][\w$]*/, 'type.identifier'],
          { include: '@whitespace' },
          [/[{}()\[\]]/, '@brackets'],
          [/[&#x3C;>](?!@symbols)/, '@brackets'],
          [/@symbols/, {
            cases: {
              '@operators': 'operator',
              '@default': '',
            },
          }],
          [/\d*\.\d+([eE][\-+]?\d+)?/, 'number.float'],
          [/0[xX][0-9a-fA-F]+/, 'number.hex'],
          [/\d+/, 'number'],
          [/[;,.]/, 'delimiter'],
          [/"([^"\\]|\\.)*$/, 'string.invalid'],
          [/"/, { token: 'string.quote', bracket: '@open', next: '@string' }],
          [/'[^\\']'/, 'string'],
          [/(')(@escapes)(')/, ['string', 'string.escape', 'string']],
          [/'/, 'string.invalid'],
        ],
        
        whitespace: [
          [/[ \t\r\n]+/, 'white'],
          [/\/\*/, 'comment', '@comment'],
          [/\/\/.*$/, 'comment'],
        ],
        
        comment: [
          [/[^\/*]+/, 'comment'],
          [/\/\*/, 'comment', '@push'],
          ['\\*/', 'comment', '@pop'],
          [/[\/*]/, 'comment'],
        ],
        
        string: [
          [/[^\\"]+/, 'string'],
          [/@escapes/, 'string.escape'],
          [/\\./, 'string.escape.invalid'],
          [/"/, { token: 'string.quote', bracket: '@close', next: '@pop' }],
        ],
      },
    });

    // ショートカットキーの設定
    editor.addAction({
      id: 'execute-code',
      label: 'Execute Code',
      keybindings: [monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter],
      run: () => handleExecute(),
    });
  };

  const handleExecute = async () => {
    setIsExecuting(true);
    setOutput('実行中...');
    
    const startTime = Date.now();
    
    try {
      const result = await onExecute(code);
      setExecutionTime(Date.now() - startTime);
      
      if (result.success) {
        setOutput(result.output);
      } else {
        setOutput(`エラー: ${result.error || '実行に失敗しました'}`);
      }
    } catch (error) {
      setOutput(`エラー: ${error}`);
    } finally {
      setIsExecuting(false);
    }
  };

  const handleSave = () => {
    localStorage.setItem(`challenge-${challengeId}`, code);
    if (onSave) {
      onSave(code);
    }
  };

  const handleReset = () => {
    setCode(defaultCode);
    setOutput('');
    setExecutionTime(0);
  };

  return (
    &#x3C;div className="flex flex-col h-full">
      &#x3C;div className="flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-800 border-b">
        &#x3C;div className="flex items-center gap-2">
          &#x3C;Button
            onClick={handleExecute}
            disabled={isExecuting}
            size="sm"
            className="flex items-center gap-2"
          >
            &#x3C;Play className="w-4 h-4" />
            実行 (Cmd+Enter)
          &#x3C;/Button>
          &#x3C;Button
            onClick={handleSave}
            variant="outline"
            size="sm"
            className="flex items-center gap-2"
          >
            &#x3C;Save className="w-4 h-4" />
            保存
          &#x3C;/Button>
          &#x3C;Button
            onClick={handleReset}
            variant="outline"
            size="sm"
            className="flex items-center gap-2"
          >
            &#x3C;RotateCcw className="w-4 h-4" />
            リセット
          &#x3C;/Button>
        &#x3C;/div>
        {executionTime > 0 &#x26;&#x26; (
          &#x3C;span className="text-sm text-gray-600">
            実行時間: {executionTime}ms
          &#x3C;/span>
        )}
      &#x3C;/div>
      
      &#x3C;div className="flex-1 grid grid-cols-2 gap-2">
        &#x3C;div className="border rounded-lg overflow-hidden">
          &#x3C;Editor
            height="100%"
            defaultLanguage="go"
            value={code}
            onChange={(value) => setCode(value || '')}
            onMount={handleEditorDidMount}
            theme="vs-dark"
            options={{
              minimap: { enabled: false },
              fontSize: 14,
              lineNumbers: 'on',
              roundedSelection: false,
              scrollBeyondLastLine: false,
              automaticLayout: true,
              tabSize: 4,
              insertSpaces: false,
            }}
          />
        &#x3C;/div>
        
        &#x3C;div className="border rounded-lg bg-gray-900 text-gray-100 p-4 overflow-auto">
          &#x3C;div className="font-mono text-sm whitespace-pre-wrap">
            {output || 'ここに実行結果が表示されます'}
          &#x3C;/div>
        &#x3C;/div>
      &#x3C;/div>
    &#x3C;/div>
  );
};
</code></pre>
<h3>4. APIサーバー実装 (Go/Echo)</h3>
<pre><code class="language-go">package main

import (
    "net/http"
    "time"
    
    "github.com/labstack/echo/v4"
    "github.com/labstack/echo/v4/middleware"
    "github.com/gorilla/websocket"
)

type Server struct {
    executor *CodeExecutor
    db       *sql.DB
    cache    *redis.Client
    upgrader websocket.Upgrader
}

func NewServer() (*Server, error) {
    executor, err := NewCodeExecutor()
    if err != nil {
        return nil, err
    }
    
    // データベース接続
    db, err := sql.Open("postgres", os.Getenv("DATABASE_URL"))
    if err != nil {
        return nil, err
    }
    
    // Redis接続
    cache := redis.NewClient(&#x26;redis.Options{
        Addr: os.Getenv("REDIS_URL"),
    })
    
    return &#x26;Server{
        executor: executor,
        db:       db,
        cache:    cache,
        upgrader: websocket.Upgrader{
            CheckOrigin: func(r *http.Request) bool {
                return true // 本番環境では適切に設定
            },
        },
    }, nil
}

func (s *Server) ExecuteCode(c echo.Context) error {
    var req ExecutionRequest
    if err := c.Bind(&#x26;req); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{
            "error": "Invalid request",
        })
    }
    
    // レート制限チェック
    userID := c.Get("user_id").(string)
    if err := s.checkRateLimit(userID); err != nil {
        return c.JSON(http.StatusTooManyRequests, map[string]string{
            "error": "Rate limit exceeded",
        })
    }
    
    // コードの検証
    if err := s.validateCode(req.Code); err != nil {
        return c.JSON(http.StatusBadRequest, map[string]string{
            "error": err.Error(),
        })
    }
    
    // 実行
    result, err := s.executor.Execute(req)
    if err != nil {
        return c.JSON(http.StatusInternalServerError, map[string]string{
            "error": "Execution failed",
        })
    }
    
    // 実行履歴を保存
    go s.saveExecutionHistory(userID, req, result)
    
    return c.JSON(http.StatusOK, result)
}

func (s *Server) checkRateLimit(userID string) error {
    key := fmt.Sprintf("rate_limit:%s", userID)
    
    // 1分間に10回まで
    count, err := s.cache.Incr(ctx, key).Result()
    if err != nil {
        return err
    }
    
    if count == 1 {
        s.cache.Expire(ctx, key, time.Minute)
    }
    
    if count > 10 {
        return fmt.Errorf("rate limit exceeded")
    }
    
    return nil
}

func (s *Server) validateCode(code string) error {
    // 危険なパッケージのインポートをチェック
    dangerousPackages := []string{
        "os/exec",
        "syscall",
        "unsafe",
        "net",
        "net/http",
    }
    
    for _, pkg := range dangerousPackages {
        if strings.Contains(code, fmt.Sprintf(`import "%s"`, pkg)) ||
           strings.Contains(code, fmt.Sprintf(`import ( "%s"`, pkg)) {
            return fmt.Errorf("package %s is not allowed", pkg)
        }
    }
    
    // コードサイズ制限（10KB）
    if len(code) > 10*1024 {
        return fmt.Errorf("code size exceeds limit")
    }
    
    return nil
}

func main() {
    e := echo.New()
    
    // ミドルウェア
    e.Use(middleware.Logger())
    e.Use(middleware.Recover())
    e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
        AllowOrigins: []string{"http://localhost:3000"},
        AllowMethods: []string{http.MethodGet, http.MethodPost},
    }))
    
    server, err := NewServer()
    if err != nil {
        e.Logger.Fatal(err)
    }
    
    // ルート定義
    api := e.Group("/api/v1")
    api.POST("/execute", server.ExecuteCode)
    api.GET("/challenges/:id", server.GetChallenge)
    api.POST("/challenges/:id/submit", server.SubmitSolution)
    api.GET("/progress", server.GetUserProgress)
    
    // WebSocket
    e.GET("/ws", server.HandleWebSocket)
    
    e.Logger.Fatal(e.Start(":8080"))
}
</code></pre>
<h2>学習コンテンツの設計</h2>
<h3>カリキュラム構成</h3>
<pre><code class="language-yaml">基礎編（Beginner）:
  1. Hello World:
    - Goの基本構文
    - パッケージとインポート
    - main関数
    
  2. 変数とデータ型:
    - 変数宣言
    - 基本データ型
    - 型推論
    
  3. 制御構造:
    - if文
    - for文
    - switch文
    
  4. 関数:
    - 関数定義
    - 引数と戻り値
    - 複数戻り値

中級編（Intermediate）:
  1. 配列とスライス:
    - 配列の基本
    - スライスの操作
    - make関数
    
  2. マップ:
    - マップの作成
    - 要素の追加・削除
    - 範囲for文
    
  3. 構造体:
    - 構造体定義
    - メソッド
    - ポインタレシーバー
    
  4. インターフェース:
    - インターフェース定義
    - 実装
    - 型アサーション

上級編（Advanced）:
  1. 並行処理:
    - goroutine
    - channel
    - select文
    
  2. エラーハンドリング:
    - error型
    - panicとrecover
    - カスタムエラー
    
  3. テスト:
    - 単体テスト
    - ベンチマーク
    - テストカバレッジ
    
  4. パッケージ管理:
    - go mod
    - 依存関係管理
    - バージョニング
</code></pre>
<h3>課題例</h3>
<pre><code class="language-go">// レベル1: Hello World
// 課題: "Hello, [名前]!" を出力する関数を作成

package main

import "fmt"

func greet(name string) string {
    // ここにコードを書いてください
    return ""
}

func main() {
    result := greet("Gopher")
    fmt.Println(result) // 期待値: "Hello, Gopher!"
}

// テストケース
func TestGreet(t *testing.T) {
    tests := []struct {
        input    string
        expected string
    }{
        {"Gopher", "Hello, Gopher!"},
        {"World", "Hello, World!"},
        {"", "Hello, !"},
    }
    
    for _, test := range tests {
        result := greet(test.input)
        if result != test.expected {
            t.Errorf("greet(%q) = %q; want %q",
                test.input, result, test.expected)
        }
    }
}
</code></pre>
<h2>セキュリティ対策</h2>
<h3>1. コード実行環境の隔離</h3>
<ul>
<li><strong>Dockerコンテナ</strong>: 各実行を独立したコンテナで実行</li>
<li><strong>リソース制限</strong>: CPU、メモリ、実行時間の制限</li>
<li><strong>ネットワーク隔離</strong>: 外部ネットワークへのアクセスを遮断</li>
<li><strong>読み取り専用ファイルシステム</strong>: システムファイルの改変を防止</li>
</ul>
<h3>2. 入力検証</h3>
<pre><code class="language-go">func validateUserInput(code string) error {
    // SQLインジェクション対策
    if strings.Contains(strings.ToLower(code), "drop table") {
        return errors.New("suspicious SQL command detected")
    }
    
    // OSコマンドインジェクション対策
    dangerousCommands := []string{
        "rm ", "dd ", "mkfs", "chmod", "chown",
    }
    for _, cmd := range dangerousCommands {
        if strings.Contains(code, cmd) {
            return errors.New("dangerous system command detected")
        }
    }
    
    return nil
}
</code></pre>
<h3>3. レート制限</h3>
<pre><code class="language-go">type RateLimiter struct {
    mu       sync.Mutex
    requests map[string][]time.Time
}

func (r *RateLimiter) Allow(userID string) bool {
    r.mu.Lock()
    defer r.mu.Unlock()
    
    now := time.Now()
    windowStart := now.Add(-time.Minute)
    
    // 古いリクエストを削除
    if requests, exists := r.requests[userID]; exists {
        var filtered []time.Time
        for _, t := range requests {
            if t.After(windowStart) {
                filtered = append(filtered, t)
            }
        }
        r.requests[userID] = filtered
    }
    
    // リクエスト数をチェック
    if len(r.requests[userID]) >= 10 {
        return false
    }
    
    // 新しいリクエストを追加
    r.requests[userID] = append(r.requests[userID], now)
    return true
}
</code></pre>
<h2>パフォーマンス最適化</h2>
<h3>1. コード実行のキャッシング</h3>
<pre><code class="language-go">func (s *Server) getCachedResult(codeHash string) (*ExecutionResult, error) {
    key := fmt.Sprintf("execution:%s", codeHash)
    
    val, err := s.cache.Get(ctx, key).Result()
    if err == redis.Nil {
        return nil, nil
    }
    if err != nil {
        return nil, err
    }
    
    var result ExecutionResult
    if err := json.Unmarshal([]byte(val), &#x26;result); err != nil {
        return nil, err
    }
    
    return &#x26;result, nil
}

func (s *Server) cacheResult(codeHash string, result *ExecutionResult) error {
    key := fmt.Sprintf("execution:%s", codeHash)
    
    data, err := json.Marshal(result)
    if err != nil {
        return err
    }
    
    // 1時間キャッシュ
    return s.cache.Set(ctx, key, data, time.Hour).Err()
}
</code></pre>
<h3>2. コンテナプールの実装</h3>
<pre><code class="language-go">type ContainerPool struct {
    mu         sync.Mutex
    containers chan string
    maxSize    int
}

func NewContainerPool(size int) *ContainerPool {
    pool := &#x26;ContainerPool{
        containers: make(chan string, size),
        maxSize:    size,
    }
    
    // 事前にコンテナを作成
    for i := 0; i &#x3C; size; i++ {
        go pool.createContainer()
    }
    
    return pool
}

func (p *ContainerPool) Get() (string, error) {
    select {
    case containerID := &#x3C;-p.containers:
        return containerID, nil
    case &#x3C;-time.After(5 * time.Second):
        // タイムアウト時は新規作成
        return p.createNewContainer()
    }
}

func (p *ContainerPool) Put(containerID string) {
    select {
    case p.containers &#x3C;- containerID:
        // プールに戻す
    default:
        // プールが満杯の場合は削除
        p.removeContainer(containerID)
    }
}
</code></pre>
<h2>モニタリングとログ</h2>
<h3>Prometheus メトリクス</h3>
<pre><code class="language-go">var (
    executionCounter = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "code_executions_total",
            Help: "Total number of code executions",
        },
        []string{"status", "language"},
    )
    
    executionDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name:    "code_execution_duration_seconds",
            Help:    "Code execution duration in seconds",
            Buckets: prometheus.DefBuckets,
        },
        []string{"language"},
    )
)

func init() {
    prometheus.MustRegister(executionCounter)
    prometheus.MustRegister(executionDuration)
}
</code></pre>
<h3>構造化ログ</h3>
<pre><code class="language-go">import "go.uber.org/zap"

func setupLogger() *zap.Logger {
    config := zap.NewProductionConfig()
    config.OutputPaths = []string{"stdout"}
    config.ErrorOutputPaths = []string{"stderr"}
    
    logger, _ := config.Build()
    return logger
}

// 使用例
logger.Info("Code execution started",
    zap.String("user_id", userID),
    zap.String("challenge_id", challengeID),
    zap.Int("code_length", len(code)),
)
</code></pre>
<h2>デプロイメント</h2>
<h3>Kubernetes マニフェスト</h3>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: go-learning-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: go-learning-api
  template:
    metadata:
      labels:
        app: go-learning-api
    spec:
      containers:
      - name: api
        image: go-learning/api:latest
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        - name: REDIS_URL
          value: redis-service:6379
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: go-learning-api-service
spec:
  selector:
    app: go-learning-api
  ports:
  - port: 80
    targetPort: 8080
  type: LoadBalancer
</code></pre>
<h3>CI/CD パイプライン (GitHub Actions)</h3>
<pre><code class="language-yaml">name: Deploy

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
    
    - name: Run tests
      run: |
        go test -v ./...
        go test -race -coverprofile=coverage.txt ./...
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.txt

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Docker image
      run: |
        docker build -t go-learning/api:${{ github.sha }} .
        docker tag go-learning/api:${{ github.sha }} go-learning/api:latest
    
    - name: Push to registry
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push go-learning/api:${{ github.sha }}
        docker push go-learning/api:latest

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
    - name: Deploy to Kubernetes
      run: |
        kubectl set image deployment/go-learning-api api=go-learning/api:${{ github.sha }}
        kubectl rollout status deployment/go-learning-api
</code></pre>
<h2>まとめ</h2>
<p>このGo言語学習プラットフォームの設計では、以下の点に重点を置きました：</p>
<ol>
<li><strong>セキュリティ</strong>: Dockerコンテナによる隔離、入力検証、レート制限</li>
<li><strong>スケーラビリティ</strong>: Kubernetes、コンテナプール、キャッシング</li>
<li><strong>ユーザー体験</strong>: リアルタイム実行、即座のフィードバック、進捗管理</li>
<li><strong>教育的価値</strong>: 段階的な学習パス、実践的な課題、詳細な解説</li>
</ol>
<p>これらの要素を組み合わせることで、安全で効率的、かつ教育効果の高い学習プラットフォームを構築できます。</p>
<h2>インフラストラクチャと運用</h2>
<h3>データベースの選定</h3>
<h4>1. メインデータベース: PostgreSQL</h4>
<ul>
<li>
<p><strong>選定理由</strong>:</p>
<ul>
<li>ACIDトランザクションによる高い信頼性</li>
<li>JSONBサポートによる柔軟なデータ構造</li>
<li>豊富なインデックス機能（B-tree, Hash, GiST, GIN）</li>
<li>パーティショニングによる大規模データ対応</li>
</ul>
</li>
<li>
<p><strong>利用サービス</strong>: Amazon RDS for PostgreSQL</p>
<ul>
<li>マルチAZ構成で高可用性を実現</li>
<li>自動バックアップとポイントインタイムリカバリ</li>
<li>Read Replicaによる読み取り性能の向上</li>
</ul>
</li>
</ul>
<pre><code class="language-sql">-- テーブル設計例
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(50) UNIQUE NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE challenges (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    difficulty VARCHAR(20) CHECK (difficulty IN ('beginner', 'intermediate', 'advanced')),
    test_cases JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE submissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id),
    challenge_id UUID REFERENCES challenges(id),
    code TEXT NOT NULL,
    status VARCHAR(20) CHECK (status IN ('pending', 'running', 'success', 'failure')),
    output TEXT,
    execution_time_ms INTEGER,
    memory_usage_bytes BIGINT,
    submitted_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_challenge (user_id, challenge_id)
) PARTITION BY RANGE (submitted_at);

-- パーティション作成（月次）
CREATE TABLE submissions_2025_01 PARTITION OF submissions
    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
</code></pre>
<h4>2. キャッシュデータベース: Redis</h4>
<ul>
<li>
<p><strong>選定理由</strong>:</p>
<ul>
<li>インメモリによる高速アクセス</li>
<li>Pub/Sub機能によるリアルタイム通信</li>
<li>セッション管理に最適</li>
</ul>
</li>
<li>
<p><strong>利用サービス</strong>: Amazon ElastiCache for Redis</p>
<ul>
<li>クラスターモードで自動スケーリング</li>
<li>自動フェイルオーバー</li>
</ul>
</li>
</ul>
<h4>3. 時系列データ: TimescaleDB</h4>
<ul>
<li><strong>用途</strong>: メトリクス、ログ、実行履歴の保存</li>
<li><strong>選定理由</strong>:
<ul>
<li>PostgreSQLの拡張で既存インフラと統合しやすい</li>
<li>自動パーティショニングと圧縮</li>
</ul>
</li>
</ul>
<h3>ホスティングサービス</h3>
<h4>AWS構成</h4>
<pre><code class="language-yaml"># インフラストラクチャ構成
Infrastructure:
  Region: ap-northeast-1 (東京)
  
  Compute:
    - Service: Amazon EKS
      NodeGroups:
        - Name: api-servers
          InstanceType: t3.medium
          MinSize: 2
          MaxSize: 10
          DesiredSize: 3
        - Name: code-executors
          InstanceType: c5.large
          MinSize: 1
          MaxSize: 20
          DesiredSize: 5
          
  Database:
    - Service: Amazon RDS (PostgreSQL)
      InstanceClass: db.t3.medium
      MultiAZ: true
      Storage: 100GB (gp3)
      
    - Service: Amazon ElastiCache (Redis)
      NodeType: cache.t3.micro
      NumNodes: 2
      
  Storage:
    - Service: Amazon S3
      Buckets:
        - user-code-storage
        - submission-logs
        - static-assets
        
  CDN:
    - Service: Amazon CloudFront
      Origins:
        - S3 (static assets)
        - ALB (API)
        
  Container Registry:
    - Service: Amazon ECR
      Repositories:
        - go-learning-api
        - code-executor
        
  Monitoring:
    - CloudWatch
    - Prometheus + Grafana (EKS上)
    - ELK Stack (Elasticsearch, Logstash, Kibana)
</code></pre>
<h3>運用コスト試算（月額）</h3>
<h4>小規模（〜1,000ユーザー）</h4>
<pre><code>Amazon EKS:
  - Control Plane: $72
  - t3.medium × 2: $60
  - c5.large × 1: $62
  
Amazon RDS:
  - db.t3.medium (Multi-AZ): $140
  - Storage 100GB: $25
  
Amazon ElastiCache:
  - cache.t3.micro × 2: $25
  
Amazon S3 + CloudFront:
  - Storage &#x26; Transfer: $20
  
Amazon ECR:
  - Storage: $10
  
その他（ALB, NAT Gateway等）: $50

合計: 約$464/月（約7万円/月）
</code></pre>
<h4>中規模（〜10,000ユーザー）</h4>
<pre><code>Amazon EKS:
  - Control Plane: $72
  - t3.medium × 4: $120
  - c5.large × 3: $186
  
Amazon RDS:
  - db.r5.large (Multi-AZ): $460
  - Storage 500GB: $125
  - Read Replica: $230
  
Amazon ElastiCache:
  - cache.r5.large × 2: $340
  
Amazon S3 + CloudFront:
  - Storage &#x26; Transfer: $150
  
Amazon ECR:
  - Storage: $30
  
その他: $200

合計: 約$1,913/月（約29万円/月）
</code></pre>
<h4>大規模（〜100,000ユーザー）</h4>
<pre><code>Amazon EKS:
  - Control Plane × 2: $144
  - t3.large × 10: $600
  - c5.xlarge × 10: $1,240
  
Amazon RDS:
  - db.r5.2xlarge (Multi-AZ): $1,840
  - Storage 2TB: $500
  - Read Replica × 3: $2,760
  
Amazon ElastiCache:
  - cache.r5.xlarge × 4: $1,360
  
Amazon S3 + CloudFront:
  - Storage &#x26; Transfer: $1,000
  
Amazon ECR:
  - Storage: $100
  
その他: $500

合計: 約$10,044/月（約150万円/月）
</code></pre>
<h3>コスト最適化戦略</h3>
<h4>1. Reserved Instances / Savings Plans</h4>
<ul>
<li>1年または3年契約で最大72%割引</li>
<li>予測可能なワークロードに適用</li>
</ul>
<h4>2. Spot Instances</h4>
<ul>
<li>コード実行用のワーカーノードに利用</li>
<li>最大90%のコスト削減</li>
</ul>
<h4>3. Auto Scaling</h4>
<pre><code class="language-yaml">apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: go-learning-api
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
</code></pre>
<h4>4. コンテナ最適化</h4>
<pre><code class="language-dockerfile"># マルチステージビルドでイメージサイズ削減
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/main .
CMD ["./main"]
</code></pre>
<h3>災害復旧計画（DRP）</h3>
<h4>バックアップ戦略</h4>
<pre><code class="language-yaml">BackupStrategy:
  Database:
    - Type: Automated Backup
      Frequency: Daily
      Retention: 30 days
    - Type: Manual Snapshot
      Frequency: Weekly
      Retention: 90 days
      
  CodeRepository:
    - Type: S3 Cross-Region Replication
      Target: us-west-2
      
  Configurations:
    - Type: AWS Backup
      Frequency: Daily
      Retention: 7 days
</code></pre>
<h4>復旧目標</h4>
<ul>
<li><strong>RPO (Recovery Point Objective)</strong>: 1時間</li>
<li><strong>RTO (Recovery Time Objective)</strong>: 4時間</li>
</ul>
<h3>監視とアラート</h3>
<pre><code class="language-yaml">Monitoring:
  Metrics:
    - API Response Time: &#x3C; 200ms (p95)
    - Code Execution Time: &#x3C; 5s (p95)
    - Error Rate: &#x3C; 1%
    - Availability: > 99.9%
    
  Alerts:
    Critical:
      - Service Down
      - Database Connection Failed
      - Error Rate > 5%
    Warning:
      - Response Time > 500ms
      - CPU Usage > 80%
      - Memory Usage > 90%
    Info:
      - New Deployment
      - Scaling Event
      - Backup Completed
</code></pre>
<h2>次のステップ</h2>
<ol>
<li><strong>MVP開発</strong>: 基本機能の実装とテスト</li>
<li><strong>コンテンツ作成</strong>: 学習教材と課題の充実</li>
<li><strong>ユーザーテスト</strong>: フィードバックの収集と改善</li>
<li><strong>機能拡張</strong>: AI による学習支援、コードレビュー機能</li>
<li><strong>コミュニティ機能</strong>: フォーラム、コード共有、メンタリング</li>
</ol>
<p>このプラットフォームを通じて、多くの開発者がGo言語を効率的に学び、実践的なスキルを身につけることができるでしょう。</p>
</article><nav class="mt-8 pt-4 border-t border-gray-700 flex justify-between"><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/">← ホームへ</a><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/blog/">記事一覧へ →</a></nav></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-29ebadaebe2fcb3f.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[7555,[],\"\"]\n3:I[1295,[],\"\"]\n5:I[9665,[],\"MetadataBoundary\"]\n7:I[9665,[],\"OutletBoundary\"]\na:I[4911,[],\"AsyncMetadataOutlet\"]\nc:I[9665,[],\"ViewportBoundary\"]\ne:I[6614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/ce87a0c8fce915ba.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Ktu6YydJwxMRnMjINckFG\",\"p\":\"\",\"c\":[\"\",\"blog\",\"go-learning-platform-design\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"go-learning-platform-design\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ce87a0c8fce915ba.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.png\",\"type\":\"image/png\"}]}],[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"go-learning-platform-design\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",[\"$\",\"$L5\",null,{\"children\":\"$L6\"}],null,[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",[\"$\",\"$La\",null,{\"promise\":\"$@b\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"tezeBSyz0__0W6Pj4UdY4\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:\"$Sreact.suspense\"\n10:I[4911,[],\"AsyncMetadata\"]\n6:[\"$\",\"$f\",null,{\"fallback\":null,\"children\":[\"$\",\"$L10\",null,{\"promise\":\"$@11\"}]}]\n"])</script><script>self.__next_f.push([1,"9:null\n"])</script><script>self.__next_f.push([1,"12:I[6874,[\"874\",\"static/chunks/874-8d3839f72fd80c3c.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-677ab5ce4505fca7.js\"],\"\"]\n13:Ta9c8,"])</script><script>self.__next_f.push([1,"\u003cp\u003eプログラミング学習において「書いたコードをすぐに実行できる」環境は非常に重要です。本記事では、Go言語の学習に特化したWebベースの学習プラットフォームの設計について詳しく解説します。\u003c/p\u003e\n\u003ch2\u003eプロジェクト概要\u003c/h2\u003e\n\u003ch3\u003eビジョン\u003c/h3\u003e\n\u003cp\u003e「Go言語を段階的に、実践的に学べるインタラクティブな学習環境」を提供し、初心者から中級者まで効率的にGo言語をマスターできるプラットフォームを構築します。\u003c/p\u003e\n\u003ch3\u003e主要機能\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eブラウザ上でのコード実行\u003c/strong\u003e: インストール不要でGo言語を実行\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e段階的な学習パス\u003c/strong\u003e: 基礎から応用まで体系的なカリキュラム\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eリアルタイムフィードバック\u003c/strong\u003e: コード実行結果の即座な表示\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e進捗管理\u003c/strong\u003e: 学習の進行状況を可視化\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eインタラクティブな課題\u003c/strong\u003e: 実践的な問題を解きながら学習\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e技術スタック\u003c/h2\u003e\n\u003ch3\u003eフロントエンド\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eUI Framework: Next.js 14 (App Router)\n言語: TypeScript\nスタイリング: Tailwind CSS + shadcn/ui\nコードエディタ: Monaco Editor (VS Code エディタ)\n状態管理: Zustand\n認証: NextAuth.js\nリアルタイム通信: WebSocket (Socket.io)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eバックエンド\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eAPIサーバー: Go (Echo or Gin framework)\nコード実行環境: Docker + Kubernetes\nサンドボックス: gVisor or Firecracker\nキャッシュ: Redis\nデータベース: PostgreSQL\nメッセージキュー: RabbitMQ or NATS\nオブジェクトストレージ: MinIO or S3\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eインフラストラクチャ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eコンテナオーケストレーション: Kubernetes\nCI/CD: GitHub Actions + ArgoCD\nモニタリング: Prometheus + Grafana\nログ管理: ELK Stack\nCDN: CloudFlare\nリバースプロキシ: Nginx or Traefik\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eシステムアーキテクチャ\u003c/h2\u003e\n\u003ch3\u003e全体構成図\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e┌──────────────────────────────────────────────────────┐\n│                    CDN (CloudFlare)                   │\n└────────────────────────┬─────────────────────────────┘\n                         │\n┌────────────────────────▼─────────────────────────────┐\n│              Load Balancer (Nginx/Traefik)           │\n└────────────────────────┬─────────────────────────────┘\n                         │\n        ┌────────────────┼────────────────┐\n        │                │                │\n┌───────▼──────┐ ┌──────▼──────┐ ┌──────▼──────┐\n│  Frontend    │ │   API       │ │  WebSocket  │\n│  (Next.js)   │ │  Server     │ │   Server    │\n└──────────────┘ └──────┬──────┘ └──────────────┘\n                        │\n          ┌─────────────┼─────────────┐\n          │             │             │\n┌─────────▼────┐ ┌─────▼────┐ ┌─────▼─────┐\n│  PostgreSQL  │ │  Redis   │ │ RabbitMQ  │\n└──────────────┘ └──────────┘ └─────┬─────┘\n                                     │\n                              ┌──────▼──────┐\n                              │  Execution  │\n                              │   Workers   │\n                              │  (Docker)   │\n                              └─────────────┘\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eコード実行フロー\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-mermaid\"\u003esequenceDiagram\n    participant User\n    participant Frontend\n    participant API\n    participant Queue\n    participant Worker\n    participant Docker\n\n    User-\u003e\u003eFrontend: コード入力\n    Frontend-\u003e\u003eAPI: 実行リクエスト\n    API-\u003e\u003eQueue: ジョブ追加\n    Queue-\u003e\u003eWorker: ジョブ取得\n    Worker-\u003e\u003eDocker: コンテナ作成\n    Docker-\u003e\u003eDocker: コード実行\n    Docker--\u003e\u003eWorker: 実行結果\n    Worker--\u003e\u003eAPI: 結果送信\n    API--\u003e\u003eFrontend: WebSocket通知\n    Frontend--\u003e\u003eUser: 結果表示\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eコア機能の実装\u003c/h2\u003e\n\u003ch3\u003e1. セキュアなコード実行環境\u003c/h3\u003e\n\u003ch4\u003eDocker設定 (Dockerfile.sandbox)\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-dockerfile\"\u003eFROM golang:1.21-alpine AS builder\n\n# セキュリティ向上のための非rootユーザー作成\nRUN adduser -D -g '' appuser\n\nWORKDIR /app\n\n# 実行環境の制限設定\nRUN apk add --no-cache \\\n    ca-certificates \\\n    \u0026#x26;\u0026#x26; rm -rf /var/cache/apk/*\n\nFROM scratch\n\n# 必要最小限のファイルのみコピー\nCOPY --from=builder /etc/passwd /etc/passwd\nCOPY --from=builder /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\n\nUSER appuser\n\nWORKDIR /sandbox\n\n# リソース制限のデフォルト値\nENV GOMEMLIMIT=128MiB\nENV GOMAXPROCS=1\n\nENTRYPOINT [\"/bin/sh\"]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003eコード実行サービス (Go)\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003epackage executor\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"os/exec\"\n    \"time\"\n    \n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/api/types/container\"\n    \"github.com/docker/docker/client\"\n)\n\ntype ExecutionRequest struct {\n    ID       string `json:\"id\"`\n    Code     string `json:\"code\"`\n    Language string `json:\"language\"`\n    Timeout  int    `json:\"timeout\"`\n}\n\ntype ExecutionResult struct {\n    ID       string `json:\"id\"`\n    Output   string `json:\"output\"`\n    Error    string `json:\"error\"`\n    ExitCode int    `json:\"exit_code\"`\n    Duration int64  `json:\"duration\"`\n}\n\ntype CodeExecutor struct {\n    dockerClient *client.Client\n    maxTimeout   time.Duration\n}\n\nfunc NewCodeExecutor() (*CodeExecutor, error) {\n    cli, err := client.NewClientWithOpts(client.FromEnv)\n    if err != nil {\n        return nil, err\n    }\n    \n    return \u0026#x26;CodeExecutor{\n        dockerClient: cli,\n        maxTimeout:   30 * time.Second,\n    }, nil\n}\n\nfunc (e *CodeExecutor) Execute(req ExecutionRequest) (*ExecutionResult, error) {\n    ctx, cancel := context.WithTimeout(context.Background(), e.maxTimeout)\n    defer cancel()\n    \n    startTime := time.Now()\n    \n    // コードを一時ファイルに保存\n    tmpFile, err := os.CreateTemp(\"\", \"code-*.go\")\n    if err != nil {\n        return nil, err\n    }\n    defer os.Remove(tmpFile.Name())\n    \n    if _, err := tmpFile.WriteString(req.Code); err != nil {\n        return nil, err\n    }\n    tmpFile.Close()\n    \n    // Dockerコンテナの設定\n    config := \u0026#x26;container.Config{\n        Image: \"golang-sandbox:latest\",\n        Cmd:   []string{\"go\", \"run\", \"/code/main.go\"},\n        Env: []string{\n            \"GOMEMLIMIT=128MiB\",\n            \"GOMAXPROCS=1\",\n        },\n        WorkingDir: \"/code\",\n        \n        // リソース制限\n        Memory:     128 * 1024 * 1024, // 128MB\n        MemorySwap: 128 * 1024 * 1024, // スワップ無効\n        CpuShares:  512,                // CPU制限\n    }\n    \n    hostConfig := \u0026#x26;container.HostConfig{\n        AutoRemove: true,\n        \n        // セキュリティ設定\n        ReadonlyRootfs: true,\n        SecurityOpt:    []string{\"no-new-privileges\"},\n        CapDrop:        []string{\"ALL\"},\n        NetworkMode:    \"none\", // ネットワーク無効\n        \n        // ファイルマウント\n        Binds: []string{\n            fmt.Sprintf(\"%s:/code/main.go:ro\", tmpFile.Name()),\n        },\n    }\n    \n    // コンテナ作成と実行\n    resp, err := e.dockerClient.ContainerCreate(\n        ctx,\n        config,\n        hostConfig,\n        nil,\n        nil,\n        \"\",\n    )\n    if err != nil {\n        return nil, err\n    }\n    \n    if err := e.dockerClient.ContainerStart(ctx, resp.ID, types.ContainerStartOptions{}); err != nil {\n        return nil, err\n    }\n    \n    // 実行結果の取得\n    statusCh, errCh := e.dockerClient.ContainerWait(ctx, resp.ID, container.WaitConditionNotRunning)\n    select {\n    case err := \u0026#x3C;-errCh:\n        if err != nil {\n            return nil, err\n        }\n    case status := \u0026#x3C;-statusCh:\n        // ログ取得\n        logs, err := e.dockerClient.ContainerLogs(ctx, resp.ID, types.ContainerLogsOptions{\n            ShowStdout: true,\n            ShowStderr: true,\n        })\n        if err != nil {\n            return nil, err\n        }\n        defer logs.Close()\n        \n        output, _ := io.ReadAll(logs)\n        \n        return \u0026#x26;ExecutionResult{\n            ID:       req.ID,\n            Output:   string(output),\n            ExitCode: int(status.StatusCode),\n            Duration: time.Since(startTime).Milliseconds(),\n        }, nil\n    }\n    \n    return nil, fmt.Errorf(\"execution failed\")\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. 学習コンテンツ管理システム\u003c/h3\u003e\n\u003ch4\u003eデータベース設計\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003e-- ユーザーテーブル\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) UNIQUE NOT NULL,\n    username VARCHAR(100) UNIQUE NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- コーステーブル\nCREATE TABLE courses (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    title VARCHAR(255) NOT NULL,\n    description TEXT,\n    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),\n    estimated_hours INTEGER,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- レッスンテーブル\nCREATE TABLE lessons (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,\n    title VARCHAR(255) NOT NULL,\n    content TEXT NOT NULL,\n    order_index INTEGER NOT NULL,\n    lesson_type VARCHAR(50) CHECK (lesson_type IN ('tutorial', 'exercise', 'project')),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- 課題テーブル\nCREATE TABLE challenges (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,\n    title VARCHAR(255) NOT NULL,\n    description TEXT NOT NULL,\n    starter_code TEXT,\n    solution_code TEXT,\n    test_cases JSONB,\n    hints JSONB,\n    difficulty_level INTEGER CHECK (difficulty_level BETWEEN 1 AND 5),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- 進捗管理テーブル\nCREATE TABLE user_progress (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    lesson_id UUID REFERENCES lessons(id) ON DELETE CASCADE,\n    challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,\n    status VARCHAR(50) CHECK (status IN ('not_started', 'in_progress', 'completed')),\n    score INTEGER,\n    attempts INTEGER DEFAULT 0,\n    completed_at TIMESTAMP,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    UNIQUE(user_id, lesson_id, challenge_id)\n);\n\n-- 実行履歴テーブル\nCREATE TABLE execution_history (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    challenge_id UUID REFERENCES challenges(id) ON DELETE CASCADE,\n    code TEXT NOT NULL,\n    output TEXT,\n    error TEXT,\n    execution_time_ms INTEGER,\n    success BOOLEAN,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- インデックス\nCREATE INDEX idx_user_progress_user_id ON user_progress(user_id);\nCREATE INDEX idx_user_progress_status ON user_progress(status);\nCREATE INDEX idx_execution_history_user_id ON execution_history(user_id);\nCREATE INDEX idx_execution_history_created_at ON execution_history(created_at);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e3. フロントエンド実装\u003c/h3\u003e\n\u003ch4\u003eコードエディタコンポーネント (React/TypeScript)\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-typescript\"\u003eimport React, { useState, useRef, useEffect } from 'react';\nimport Editor, { Monaco } from '@monaco-editor/react';\nimport { Button } from '@/components/ui/button';\nimport { Play, RotateCcw, Save } from 'lucide-react';\n\ninterface CodeEditorProps {\n  initialCode?: string;\n  challengeId: string;\n  onExecute: (code: string) =\u003e Promise\u0026#x3C;ExecutionResult\u003e;\n  onSave?: (code: string) =\u003e void;\n}\n\ninterface ExecutionResult {\n  output: string;\n  error?: string;\n  executionTime: number;\n  success: boolean;\n}\n\nexport const CodeEditor: React.FC\u0026#x3C;CodeEditorProps\u003e = ({\n  initialCode = '',\n  challengeId,\n  onExecute,\n  onSave,\n}) =\u003e {\n  const [code, setCode] = useState(initialCode);\n  const [output, setOutput] = useState\u0026#x3C;string\u003e('');\n  const [isExecuting, setIsExecuting] = useState(false);\n  const [executionTime, setExecutionTime] = useState\u0026#x3C;number\u003e(0);\n  const editorRef = useRef\u0026#x3C;any\u003e(null);\n\n  const defaultCode = `package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, Go!\")\n}`;\n\n  useEffect(() =\u003e {\n    // ローカルストレージから保存されたコードを読み込み\n    const savedCode = localStorage.getItem(`challenge-${challengeId}`);\n    if (savedCode) {\n      setCode(savedCode);\n    }\n  }, [challengeId]);\n\n  const handleEditorDidMount = (editor: any, monaco: Monaco) =\u003e {\n    editorRef.current = editor;\n    \n    // Go言語のシンタックスハイライト設定\n    monaco.languages.register({ id: 'go' });\n    monaco.languages.setMonarchTokensProvider('go', {\n      keywords: [\n        'break', 'case', 'chan', 'const', 'continue', 'default',\n        'defer', 'else', 'fallthrough', 'for', 'func', 'go',\n        'goto', 'if', 'import', 'interface', 'map', 'package',\n        'range', 'return', 'select', 'struct', 'switch', 'type', 'var',\n      ],\n      \n      typeKeywords: [\n        'bool', 'byte', 'complex64', 'complex128', 'error', 'float32',\n        'float64', 'int', 'int8', 'int16', 'int32', 'int64', 'rune',\n        'string', 'uint', 'uint8', 'uint16', 'uint32', 'uint64', 'uintptr',\n      ],\n      \n      operators: [\n        '=', '\u003e', '\u0026#x3C;', '!', '~', '?', ':', '==', '\u0026#x3C;=', '\u003e=', '!=',\n        '\u0026#x26;\u0026#x26;', '||', '++', '--', '+', '-', '*', '/', '\u0026#x26;', '|', '^',\n        '%', '\u0026#x3C;\u0026#x3C;', '\u003e\u003e', '\u003e\u003e\u003e', '+=', '-=', '*=', '/=', '\u0026#x26;=', '|=',\n        '^=', '%=', '\u0026#x3C;\u0026#x3C;=', '\u003e\u003e=', '\u003e\u003e\u003e=',\n      ],\n      \n      tokenizer: {\n        root: [\n          [/[a-z_$][\\w$]*/, {\n            cases: {\n              '@typeKeywords': 'keyword',\n              '@keywords': 'keyword',\n              '@default': 'identifier',\n            },\n          }],\n          [/[A-Z][\\w$]*/, 'type.identifier'],\n          { include: '@whitespace' },\n          [/[{}()\\[\\]]/, '@brackets'],\n          [/[\u0026#x3C;\u003e](?!@symbols)/, '@brackets'],\n          [/@symbols/, {\n            cases: {\n              '@operators': 'operator',\n              '@default': '',\n            },\n          }],\n          [/\\d*\\.\\d+([eE][\\-+]?\\d+)?/, 'number.float'],\n          [/0[xX][0-9a-fA-F]+/, 'number.hex'],\n          [/\\d+/, 'number'],\n          [/[;,.]/, 'delimiter'],\n          [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'],\n          [/\"/, { token: 'string.quote', bracket: '@open', next: '@string' }],\n          [/'[^\\\\']'/, 'string'],\n          [/(')(@escapes)(')/, ['string', 'string.escape', 'string']],\n          [/'/, 'string.invalid'],\n        ],\n        \n        whitespace: [\n          [/[ \\t\\r\\n]+/, 'white'],\n          [/\\/\\*/, 'comment', '@comment'],\n          [/\\/\\/.*$/, 'comment'],\n        ],\n        \n        comment: [\n          [/[^\\/*]+/, 'comment'],\n          [/\\/\\*/, 'comment', '@push'],\n          ['\\\\*/', 'comment', '@pop'],\n          [/[\\/*]/, 'comment'],\n        ],\n        \n        string: [\n          [/[^\\\\\"]+/, 'string'],\n          [/@escapes/, 'string.escape'],\n          [/\\\\./, 'string.escape.invalid'],\n          [/\"/, { token: 'string.quote', bracket: '@close', next: '@pop' }],\n        ],\n      },\n    });\n\n    // ショートカットキーの設定\n    editor.addAction({\n      id: 'execute-code',\n      label: 'Execute Code',\n      keybindings: [monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter],\n      run: () =\u003e handleExecute(),\n    });\n  };\n\n  const handleExecute = async () =\u003e {\n    setIsExecuting(true);\n    setOutput('実行中...');\n    \n    const startTime = Date.now();\n    \n    try {\n      const result = await onExecute(code);\n      setExecutionTime(Date.now() - startTime);\n      \n      if (result.success) {\n        setOutput(result.output);\n      } else {\n        setOutput(`エラー: ${result.error || '実行に失敗しました'}`);\n      }\n    } catch (error) {\n      setOutput(`エラー: ${error}`);\n    } finally {\n      setIsExecuting(false);\n    }\n  };\n\n  const handleSave = () =\u003e {\n    localStorage.setItem(`challenge-${challengeId}`, code);\n    if (onSave) {\n      onSave(code);\n    }\n  };\n\n  const handleReset = () =\u003e {\n    setCode(defaultCode);\n    setOutput('');\n    setExecutionTime(0);\n  };\n\n  return (\n    \u0026#x3C;div className=\"flex flex-col h-full\"\u003e\n      \u0026#x3C;div className=\"flex items-center justify-between p-2 bg-gray-100 dark:bg-gray-800 border-b\"\u003e\n        \u0026#x3C;div className=\"flex items-center gap-2\"\u003e\n          \u0026#x3C;Button\n            onClick={handleExecute}\n            disabled={isExecuting}\n            size=\"sm\"\n            className=\"flex items-center gap-2\"\n          \u003e\n            \u0026#x3C;Play className=\"w-4 h-4\" /\u003e\n            実行 (Cmd+Enter)\n          \u0026#x3C;/Button\u003e\n          \u0026#x3C;Button\n            onClick={handleSave}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"flex items-center gap-2\"\n          \u003e\n            \u0026#x3C;Save className=\"w-4 h-4\" /\u003e\n            保存\n          \u0026#x3C;/Button\u003e\n          \u0026#x3C;Button\n            onClick={handleReset}\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"flex items-center gap-2\"\n          \u003e\n            \u0026#x3C;RotateCcw className=\"w-4 h-4\" /\u003e\n            リセット\n          \u0026#x3C;/Button\u003e\n        \u0026#x3C;/div\u003e\n        {executionTime \u003e 0 \u0026#x26;\u0026#x26; (\n          \u0026#x3C;span className=\"text-sm text-gray-600\"\u003e\n            実行時間: {executionTime}ms\n          \u0026#x3C;/span\u003e\n        )}\n      \u0026#x3C;/div\u003e\n      \n      \u0026#x3C;div className=\"flex-1 grid grid-cols-2 gap-2\"\u003e\n        \u0026#x3C;div className=\"border rounded-lg overflow-hidden\"\u003e\n          \u0026#x3C;Editor\n            height=\"100%\"\n            defaultLanguage=\"go\"\n            value={code}\n            onChange={(value) =\u003e setCode(value || '')}\n            onMount={handleEditorDidMount}\n            theme=\"vs-dark\"\n            options={{\n              minimap: { enabled: false },\n              fontSize: 14,\n              lineNumbers: 'on',\n              roundedSelection: false,\n              scrollBeyondLastLine: false,\n              automaticLayout: true,\n              tabSize: 4,\n              insertSpaces: false,\n            }}\n          /\u003e\n        \u0026#x3C;/div\u003e\n        \n        \u0026#x3C;div className=\"border rounded-lg bg-gray-900 text-gray-100 p-4 overflow-auto\"\u003e\n          \u0026#x3C;div className=\"font-mono text-sm whitespace-pre-wrap\"\u003e\n            {output || 'ここに実行結果が表示されます'}\n          \u0026#x3C;/div\u003e\n        \u0026#x3C;/div\u003e\n      \u0026#x3C;/div\u003e\n    \u0026#x3C;/div\u003e\n  );\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e4. APIサーバー実装 (Go/Echo)\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003epackage main\n\nimport (\n    \"net/http\"\n    \"time\"\n    \n    \"github.com/labstack/echo/v4\"\n    \"github.com/labstack/echo/v4/middleware\"\n    \"github.com/gorilla/websocket\"\n)\n\ntype Server struct {\n    executor *CodeExecutor\n    db       *sql.DB\n    cache    *redis.Client\n    upgrader websocket.Upgrader\n}\n\nfunc NewServer() (*Server, error) {\n    executor, err := NewCodeExecutor()\n    if err != nil {\n        return nil, err\n    }\n    \n    // データベース接続\n    db, err := sql.Open(\"postgres\", os.Getenv(\"DATABASE_URL\"))\n    if err != nil {\n        return nil, err\n    }\n    \n    // Redis接続\n    cache := redis.NewClient(\u0026#x26;redis.Options{\n        Addr: os.Getenv(\"REDIS_URL\"),\n    })\n    \n    return \u0026#x26;Server{\n        executor: executor,\n        db:       db,\n        cache:    cache,\n        upgrader: websocket.Upgrader{\n            CheckOrigin: func(r *http.Request) bool {\n                return true // 本番環境では適切に設定\n            },\n        },\n    }, nil\n}\n\nfunc (s *Server) ExecuteCode(c echo.Context) error {\n    var req ExecutionRequest\n    if err := c.Bind(\u0026#x26;req); err != nil {\n        return c.JSON(http.StatusBadRequest, map[string]string{\n            \"error\": \"Invalid request\",\n        })\n    }\n    \n    // レート制限チェック\n    userID := c.Get(\"user_id\").(string)\n    if err := s.checkRateLimit(userID); err != nil {\n        return c.JSON(http.StatusTooManyRequests, map[string]string{\n            \"error\": \"Rate limit exceeded\",\n        })\n    }\n    \n    // コードの検証\n    if err := s.validateCode(req.Code); err != nil {\n        return c.JSON(http.StatusBadRequest, map[string]string{\n            \"error\": err.Error(),\n        })\n    }\n    \n    // 実行\n    result, err := s.executor.Execute(req)\n    if err != nil {\n        return c.JSON(http.StatusInternalServerError, map[string]string{\n            \"error\": \"Execution failed\",\n        })\n    }\n    \n    // 実行履歴を保存\n    go s.saveExecutionHistory(userID, req, result)\n    \n    return c.JSON(http.StatusOK, result)\n}\n\nfunc (s *Server) checkRateLimit(userID string) error {\n    key := fmt.Sprintf(\"rate_limit:%s\", userID)\n    \n    // 1分間に10回まで\n    count, err := s.cache.Incr(ctx, key).Result()\n    if err != nil {\n        return err\n    }\n    \n    if count == 1 {\n        s.cache.Expire(ctx, key, time.Minute)\n    }\n    \n    if count \u003e 10 {\n        return fmt.Errorf(\"rate limit exceeded\")\n    }\n    \n    return nil\n}\n\nfunc (s *Server) validateCode(code string) error {\n    // 危険なパッケージのインポートをチェック\n    dangerousPackages := []string{\n        \"os/exec\",\n        \"syscall\",\n        \"unsafe\",\n        \"net\",\n        \"net/http\",\n    }\n    \n    for _, pkg := range dangerousPackages {\n        if strings.Contains(code, fmt.Sprintf(`import \"%s\"`, pkg)) ||\n           strings.Contains(code, fmt.Sprintf(`import ( \"%s\"`, pkg)) {\n            return fmt.Errorf(\"package %s is not allowed\", pkg)\n        }\n    }\n    \n    // コードサイズ制限（10KB）\n    if len(code) \u003e 10*1024 {\n        return fmt.Errorf(\"code size exceeds limit\")\n    }\n    \n    return nil\n}\n\nfunc main() {\n    e := echo.New()\n    \n    // ミドルウェア\n    e.Use(middleware.Logger())\n    e.Use(middleware.Recover())\n    e.Use(middleware.CORSWithConfig(middleware.CORSConfig{\n        AllowOrigins: []string{\"http://localhost:3000\"},\n        AllowMethods: []string{http.MethodGet, http.MethodPost},\n    }))\n    \n    server, err := NewServer()\n    if err != nil {\n        e.Logger.Fatal(err)\n    }\n    \n    // ルート定義\n    api := e.Group(\"/api/v1\")\n    api.POST(\"/execute\", server.ExecuteCode)\n    api.GET(\"/challenges/:id\", server.GetChallenge)\n    api.POST(\"/challenges/:id/submit\", server.SubmitSolution)\n    api.GET(\"/progress\", server.GetUserProgress)\n    \n    // WebSocket\n    e.GET(\"/ws\", server.HandleWebSocket)\n    \n    e.Logger.Fatal(e.Start(\":8080\"))\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e学習コンテンツの設計\u003c/h2\u003e\n\u003ch3\u003eカリキュラム構成\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e基礎編（Beginner）:\n  1. Hello World:\n    - Goの基本構文\n    - パッケージとインポート\n    - main関数\n    \n  2. 変数とデータ型:\n    - 変数宣言\n    - 基本データ型\n    - 型推論\n    \n  3. 制御構造:\n    - if文\n    - for文\n    - switch文\n    \n  4. 関数:\n    - 関数定義\n    - 引数と戻り値\n    - 複数戻り値\n\n中級編（Intermediate）:\n  1. 配列とスライス:\n    - 配列の基本\n    - スライスの操作\n    - make関数\n    \n  2. マップ:\n    - マップの作成\n    - 要素の追加・削除\n    - 範囲for文\n    \n  3. 構造体:\n    - 構造体定義\n    - メソッド\n    - ポインタレシーバー\n    \n  4. インターフェース:\n    - インターフェース定義\n    - 実装\n    - 型アサーション\n\n上級編（Advanced）:\n  1. 並行処理:\n    - goroutine\n    - channel\n    - select文\n    \n  2. エラーハンドリング:\n    - error型\n    - panicとrecover\n    - カスタムエラー\n    \n  3. テスト:\n    - 単体テスト\n    - ベンチマーク\n    - テストカバレッジ\n    \n  4. パッケージ管理:\n    - go mod\n    - 依存関係管理\n    - バージョニング\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e課題例\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003e// レベル1: Hello World\n// 課題: \"Hello, [名前]!\" を出力する関数を作成\n\npackage main\n\nimport \"fmt\"\n\nfunc greet(name string) string {\n    // ここにコードを書いてください\n    return \"\"\n}\n\nfunc main() {\n    result := greet(\"Gopher\")\n    fmt.Println(result) // 期待値: \"Hello, Gopher!\"\n}\n\n// テストケース\nfunc TestGreet(t *testing.T) {\n    tests := []struct {\n        input    string\n        expected string\n    }{\n        {\"Gopher\", \"Hello, Gopher!\"},\n        {\"World\", \"Hello, World!\"},\n        {\"\", \"Hello, !\"},\n    }\n    \n    for _, test := range tests {\n        result := greet(test.input)\n        if result != test.expected {\n            t.Errorf(\"greet(%q) = %q; want %q\",\n                test.input, result, test.expected)\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eセキュリティ対策\u003c/h2\u003e\n\u003ch3\u003e1. コード実行環境の隔離\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eDockerコンテナ\u003c/strong\u003e: 各実行を独立したコンテナで実行\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eリソース制限\u003c/strong\u003e: CPU、メモリ、実行時間の制限\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eネットワーク隔離\u003c/strong\u003e: 外部ネットワークへのアクセスを遮断\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e読み取り専用ファイルシステム\u003c/strong\u003e: システムファイルの改変を防止\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e2. 入力検証\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003efunc validateUserInput(code string) error {\n    // SQLインジェクション対策\n    if strings.Contains(strings.ToLower(code), \"drop table\") {\n        return errors.New(\"suspicious SQL command detected\")\n    }\n    \n    // OSコマンドインジェクション対策\n    dangerousCommands := []string{\n        \"rm \", \"dd \", \"mkfs\", \"chmod\", \"chown\",\n    }\n    for _, cmd := range dangerousCommands {\n        if strings.Contains(code, cmd) {\n            return errors.New(\"dangerous system command detected\")\n        }\n    }\n    \n    return nil\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e3. レート制限\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003etype RateLimiter struct {\n    mu       sync.Mutex\n    requests map[string][]time.Time\n}\n\nfunc (r *RateLimiter) Allow(userID string) bool {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n    \n    now := time.Now()\n    windowStart := now.Add(-time.Minute)\n    \n    // 古いリクエストを削除\n    if requests, exists := r.requests[userID]; exists {\n        var filtered []time.Time\n        for _, t := range requests {\n            if t.After(windowStart) {\n                filtered = append(filtered, t)\n            }\n        }\n        r.requests[userID] = filtered\n    }\n    \n    // リクエスト数をチェック\n    if len(r.requests[userID]) \u003e= 10 {\n        return false\n    }\n    \n    // 新しいリクエストを追加\n    r.requests[userID] = append(r.requests[userID], now)\n    return true\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eパフォーマンス最適化\u003c/h2\u003e\n\u003ch3\u003e1. コード実行のキャッシング\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003efunc (s *Server) getCachedResult(codeHash string) (*ExecutionResult, error) {\n    key := fmt.Sprintf(\"execution:%s\", codeHash)\n    \n    val, err := s.cache.Get(ctx, key).Result()\n    if err == redis.Nil {\n        return nil, nil\n    }\n    if err != nil {\n        return nil, err\n    }\n    \n    var result ExecutionResult\n    if err := json.Unmarshal([]byte(val), \u0026#x26;result); err != nil {\n        return nil, err\n    }\n    \n    return \u0026#x26;result, nil\n}\n\nfunc (s *Server) cacheResult(codeHash string, result *ExecutionResult) error {\n    key := fmt.Sprintf(\"execution:%s\", codeHash)\n    \n    data, err := json.Marshal(result)\n    if err != nil {\n        return err\n    }\n    \n    // 1時間キャッシュ\n    return s.cache.Set(ctx, key, data, time.Hour).Err()\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e2. コンテナプールの実装\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003etype ContainerPool struct {\n    mu         sync.Mutex\n    containers chan string\n    maxSize    int\n}\n\nfunc NewContainerPool(size int) *ContainerPool {\n    pool := \u0026#x26;ContainerPool{\n        containers: make(chan string, size),\n        maxSize:    size,\n    }\n    \n    // 事前にコンテナを作成\n    for i := 0; i \u0026#x3C; size; i++ {\n        go pool.createContainer()\n    }\n    \n    return pool\n}\n\nfunc (p *ContainerPool) Get() (string, error) {\n    select {\n    case containerID := \u0026#x3C;-p.containers:\n        return containerID, nil\n    case \u0026#x3C;-time.After(5 * time.Second):\n        // タイムアウト時は新規作成\n        return p.createNewContainer()\n    }\n}\n\nfunc (p *ContainerPool) Put(containerID string) {\n    select {\n    case p.containers \u0026#x3C;- containerID:\n        // プールに戻す\n    default:\n        // プールが満杯の場合は削除\n        p.removeContainer(containerID)\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eモニタリングとログ\u003c/h2\u003e\n\u003ch3\u003ePrometheus メトリクス\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003evar (\n    executionCounter = prometheus.NewCounterVec(\n        prometheus.CounterOpts{\n            Name: \"code_executions_total\",\n            Help: \"Total number of code executions\",\n        },\n        []string{\"status\", \"language\"},\n    )\n    \n    executionDuration = prometheus.NewHistogramVec(\n        prometheus.HistogramOpts{\n            Name:    \"code_execution_duration_seconds\",\n            Help:    \"Code execution duration in seconds\",\n            Buckets: prometheus.DefBuckets,\n        },\n        []string{\"language\"},\n    )\n)\n\nfunc init() {\n    prometheus.MustRegister(executionCounter)\n    prometheus.MustRegister(executionDuration)\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e構造化ログ\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-go\"\u003eimport \"go.uber.org/zap\"\n\nfunc setupLogger() *zap.Logger {\n    config := zap.NewProductionConfig()\n    config.OutputPaths = []string{\"stdout\"}\n    config.ErrorOutputPaths = []string{\"stderr\"}\n    \n    logger, _ := config.Build()\n    return logger\n}\n\n// 使用例\nlogger.Info(\"Code execution started\",\n    zap.String(\"user_id\", userID),\n    zap.String(\"challenge_id\", challengeID),\n    zap.Int(\"code_length\", len(code)),\n)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eデプロイメント\u003c/h2\u003e\n\u003ch3\u003eKubernetes マニフェスト\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: go-learning-api\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: go-learning-api\n  template:\n    metadata:\n      labels:\n        app: go-learning-api\n    spec:\n      containers:\n      - name: api\n        image: go-learning/api:latest\n        ports:\n        - containerPort: 8080\n        env:\n        - name: DATABASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: db-secret\n              key: url\n        - name: REDIS_URL\n          value: redis-service:6379\n        resources:\n          requests:\n            memory: \"256Mi\"\n            cpu: \"250m\"\n          limits:\n            memory: \"512Mi\"\n            cpu: \"500m\"\n        livenessProbe:\n          httpGet:\n            path: /health\n            port: 8080\n          initialDelaySeconds: 30\n          periodSeconds: 10\n        readinessProbe:\n          httpGet:\n            path: /ready\n            port: 8080\n          initialDelaySeconds: 5\n          periodSeconds: 5\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: go-learning-api-service\nspec:\n  selector:\n    app: go-learning-api\n  ports:\n  - port: 80\n    targetPort: 8080\n  type: LoadBalancer\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eCI/CD パイプライン (GitHub Actions)\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003ename: Deploy\n\non:\n  push:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    \n    - name: Set up Go\n      uses: actions/setup-go@v4\n      with:\n        go-version: '1.21'\n    \n    - name: Run tests\n      run: |\n        go test -v ./...\n        go test -race -coverprofile=coverage.txt ./...\n    \n    - name: Upload coverage\n      uses: codecov/codecov-action@v3\n      with:\n        file: ./coverage.txt\n\n  build:\n    needs: test\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    \n    - name: Build Docker image\n      run: |\n        docker build -t go-learning/api:${{ github.sha }} .\n        docker tag go-learning/api:${{ github.sha }} go-learning/api:latest\n    \n    - name: Push to registry\n      run: |\n        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin\n        docker push go-learning/api:${{ github.sha }}\n        docker push go-learning/api:latest\n\n  deploy:\n    needs: build\n    runs-on: ubuntu-latest\n    steps:\n    - name: Deploy to Kubernetes\n      run: |\n        kubectl set image deployment/go-learning-api api=go-learning/api:${{ github.sha }}\n        kubectl rollout status deployment/go-learning-api\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eまとめ\u003c/h2\u003e\n\u003cp\u003eこのGo言語学習プラットフォームの設計では、以下の点に重点を置きました：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eセキュリティ\u003c/strong\u003e: Dockerコンテナによる隔離、入力検証、レート制限\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eスケーラビリティ\u003c/strong\u003e: Kubernetes、コンテナプール、キャッシング\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eユーザー体験\u003c/strong\u003e: リアルタイム実行、即座のフィードバック、進捗管理\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e教育的価値\u003c/strong\u003e: 段階的な学習パス、実践的な課題、詳細な解説\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eこれらの要素を組み合わせることで、安全で効率的、かつ教育効果の高い学習プラットフォームを構築できます。\u003c/p\u003e\n\u003ch2\u003eインフラストラクチャと運用\u003c/h2\u003e\n\u003ch3\u003eデータベースの選定\u003c/h3\u003e\n\u003ch4\u003e1. メインデータベース: PostgreSQL\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e選定理由\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eACIDトランザクションによる高い信頼性\u003c/li\u003e\n\u003cli\u003eJSONBサポートによる柔軟なデータ構造\u003c/li\u003e\n\u003cli\u003e豊富なインデックス機能（B-tree, Hash, GiST, GIN）\u003c/li\u003e\n\u003cli\u003eパーティショニングによる大規模データ対応\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e利用サービス\u003c/strong\u003e: Amazon RDS for PostgreSQL\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eマルチAZ構成で高可用性を実現\u003c/li\u003e\n\u003cli\u003e自動バックアップとポイントインタイムリカバリ\u003c/li\u003e\n\u003cli\u003eRead Replicaによる読み取り性能の向上\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003e-- テーブル設計例\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) UNIQUE NOT NULL,\n    username VARCHAR(50) UNIQUE NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE challenges (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    title VARCHAR(255) NOT NULL,\n    description TEXT,\n    difficulty VARCHAR(20) CHECK (difficulty IN ('beginner', 'intermediate', 'advanced')),\n    test_cases JSONB NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE submissions (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(id),\n    challenge_id UUID REFERENCES challenges(id),\n    code TEXT NOT NULL,\n    status VARCHAR(20) CHECK (status IN ('pending', 'running', 'success', 'failure')),\n    output TEXT,\n    execution_time_ms INTEGER,\n    memory_usage_bytes BIGINT,\n    submitted_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    INDEX idx_user_challenge (user_id, challenge_id)\n) PARTITION BY RANGE (submitted_at);\n\n-- パーティション作成（月次）\nCREATE TABLE submissions_2025_01 PARTITION OF submissions\n    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003e2. キャッシュデータベース: Redis\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e選定理由\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eインメモリによる高速アクセス\u003c/li\u003e\n\u003cli\u003ePub/Sub機能によるリアルタイム通信\u003c/li\u003e\n\u003cli\u003eセッション管理に最適\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e利用サービス\u003c/strong\u003e: Amazon ElastiCache for Redis\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eクラスターモードで自動スケーリング\u003c/li\u003e\n\u003cli\u003e自動フェイルオーバー\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e3. 時系列データ: TimescaleDB\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e用途\u003c/strong\u003e: メトリクス、ログ、実行履歴の保存\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e選定理由\u003c/strong\u003e:\n\u003cul\u003e\n\u003cli\u003ePostgreSQLの拡張で既存インフラと統合しやすい\u003c/li\u003e\n\u003cli\u003e自動パーティショニングと圧縮\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eホスティングサービス\u003c/h3\u003e\n\u003ch4\u003eAWS構成\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003e# インフラストラクチャ構成\nInfrastructure:\n  Region: ap-northeast-1 (東京)\n  \n  Compute:\n    - Service: Amazon EKS\n      NodeGroups:\n        - Name: api-servers\n          InstanceType: t3.medium\n          MinSize: 2\n          MaxSize: 10\n          DesiredSize: 3\n        - Name: code-executors\n          InstanceType: c5.large\n          MinSize: 1\n          MaxSize: 20\n          DesiredSize: 5\n          \n  Database:\n    - Service: Amazon RDS (PostgreSQL)\n      InstanceClass: db.t3.medium\n      MultiAZ: true\n      Storage: 100GB (gp3)\n      \n    - Service: Amazon ElastiCache (Redis)\n      NodeType: cache.t3.micro\n      NumNodes: 2\n      \n  Storage:\n    - Service: Amazon S3\n      Buckets:\n        - user-code-storage\n        - submission-logs\n        - static-assets\n        \n  CDN:\n    - Service: Amazon CloudFront\n      Origins:\n        - S3 (static assets)\n        - ALB (API)\n        \n  Container Registry:\n    - Service: Amazon ECR\n      Repositories:\n        - go-learning-api\n        - code-executor\n        \n  Monitoring:\n    - CloudWatch\n    - Prometheus + Grafana (EKS上)\n    - ELK Stack (Elasticsearch, Logstash, Kibana)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e運用コスト試算（月額）\u003c/h3\u003e\n\u003ch4\u003e小規模（〜1,000ユーザー）\u003c/h4\u003e\n\u003cpre\u003e\u003ccode\u003eAmazon EKS:\n  - Control Plane: $72\n  - t3.medium × 2: $60\n  - c5.large × 1: $62\n  \nAmazon RDS:\n  - db.t3.medium (Multi-AZ): $140\n  - Storage 100GB: $25\n  \nAmazon ElastiCache:\n  - cache.t3.micro × 2: $25\n  \nAmazon S3 + CloudFront:\n  - Storage \u0026#x26; Transfer: $20\n  \nAmazon ECR:\n  - Storage: $10\n  \nその他（ALB, NAT Gateway等）: $50\n\n合計: 約$464/月（約7万円/月）\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003e中規模（〜10,000ユーザー）\u003c/h4\u003e\n\u003cpre\u003e\u003ccode\u003eAmazon EKS:\n  - Control Plane: $72\n  - t3.medium × 4: $120\n  - c5.large × 3: $186\n  \nAmazon RDS:\n  - db.r5.large (Multi-AZ): $460\n  - Storage 500GB: $125\n  - Read Replica: $230\n  \nAmazon ElastiCache:\n  - cache.r5.large × 2: $340\n  \nAmazon S3 + CloudFront:\n  - Storage \u0026#x26; Transfer: $150\n  \nAmazon ECR:\n  - Storage: $30\n  \nその他: $200\n\n合計: 約$1,913/月（約29万円/月）\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003e大規模（〜100,000ユーザー）\u003c/h4\u003e\n\u003cpre\u003e\u003ccode\u003eAmazon EKS:\n  - Control Plane × 2: $144\n  - t3.large × 10: $600\n  - c5.xlarge × 10: $1,240\n  \nAmazon RDS:\n  - db.r5.2xlarge (Multi-AZ): $1,840\n  - Storage 2TB: $500\n  - Read Replica × 3: $2,760\n  \nAmazon ElastiCache:\n  - cache.r5.xlarge × 4: $1,360\n  \nAmazon S3 + CloudFront:\n  - Storage \u0026#x26; Transfer: $1,000\n  \nAmazon ECR:\n  - Storage: $100\n  \nその他: $500\n\n合計: 約$10,044/月（約150万円/月）\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eコスト最適化戦略\u003c/h3\u003e\n\u003ch4\u003e1. Reserved Instances / Savings Plans\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e1年または3年契約で最大72%割引\u003c/li\u003e\n\u003cli\u003e予測可能なワークロードに適用\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e2. Spot Instances\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eコード実行用のワーカーノードに利用\u003c/li\u003e\n\u003cli\u003e最大90%のコスト削減\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003e3. Auto Scaling\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: api-hpa\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: go-learning-api\n  minReplicas: 2\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 70\n  - type: Resource\n    resource:\n      name: memory\n      target:\n        type: Utilization\n        averageUtilization: 80\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003e4. コンテナ最適化\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-dockerfile\"\u003e# マルチステージビルドでイメージサイズ削減\nFROM golang:1.21-alpine AS builder\nWORKDIR /app\nCOPY go.mod go.sum ./\nRUN go mod download\nCOPY . .\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .\n\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nWORKDIR /root/\nCOPY --from=builder /app/main .\nCMD [\"./main\"]\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003e災害復旧計画（DRP）\u003c/h3\u003e\n\u003ch4\u003eバックアップ戦略\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eBackupStrategy:\n  Database:\n    - Type: Automated Backup\n      Frequency: Daily\n      Retention: 30 days\n    - Type: Manual Snapshot\n      Frequency: Weekly\n      Retention: 90 days\n      \n  CodeRepository:\n    - Type: S3 Cross-Region Replication\n      Target: us-west-2\n      \n  Configurations:\n    - Type: AWS Backup\n      Frequency: Daily\n      Retention: 7 days\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003e復旧目標\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eRPO (Recovery Point Objective)\u003c/strong\u003e: 1時間\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRTO (Recovery Time Objective)\u003c/strong\u003e: 4時間\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e監視とアラート\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eMonitoring:\n  Metrics:\n    - API Response Time: \u0026#x3C; 200ms (p95)\n    - Code Execution Time: \u0026#x3C; 5s (p95)\n    - Error Rate: \u0026#x3C; 1%\n    - Availability: \u003e 99.9%\n    \n  Alerts:\n    Critical:\n      - Service Down\n      - Database Connection Failed\n      - Error Rate \u003e 5%\n    Warning:\n      - Response Time \u003e 500ms\n      - CPU Usage \u003e 80%\n      - Memory Usage \u003e 90%\n    Info:\n      - New Deployment\n      - Scaling Event\n      - Backup Completed\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e次のステップ\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eMVP開発\u003c/strong\u003e: 基本機能の実装とテスト\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eコンテンツ作成\u003c/strong\u003e: 学習教材と課題の充実\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eユーザーテスト\u003c/strong\u003e: フィードバックの収集と改善\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e機能拡張\u003c/strong\u003e: AI による学習支援、コードレビュー機能\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eコミュニティ機能\u003c/strong\u003e: フォーラム、コード共有、メンタリング\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eこのプラットフォームを通じて、多くの開発者がGo言語を効率的に学び、実践的なスキルを身につけることができるでしょう。\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto py-10 px-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold mb-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-green-600\",\"children\":[\"#\",27]}],\" \",\"Go言語学習プラットフォーム設計書：ブラウザで動くコード実行環境の構築\"]}],[\"$\",\"ul\",null,{\"className\":\"list-none border-b border-gray-600 pb-4 mb-6\",\"children\":[[\"$\",\"li\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":[\"作成日時: \",\"2025-08-09 05:56\"]}],\"$undefined\",[\"$\",\"li\",null,{\"className\":\"flex flex-wrap gap-2 mt-2\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Go\"}],[\"$\",\"span\",\"1\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"WebAssembly\"}],[\"$\",\"span\",\"2\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"教育\"}],[\"$\",\"span\",\"3\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"システム設計\"}],[\"$\",\"span\",\"4\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Docker\"}],[\"$\",\"span\",\"5\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Kubernetes\"}]]}]]}],[\"$\",\"nav\",null,{\"className\":\"mb-6 pb-4 border-b border-gray-700 flex justify-between\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"← ホームへ\"}],[\"$\",\"$L12\",null,{\"href\":\"/blog\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"記事一覧へ →\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose dark:prose-invert\",\"dangerouslySetInnerHTML\":{\"__html\":\"$13\"}}],[\"$\",\"nav\",null,{\"className\":\"mt-8 pt-4 border-t border-gray-700 flex justify-between\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"← ホームへ\"}],[\"$\",\"$L12\",null,{\"href\":\"/blog\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"記事一覧へ →\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"11:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Maita Tomoya Dev IO\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"米田智哉の技術ブログ。キャッチアップしたことをメモします。\"}]],\"error\":null,\"digest\":\"$undefined\"}\nb:{\"metadata\":\"$11:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>