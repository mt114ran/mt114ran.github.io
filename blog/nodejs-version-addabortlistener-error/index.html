<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/19bdf9af4d1ae4d4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-aa7deb192a774533.js"/><script src="/_next/static/chunks/4bd1b696-bc089769d60af88b.js" async=""></script><script src="/_next/static/chunks/1684-b369840b16e4c44b.js" async=""></script><script src="/_next/static/chunks/main-app-2ed07751e45c2a2f.js" async=""></script><script src="/_next/static/chunks/6874-6c1ddde525f3893c.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js" async=""></script><meta name="next-size-adjust" content=""/><link rel="icon" href="/favicon.png" type="image/png"/><title>Maita Tomoya Dev IO</title><meta name="description" content="米田智哉の技術ブログ。キャッチアップしたことをメモします。"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_5cfdac __variable_9a8899 antialiased"><div class="max-w-2xl mx-auto py-10 px-4"><h1 class="text-3xl font-bold mb-2"><span class="text-green-600">#<!-- -->20</span> <!-- -->Node.js v19からv20へ：addAbortListenerエラーの解決と最新APIの重要性</h1><ul class="list-none border-b border-gray-600 pb-4 mb-6"><li class="text-gray-500 text-sm">作成日時: <!-- -->2025-08-05 00:45</li><li class="flex flex-wrap gap-2 mt-2"><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Node.js</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">JavaScript</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">エラー解決</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">バージョン管理</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">API</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">Claude CLI</span><span class="px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs">開発環境</span></li></ul><nav class="mb-6 pb-4 border-b border-gray-700 flex justify-between"><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/">← ホームへ</a><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/blog/">記事一覧へ →</a></nav><article class="prose dark:prose-invert"><h1 id="nodejs-v19からv20へaddabortlistenerエラーの解決と最新apiの重要性">Node.js v19からv20へ：addAbortListenerエラーの解決と最新APIの重要性</h1>
<h2 id="はじめに">はじめに</h2>
<p>最近、Claude CLIを実行しようとしたところ、以下のエラーに遭遇しました：</p>
<pre><code class="language-bash">$ claude
SyntaxError: The requested module 'node:events' does not provide an export named 'addAbortListener'
    at ModuleJob._instantiate (node:internal/modules/esm/module_job:123:21)
    at async ModuleJob.run (node:internal/modules/esm/module_job:189:5)

Node.js v19.9.0
</code></pre>
<p>このエラーは、<strong>Node.jsのバージョンが古い</strong>ことが原因です。今回は、このエラーの詳細な解説と、Node.jsのバージョン管理の重要性について解説します。</p>
<h2 id="エラーの原因addabortlistenerとは">エラーの原因：addAbortListenerとは</h2>
<h3 id="addabortlistenerの概要">addAbortListenerの概要</h3>
<p><code>addAbortListener</code>は、Node.js v20.5.0で追加された新しいAPIです。このAPIは、<strong>AbortSignalのイベントリスナーを管理する</strong>ための便利な関数です。</p>
<pre><code class="language-javascript">// Node.js v20.5.0以降で利用可能
import { addAbortListener } from 'node:events';

const controller = new AbortController();
const { signal } = controller;

// リスナーを追加
const removeListener = addAbortListener(signal, () => {
  console.log('操作がキャンセルされました');
});

// 後でリスナーを削除
removeListener();
</code></pre>
<h3 id="なぜaddabortlistenerが必要なのか">なぜaddAbortListenerが必要なのか</h3>
<h4 id="従来の方法v2050以前">従来の方法（v20.5.0以前）</h4>
<pre><code class="language-javascript">const controller = new AbortController();
const { signal } = controller;

// 従来の方法：直接イベントリスナーを追加
const listener = () => {
  console.log('操作がキャンセルされました');
};

signal.addEventListener('abort', listener);

// リスナーを削除する際は明示的に
signal.removeEventListener('abort', listener);
</code></pre>
<h4 id="新しい方法v2050以降">新しい方法（v20.5.0以降）</h4>
<pre><code class="language-javascript">import { addAbortListener } from 'node:events';

// より簡潔で、メモリリークを防ぎやすい
const removeListener = addAbortListener(signal, () => {
  console.log('操作がキャンセルされました');
});

// 返り値の関数を呼ぶだけで削除
removeListener();
</code></pre>
<h3 id="abortsignalの実用例">AbortSignalの実用例</h3>
<pre><code class="language-javascript">// ファイルのダウンロード処理
async function downloadFile(url, signal) {
  const removeListener = addAbortListener(signal, () => {
    console.log('ダウンロードがキャンセルされました');
    // クリーンアップ処理
  });

  try {
    const response = await fetch(url, { signal });
    const data = await response.blob();
    return data;
  } finally {
    // 必ずリスナーを削除
    removeListener();
  }
}

// 使用例
const controller = new AbortController();
const downloadPromise = downloadFile('https://example.com/large-file.zip', controller.signal);

// 5秒後にキャンセル
setTimeout(() => {
  controller.abort();
}, 5000);
</code></pre>
<h2 id="nodejsのバージョン間の主な違い">Node.jsのバージョン間の主な違い</h2>
<h3 id="nodejs-v19--v20の主要な変更点">Node.js v19 → v20の主要な変更点</h3>
<h4 id="1-stable-test-runner">1. <strong>Stable Test Runner</strong></h4>
<pre><code class="language-javascript">// Node.js v20でテストランナーが安定版に
import { test, describe } from 'node:test';

describe('数学関数', () => {
  test('足し算', async (t) => {
    assert.strictEqual(1 + 1, 2);
  });
});
</code></pre>
<h4 id="2-permission-model実験的">2. <strong>Permission Model（実験的）</strong></h4>
<pre><code class="language-bash"># ファイルシステムへのアクセスを制限
node --experimental-permission --allow-fs-read=/home/user/project index.js
</code></pre>
<h4 id="3-single-executable-applicationssea">3. <strong>Single Executable Applications（SEA）</strong></h4>
<pre><code class="language-bash"># Node.jsアプリを単一の実行可能ファイルに
node --experimental-sea-config sea-config.json
</code></pre>
<h4 id="4-web-crypto-api-の改善">4. <strong>Web Crypto API の改善</strong></h4>
<pre><code class="language-javascript">// より多くの暗号化アルゴリズムをサポート
const subtle = globalThis.crypto.subtle;
const key = await subtle.generateKey(
  { name: 'AES-GCM', length: 256 },
  true,
  ['encrypt', 'decrypt']
);
</code></pre>
<h2 id="バージョンエラーの解決方法">バージョンエラーの解決方法</h2>
<h3 id="方法1-homebrewを使用macos">方法1: Homebrewを使用（macOS）</h3>
<pre><code class="language-bash"># Homebrewのアップデート
brew update

# Node.jsのアップグレード
brew upgrade node

# バージョン確認
node --version
# v20.x.x または v21.x.x が表示されるはず
</code></pre>
<h3 id="方法2-node-version-manager-nvm-を使用">方法2: Node Version Manager (nvm) を使用</h3>
<pre><code class="language-bash"># nvmのインストール（まだの場合）
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# シェルの再読み込み
source ~/.bashrc  # または ~/.zshrc

# 利用可能なNode.jsバージョンを確認
nvm ls-remote --lts

# 最新のLTS版をインストール
nvm install --lts

# デフォルトバージョンとして設定
nvm alias default node

# 確認
node --version
</code></pre>
<h3 id="方法3-n-を使用シンプルなバージョン管理">方法3: n を使用（シンプルなバージョン管理）</h3>
<pre><code class="language-bash"># n のインストール
npm install -g n

# 最新のLTS版をインストール
sudo n lts

# または特定のバージョン
sudo n 20.11.0

# インストール済みバージョンの確認
n ls

# バージョンの切り替え（インタラクティブ）
n
</code></pre>
<h3 id="方法4-asdf-を使用多言語対応">方法4: asdf を使用（多言語対応）</h3>
<pre><code class="language-bash"># asdfのインストール
git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.14.0

# Node.jsプラグインを追加
asdf plugin add nodejs

# 最新のLTS版をインストール
asdf install nodejs latest:20

# グローバルに設定
asdf global nodejs latest:20

# プロジェクト固有の設定
echo "nodejs 20.11.0" > .tool-versions
</code></pre>
<h2 id="バージョン管理のベストプラクティス">バージョン管理のベストプラクティス</h2>
<h3 id="1-プロジェクトごとのバージョン固定">1. プロジェクトごとのバージョン固定</h3>
<p><strong>.nvmrc</strong>ファイルを作成：</p>
<pre><code class="language-bash">echo "20.11.0" > .nvmrc

# プロジェクトディレクトリに入ったときに自動切り替え
nvm use
</code></pre>
<p><strong>package.json</strong>でエンジンを指定：</p>
<pre><code class="language-json">{
  "engines": {
    "node": ">=20.5.0",
    "npm": ">=10.0.0"
  }
}
</code></pre>
<h3 id="2-cicdでのバージョン統一">2. CI/CDでのバージョン統一</h3>
<p><strong>GitHub Actions</strong>の例：</p>
<pre><code class="language-yaml">name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [20.x, 21.x]

    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    - run: npm ci
    - run: npm test
</code></pre>
<h3 id="3-自動バージョンチェック">3. 自動バージョンチェック</h3>
<p><strong>スクリプトでバージョンを確認</strong>：</p>
<pre><code class="language-javascript">// check-node-version.js
const requiredVersion = '20.5.0';
const currentVersion = process.version.slice(1); // 'v'を除去

function compareVersions(current, required) {
  const currentParts = current.split('.').map(Number);
  const requiredParts = required.split('.').map(Number);

  for (let i = 0; i &#x3C; requiredParts.length; i++) {
    if (currentParts[i] &#x3C; requiredParts[i]) return false;
    if (currentParts[i] > requiredParts[i]) return true;
  }
  return true;
}

if (!compareVersions(currentVersion, requiredVersion)) {
  console.error(`❌ Node.js v${requiredVersion}以降が必要です。現在: v${currentVersion}`);
  console.error('📦 実行: nvm install --lts または brew upgrade node');
  process.exit(1);
}

console.log(`✅ Node.js v${currentVersion} - 要件を満たしています`);
</code></pre>
<h2 id="トラブルシューティング">トラブルシューティング</h2>
<h3 id="よくある問題と解決策">よくある問題と解決策</h3>
<h4 id="1-nvmコマンドが見つからない">1. nvmコマンドが見つからない</h4>
<pre><code class="language-bash"># ~/.bashrcまたは~/.zshrcに追加
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] &#x26;&#x26; \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] &#x26;&#x26; \. "$NVM_DIR/bash_completion"

# 設定を再読み込み
source ~/.bashrc  # または source ~/.zshrc
</code></pre>
<h4 id="2-権限エラーwindowsの場合">2. 権限エラー（Windowsの場合）</h4>
<pre><code class="language-powershell"># 管理者権限でPowerShellを開く
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# nvm-windowsをインストール
choco install nvm
</code></pre>
<h4 id="3-グローバルパッケージの移行">3. グローバルパッケージの移行</h4>
<pre><code class="language-bash"># 古いバージョンのグローバルパッケージをリスト
npm list -g --depth=0

# 新しいバージョンに切り替え後、再インストール
npm install -g claude typescript eslint prettier
</code></pre>
<h2 id="nodejsバージョンアップの影響">Node.jsバージョンアップの影響</h2>
<h3 id="パフォーマンスの向上">パフォーマンスの向上</h3>
<p>Node.js v20では、V8エンジンのアップデートにより：</p>
<ul>
<li><strong>起動時間が20%高速化</strong></li>
<li><strong>メモリ使用量が15%削減</strong></li>
<li><strong>RegExpの実行速度が向上</strong></li>
</ul>
<pre><code class="language-javascript">// ベンチマークの例
console.time('regex');
const text = 'a'.repeat(1000000);
const matches = text.match(/a/g);
console.timeEnd('regex');
// v19: regex: 45ms
// v20: regex: 38ms
</code></pre>
<h3 id="セキュリティの強化">セキュリティの強化</h3>
<ul>
<li><strong>OpenSSL 3.0</strong>のサポート</li>
<li>**HTTP Strict Transport Security (HSTS)**の改善</li>
<li><strong>依存関係の脆弱性修正</strong></li>
</ul>
<h2 id="まとめ">まとめ</h2>
<p><code>addAbortListener</code>エラーは、単なるバージョンの問題ですが、これを機に以下の重要性を認識できます：</p>
<ol>
<li><strong>最新APIの活用</strong> - より効率的で安全なコードが書ける</li>
<li><strong>バージョン管理の重要性</strong> - プロジェクトの安定性を保つ</li>
<li><strong>定期的なアップデート</strong> - セキュリティとパフォーマンスの向上</li>
</ol>
<h3 id="推奨アクション">推奨アクション</h3>
<ol>
<li><strong>即座に対応</strong>：Node.js v20.5.0以降にアップデート</li>
<li><strong>バージョン管理ツール導入</strong>：nvm、n、asdfなど</li>
<li><strong>プロジェクト設定</strong>：.nvmrcやenginesフィールドでバージョン固定</li>
<li><strong>CI/CD統合</strong>：自動テストでバージョン互換性を確認</li>
</ol>
<p>小さなエラーから学ぶことで、より堅牢な開発環境を構築できます。定期的なNode.jsのアップデートを心がけ、最新の機能を活用していきましょう。</p>
<h2 id="参考資料">参考資料</h2>
<ul>
<li><a href="https://nodejs.org/en/blog/release/v20.0.0">Node.js v20.0.0 Release Notes</a></li>
<li><a href="https://nodejs.org/api/events.html#eventsaddabortlistenersignal-listener">Node.js API Documentation - addAbortListener</a></li>
<li><a href="https://github.com/nvm-sh/nvm">nvm - Node Version Manager</a></li>
<li><a href="https://nodejs.org/en/about/previous-releases">Node.js Release Schedule</a></li>
<li><a href="https://v8.dev/blog">V8 JavaScript Engine Blog</a></li>
<li><a href="https://github.com/goldbergyoni/nodebestpractices">Node.js Best Practices</a></li>
</ul></article><nav class="mt-8 pt-4 border-t border-gray-700 flex justify-between"><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/">← ホームへ</a><a class="text-blue-400 hover:text-blue-300 hover:underline" href="/blog/">記事一覧へ →</a></nav></div><!--$--><!--/$--><!--$--><!--/$--><script src="/_next/static/chunks/webpack-aa7deb192a774533.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[87555,[],\"\"]\n3:I[31295,[],\"\"]\n5:I[59665,[],\"MetadataBoundary\"]\n7:I[59665,[],\"OutletBoundary\"]\na:I[74911,[],\"AsyncMetadataOutlet\"]\nc:I[59665,[],\"ViewportBoundary\"]\ne:I[26614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/19bdf9af4d1ae4d4.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"UZMNZgIyubYn-Hg_v0HIE\",\"p\":\"\",\"c\":[\"\",\"blog\",\"nodejs-version-addabortlistener-error\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"nodejs-version-addabortlistener-error\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/19bdf9af4d1ae4d4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.png\",\"type\":\"image/png\"}]}],[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac __variable_9a8899 antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"nodejs-version-addabortlistener-error\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",[\"$\",\"$L5\",null,{\"children\":\"$L6\"}],null,[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",[\"$\",\"$La\",null,{\"promise\":\"$@b\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"xTkfmhjdXEd5rN7vsVhDB\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:\"$Sreact.suspense\"\n10:I[74911,[],\"AsyncMetadata\"]\n6:[\"$\",\"$f\",null,{\"fallback\":null,\"children\":[\"$\",\"$L10\",null,{\"promise\":\"$@11\"}]}]\n"])</script><script>self.__next_f.push([1,"9:null\n"])</script><script>self.__next_f.push([1,"12:I[6874,[\"6874\",\"static/chunks/6874-6c1ddde525f3893c.js\",\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js\"],\"\"]\n14:I[31203,[\"6874\",\"static/chunks/6874-6c1ddde525f3893c.js\",\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js\"],\"default\"]\n15:I[4197,[\"6874\",\"static/chunks/6874-6c1ddde525f3893c.js\",\"5953\",\"static/chunks/app/blog/%5Bslug%5D/page-26397bcee018c1a3.js\"],\"default\"]\n13:T32a9,"])</script><script>self.__next_f.push([1,"\u003ch1 id=\"nodejs-v19からv20へaddabortlistenerエラーの解決と最新apiの重要性\"\u003eNode.js v19からv20へ：addAbortListenerエラーの解決と最新APIの重要性\u003c/h1\u003e\n\u003ch2 id=\"はじめに\"\u003eはじめに\u003c/h2\u003e\n\u003cp\u003e最近、Claude CLIを実行しようとしたところ、以下のエラーに遭遇しました：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e$ claude\nSyntaxError: The requested module 'node:events' does not provide an export named 'addAbortListener'\n    at ModuleJob._instantiate (node:internal/modules/esm/module_job:123:21)\n    at async ModuleJob.run (node:internal/modules/esm/module_job:189:5)\n\nNode.js v19.9.0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eこのエラーは、\u003cstrong\u003eNode.jsのバージョンが古い\u003c/strong\u003eことが原因です。今回は、このエラーの詳細な解説と、Node.jsのバージョン管理の重要性について解説します。\u003c/p\u003e\n\u003ch2 id=\"エラーの原因addabortlistenerとは\"\u003eエラーの原因：addAbortListenerとは\u003c/h2\u003e\n\u003ch3 id=\"addabortlistenerの概要\"\u003eaddAbortListenerの概要\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003eaddAbortListener\u003c/code\u003eは、Node.js v20.5.0で追加された新しいAPIです。このAPIは、\u003cstrong\u003eAbortSignalのイベントリスナーを管理する\u003c/strong\u003eための便利な関数です。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// Node.js v20.5.0以降で利用可能\nimport { addAbortListener } from 'node:events';\n\nconst controller = new AbortController();\nconst { signal } = controller;\n\n// リスナーを追加\nconst removeListener = addAbortListener(signal, () =\u003e {\n  console.log('操作がキャンセルされました');\n});\n\n// 後でリスナーを削除\nremoveListener();\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"なぜaddabortlistenerが必要なのか\"\u003eなぜaddAbortListenerが必要なのか\u003c/h3\u003e\n\u003ch4 id=\"従来の方法v2050以前\"\u003e従来の方法（v20.5.0以前）\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003econst controller = new AbortController();\nconst { signal } = controller;\n\n// 従来の方法：直接イベントリスナーを追加\nconst listener = () =\u003e {\n  console.log('操作がキャンセルされました');\n};\n\nsignal.addEventListener('abort', listener);\n\n// リスナーを削除する際は明示的に\nsignal.removeEventListener('abort', listener);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"新しい方法v2050以降\"\u003e新しい方法（v20.5.0以降）\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003eimport { addAbortListener } from 'node:events';\n\n// より簡潔で、メモリリークを防ぎやすい\nconst removeListener = addAbortListener(signal, () =\u003e {\n  console.log('操作がキャンセルされました');\n});\n\n// 返り値の関数を呼ぶだけで削除\nremoveListener();\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"abortsignalの実用例\"\u003eAbortSignalの実用例\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// ファイルのダウンロード処理\nasync function downloadFile(url, signal) {\n  const removeListener = addAbortListener(signal, () =\u003e {\n    console.log('ダウンロードがキャンセルされました');\n    // クリーンアップ処理\n  });\n\n  try {\n    const response = await fetch(url, { signal });\n    const data = await response.blob();\n    return data;\n  } finally {\n    // 必ずリスナーを削除\n    removeListener();\n  }\n}\n\n// 使用例\nconst controller = new AbortController();\nconst downloadPromise = downloadFile('https://example.com/large-file.zip', controller.signal);\n\n// 5秒後にキャンセル\nsetTimeout(() =\u003e {\n  controller.abort();\n}, 5000);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"nodejsのバージョン間の主な違い\"\u003eNode.jsのバージョン間の主な違い\u003c/h2\u003e\n\u003ch3 id=\"nodejs-v19--v20の主要な変更点\"\u003eNode.js v19 → v20の主要な変更点\u003c/h3\u003e\n\u003ch4 id=\"1-stable-test-runner\"\u003e1. \u003cstrong\u003eStable Test Runner\u003c/strong\u003e\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// Node.js v20でテストランナーが安定版に\nimport { test, describe } from 'node:test';\n\ndescribe('数学関数', () =\u003e {\n  test('足し算', async (t) =\u003e {\n    assert.strictEqual(1 + 1, 2);\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"2-permission-model実験的\"\u003e2. \u003cstrong\u003ePermission Model（実験的）\u003c/strong\u003e\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# ファイルシステムへのアクセスを制限\nnode --experimental-permission --allow-fs-read=/home/user/project index.js\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"3-single-executable-applicationssea\"\u003e3. \u003cstrong\u003eSingle Executable Applications（SEA）\u003c/strong\u003e\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Node.jsアプリを単一の実行可能ファイルに\nnode --experimental-sea-config sea-config.json\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"4-web-crypto-api-の改善\"\u003e4. \u003cstrong\u003eWeb Crypto API の改善\u003c/strong\u003e\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// より多くの暗号化アルゴリズムをサポート\nconst subtle = globalThis.crypto.subtle;\nconst key = await subtle.generateKey(\n  { name: 'AES-GCM', length: 256 },\n  true,\n  ['encrypt', 'decrypt']\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"バージョンエラーの解決方法\"\u003eバージョンエラーの解決方法\u003c/h2\u003e\n\u003ch3 id=\"方法1-homebrewを使用macos\"\u003e方法1: Homebrewを使用（macOS）\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Homebrewのアップデート\nbrew update\n\n# Node.jsのアップグレード\nbrew upgrade node\n\n# バージョン確認\nnode --version\n# v20.x.x または v21.x.x が表示されるはず\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"方法2-node-version-manager-nvm-を使用\"\u003e方法2: Node Version Manager (nvm) を使用\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# nvmのインストール（まだの場合）\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\n\n# シェルの再読み込み\nsource ~/.bashrc  # または ~/.zshrc\n\n# 利用可能なNode.jsバージョンを確認\nnvm ls-remote --lts\n\n# 最新のLTS版をインストール\nnvm install --lts\n\n# デフォルトバージョンとして設定\nnvm alias default node\n\n# 確認\nnode --version\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"方法3-n-を使用シンプルなバージョン管理\"\u003e方法3: n を使用（シンプルなバージョン管理）\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# n のインストール\nnpm install -g n\n\n# 最新のLTS版をインストール\nsudo n lts\n\n# または特定のバージョン\nsudo n 20.11.0\n\n# インストール済みバージョンの確認\nn ls\n\n# バージョンの切り替え（インタラクティブ）\nn\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"方法4-asdf-を使用多言語対応\"\u003e方法4: asdf を使用（多言語対応）\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# asdfのインストール\ngit clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.14.0\n\n# Node.jsプラグインを追加\nasdf plugin add nodejs\n\n# 最新のLTS版をインストール\nasdf install nodejs latest:20\n\n# グローバルに設定\nasdf global nodejs latest:20\n\n# プロジェクト固有の設定\necho \"nodejs 20.11.0\" \u003e .tool-versions\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"バージョン管理のベストプラクティス\"\u003eバージョン管理のベストプラクティス\u003c/h2\u003e\n\u003ch3 id=\"1-プロジェクトごとのバージョン固定\"\u003e1. プロジェクトごとのバージョン固定\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003e.nvmrc\u003c/strong\u003eファイルを作成：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eecho \"20.11.0\" \u003e .nvmrc\n\n# プロジェクトディレクトリに入ったときに自動切り替え\nnvm use\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003epackage.json\u003c/strong\u003eでエンジンを指定：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \"engines\": {\n    \"node\": \"\u003e=20.5.0\",\n    \"npm\": \"\u003e=10.0.0\"\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"2-cicdでのバージョン統一\"\u003e2. CI/CDでのバージョン統一\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eGitHub Actions\u003c/strong\u003eの例：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003ename: CI\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        node-version: [20.x, 21.x]\n\n    steps:\n    - uses: actions/checkout@v4\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v4\n      with:\n        node-version: ${{ matrix.node-version }}\n        cache: 'npm'\n    - run: npm ci\n    - run: npm test\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"3-自動バージョンチェック\"\u003e3. 自動バージョンチェック\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eスクリプトでバージョンを確認\u003c/strong\u003e：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// check-node-version.js\nconst requiredVersion = '20.5.0';\nconst currentVersion = process.version.slice(1); // 'v'を除去\n\nfunction compareVersions(current, required) {\n  const currentParts = current.split('.').map(Number);\n  const requiredParts = required.split('.').map(Number);\n\n  for (let i = 0; i \u0026#x3C; requiredParts.length; i++) {\n    if (currentParts[i] \u0026#x3C; requiredParts[i]) return false;\n    if (currentParts[i] \u003e requiredParts[i]) return true;\n  }\n  return true;\n}\n\nif (!compareVersions(currentVersion, requiredVersion)) {\n  console.error(`❌ Node.js v${requiredVersion}以降が必要です。現在: v${currentVersion}`);\n  console.error('📦 実行: nvm install --lts または brew upgrade node');\n  process.exit(1);\n}\n\nconsole.log(`✅ Node.js v${currentVersion} - 要件を満たしています`);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"トラブルシューティング\"\u003eトラブルシューティング\u003c/h2\u003e\n\u003ch3 id=\"よくある問題と解決策\"\u003eよくある問題と解決策\u003c/h3\u003e\n\u003ch4 id=\"1-nvmコマンドが見つからない\"\u003e1. nvmコマンドが見つからない\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# ~/.bashrcまたは~/.zshrcに追加\nexport NVM_DIR=\"$HOME/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] \u0026#x26;\u0026#x26; \\. \"$NVM_DIR/nvm.sh\"\n[ -s \"$NVM_DIR/bash_completion\" ] \u0026#x26;\u0026#x26; \\. \"$NVM_DIR/bash_completion\"\n\n# 設定を再読み込み\nsource ~/.bashrc  # または source ~/.zshrc\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"2-権限エラーwindowsの場合\"\u003e2. 権限エラー（Windowsの場合）\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-powershell\"\u003e# 管理者権限でPowerShellを開く\nSet-ExecutionPolicy RemoteSigned -Scope CurrentUser\n\n# nvm-windowsをインストール\nchoco install nvm\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4 id=\"3-グローバルパッケージの移行\"\u003e3. グローバルパッケージの移行\u003c/h4\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# 古いバージョンのグローバルパッケージをリスト\nnpm list -g --depth=0\n\n# 新しいバージョンに切り替え後、再インストール\nnpm install -g claude typescript eslint prettier\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"nodejsバージョンアップの影響\"\u003eNode.jsバージョンアップの影響\u003c/h2\u003e\n\u003ch3 id=\"パフォーマンスの向上\"\u003eパフォーマンスの向上\u003c/h3\u003e\n\u003cp\u003eNode.js v20では、V8エンジンのアップデートにより：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003e起動時間が20%高速化\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eメモリ使用量が15%削減\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRegExpの実行速度が向上\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e// ベンチマークの例\nconsole.time('regex');\nconst text = 'a'.repeat(1000000);\nconst matches = text.match(/a/g);\nconsole.timeEnd('regex');\n// v19: regex: 45ms\n// v20: regex: 38ms\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"セキュリティの強化\"\u003eセキュリティの強化\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eOpenSSL 3.0\u003c/strong\u003eのサポート\u003c/li\u003e\n\u003cli\u003e**HTTP Strict Transport Security (HSTS)**の改善\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e依存関係の脆弱性修正\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"まとめ\"\u003eまとめ\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eaddAbortListener\u003c/code\u003eエラーは、単なるバージョンの問題ですが、これを機に以下の重要性を認識できます：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e最新APIの活用\u003c/strong\u003e - より効率的で安全なコードが書ける\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eバージョン管理の重要性\u003c/strong\u003e - プロジェクトの安定性を保つ\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003e定期的なアップデート\u003c/strong\u003e - セキュリティとパフォーマンスの向上\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"推奨アクション\"\u003e推奨アクション\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003e即座に対応\u003c/strong\u003e：Node.js v20.5.0以降にアップデート\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eバージョン管理ツール導入\u003c/strong\u003e：nvm、n、asdfなど\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eプロジェクト設定\u003c/strong\u003e：.nvmrcやenginesフィールドでバージョン固定\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eCI/CD統合\u003c/strong\u003e：自動テストでバージョン互換性を確認\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e小さなエラーから学ぶことで、より堅牢な開発環境を構築できます。定期的なNode.jsのアップデートを心がけ、最新の機能を活用していきましょう。\u003c/p\u003e\n\u003ch2 id=\"参考資料\"\u003e参考資料\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/en/blog/release/v20.0.0\"\u003eNode.js v20.0.0 Release Notes\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/api/events.html#eventsaddabortlistenersignal-listener\"\u003eNode.js API Documentation - addAbortListener\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/nvm-sh/nvm\"\u003envm - Node Version Manager\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.org/en/about/previous-releases\"\u003eNode.js Release Schedule\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://v8.dev/blog\"\u003eV8 JavaScript Engine Blog\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/goldbergyoni/nodebestpractices\"\u003eNode.js Best Practices\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto py-10 px-4\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold mb-2\",\"children\":[[\"$\",\"span\",null,{\"className\":\"text-green-600\",\"children\":[\"#\",20]}],\" \",\"Node.js v19からv20へ：addAbortListenerエラーの解決と最新APIの重要性\"]}],[\"$\",\"ul\",null,{\"className\":\"list-none border-b border-gray-600 pb-4 mb-6\",\"children\":[[\"$\",\"li\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":[\"作成日時: \",\"2025-08-05 00:45\"]}],\"$undefined\",[\"$\",\"li\",null,{\"className\":\"flex flex-wrap gap-2 mt-2\",\"children\":[[\"$\",\"span\",\"0\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Node.js\"}],[\"$\",\"span\",\"1\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"JavaScript\"}],[\"$\",\"span\",\"2\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"エラー解決\"}],[\"$\",\"span\",\"3\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"バージョン管理\"}],[\"$\",\"span\",\"4\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"API\"}],[\"$\",\"span\",\"5\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"Claude CLI\"}],[\"$\",\"span\",\"6\",{\"className\":\"px-2 py-1 bg-gray-800 text-gray-300 rounded text-xs\",\"children\":\"開発環境\"}]]}]]}],[\"$\",\"nav\",null,{\"className\":\"mb-6 pb-4 border-b border-gray-700 flex justify-between\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"← ホームへ\"}],[\"$\",\"$L12\",null,{\"href\":\"/blog\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"記事一覧へ →\"}]]}],[\"$\",\"article\",null,{\"className\":\"prose dark:prose-invert\",\"dangerouslySetInnerHTML\":{\"__html\":\"$13\"}}],[\"$\",\"$L14\",null,{}],[\"$\",\"nav\",null,{\"className\":\"mt-8 pt-4 border-t border-gray-700 flex justify-between\",\"children\":[[\"$\",\"$L12\",null,{\"href\":\"/\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"← ホームへ\"}],[\"$\",\"$L12\",null,{\"href\":\"/blog\",\"className\":\"text-blue-400 hover:text-blue-300 hover:underline\",\"children\":\"記事一覧へ →\"}]]}],[\"$\",\"$L15\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"11:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Maita Tomoya Dev IO\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"米田智哉の技術ブログ。キャッチアップしたことをメモします。\"}]],\"error\":null,\"digest\":\"$undefined\"}\nb:{\"metadata\":\"$11:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>