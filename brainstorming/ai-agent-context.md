# AIエージェントのコンテキスト設計についての壁打ち

## コンテキストとは何か

AIエージェントにおけるコンテキストとは、AIが回答を生成する際の基準となる指示や背景情報のことです。これをMarkdownファイル（通常は `CLAUDE.md` や `INSTRUCTIONS.md` など）に記述することで、AIの振る舞いを制御します。

## なぜコンテキストが重要なのか

### 1. 一貫性の確保
- プロジェクト全体で統一された応答スタイル
- 特定のルールや規約の遵守
- チーム内での品質基準の統一

### 2. 効率性の向上
- 毎回同じ指示を繰り返す必要がない
- プロジェクト固有の知識を事前に定義
- よくある質問への対応方法を標準化

### 3. エラーの防止
- 禁止事項の明確化
- セキュリティルールの徹底
- 間違いやすいパターンの事前警告

## コンテキストファイルの構成要素

### 基本構造
```markdown
# プロジェクト名

## 上位ルール
- 絶対に守るべき原則
- セキュリティ関連の制約
- 言語設定（日本語での思考と回答など）

## プロジェクト固有ルール
- コーディング規約
- ファイル命名規則
- コメントの書き方

## 技術スタック
- 使用するフレームワーク
- ライブラリのバージョン
- 開発環境の設定

## ワークフロー
- タスクの進め方
- レビュープロセス
- デプロイ手順

## 禁止事項
- やってはいけないこと
- 避けるべきパターン
- セキュリティリスク
```

## 効果的なコンテキストの書き方

### 1. 明確で具体的に
```markdown
# 悪い例
- コードは綺麗に書く

# 良い例
- 関数は単一責任の原則に従い、1つの機能のみを実装する
- 関数名は動詞から始まり、何をするかを明確に示す（例：getUserData、calculateTotal）
```

### 2. 優先順位を明確に
```markdown
## 【最重要】セキュリティルール
- 秘密鍵は絶対にコミットしない
- 環境変数で機密情報を管理する

## 推奨事項
- 可能な限りTypeScriptを使用する
```

### 3. 例を豊富に含める
```markdown
## ブランチ戦略
❌ 絶対にやってはいけない例：
git checkout master
git commit -m "直接修正"

✅ 正しい例：
git checkout -b feature/new-function
git commit -m "feat: 新機能を追加"
```

## コンテキストの階層構造

### グローバルコンテキスト（~/.claude/CLAUDE.md）
- すべてのプロジェクトで共通のルール
- 個人の好みや作業スタイル
- 基本的なセキュリティポリシー

### プロジェクトコンテキスト（プロジェクトルート/CLAUDE.md）
- そのプロジェクト固有のルール
- 技術スタックの詳細
- チーム内の規約

### タスクコンテキスト（一時的な指示）
- 特定のタスクのみに適用
- 実験的な設定
- 短期的な制約

## コンテキストの更新と管理

### 定期的な見直し
- プロジェクトの成長に合わせて更新
- 新しい問題が発生したら追記
- 不要になったルールは削除

### バージョン管理
- Gitで管理してチーム全体で共有
- 変更履歴を追跡
- レビュープロセスを通じて品質確保

## 実際の活用例

### 例1：ブログ記事生成の自動化
```markdown
## 技術ブログ記事生成ルール
1. 記事は初心者（実務経験0-3年）とミドル（4-10年）両方に価値がある内容
2. 必ずGemini CLIでレビューを受ける
3. コード例は実際に動作確認する
4. 参考リンクのデッドリンクチェックを行う
```

### 例2：Git操作の制御
```markdown
## 【最重要】Git操作の絶対ルール
### ⚠️ masterブランチへの直接操作は絶対禁止
- 変更は必ずfeatureブランチで行う
- PRを作成してレビューを受ける
- 緊急時でも明示的な許可なくマージしない
```

## コンテキスト設計のベストプラクティス

### 1. DRY原則（Don't Repeat Yourself）
- 同じルールを複数箇所に書かない
- 共通ルールは上位に配置
- 参照関係を明確にする

### 2. KISS原則（Keep It Simple, Stupid）
- 複雑すぎるルールは避ける
- シンプルで理解しやすい表現
- 必要最小限の制約

### 3. 段階的な詳細化
```markdown
## 概要レベル
- テストを書く

## 詳細レベル
- ユニットテストはVitestで記述
- カバレッジ80%以上を維持
- E2EテストはPlaywrightを使用
```

## コンテキストの落とし穴

### 1. 過度な制約
- AIの創造性を阻害
- 柔軟な対応ができなくなる
- メンテナンスコストの増大

### 2. 曖昧な表現
- 「適切に」「必要に応じて」などの主観的な表現
- 具体的な基準がない指示
- 解釈の余地が大きすぎる

### 3. 矛盾するルール
- 優先順位が不明確
- 異なるセクションで相反する指示
- 更新時の不整合

## 今後の展望

### AIコンテキストの進化
1. **動的コンテキスト**：状況に応じて自動的に切り替わる
2. **学習型コンテキスト**：過去の対話から自動的に改善
3. **協調型コンテキスト**：複数のAIエージェント間で共有

### 標準化の動き
- 業界標準のコンテキストフォーマット
- 共有可能なコンテキストライブラリ
- コンテキストのマーケットプレイス

## まとめ

AIエージェントのコンテキスト設計は、効率的で安全な開発を実現するための重要な要素です。明確で具体的なルールを定義し、継続的に改善していくことで、AIとの協働作業の質を大幅に向上させることができます。

重要なのは、コンテキストは「生きたドキュメント」として扱い、プロジェクトの成長とともに進化させていくことです。

=====================
以下は壁打ちに対するコメント
=====================
- 壁打ちコードの
